{"version":3,"file":"ngx-modelstage.umd.js.map","sources":["ng://ngx-modelstage/src/ps-geometry.ts","node_modules/tslib/tslib.es6.js","ng://ngx-modelstage/src/mx-common.ts","ng://ngx-modelstage/src/mx-appstate.ts","ng://ngx-modelstage/src/modelstage.ts","ng://ngx-modelstage/src/modelstage-sample-web.ts"],"sourcesContent":["/// ModelStage Â© 2018 Plansysteme GmbH, Hamburg, Germany. All rights reserved.\r\n\r\nexport module psgeometry {\r\n\r\n    export class Matrix4 {\r\n    elements: number[];\r\n\r\n    static Identity = new Matrix4();\r\n\r\n    static FromTranslation(x: number, y: number, z: number) {\r\n      let result = new Matrix4();\r\n      result.elements[3] = x;\r\n      result.elements[7] = y;\r\n      result.elements[11] = z;\r\n      return result;\r\n    }\r\n\r\n    static FromScaling(x: number, y: number, z: number) {\r\n      let result = new Matrix4();\r\n      result.elements[0] = x;\r\n      result.elements[5] = y;\r\n      result.elements[10] = z;\r\n      return result;\r\n    }\r\n     \r\n    static FromRotationX(angle: number) {\r\n      let cosA = Math.cos(angle);\r\n      let sinA = Math.sin(angle);\r\n      let result = new Matrix4();\r\n      result.elements[5] = cosA;\r\n      result.elements[6] = -sinA;\r\n      result.elements[9] = sinA;\r\n      result.elements[10] = cosA;\r\n      return result;\r\n    }\r\n    \r\n    static FromRotationY(angle: number) {\r\n      let cosA = Math.cos(angle);\r\n      let sinA = Math.sin(angle);\r\n      let result = new Matrix4();\r\n      result.elements[0] = cosA;\r\n      result.elements[2] = sinA;\r\n      result.elements[8] = -sinA;\r\n      result.elements[10] = cosA;\r\n      return result;\r\n    }\r\n        \r\n    static FromRotationZ(angle: number) {\r\n      let cosA = Math.cos(angle);\r\n      let sinA = Math.sin(angle);\r\n      let result = new Matrix4();\r\n      result.elements[0] = cosA;\r\n      result.elements[1] = -sinA;\r\n      result.elements[4] = sinA;\r\n      result.elements[5] = cosA;\r\n      return result;\r\n    }\r\n\r\n    static FromRotation(pitch: number, yaw: number, roll: number) {\r\n      return new Matrix4([\r\n        Math.cos(yaw) * Math.cos(pitch), Math.sin(yaw) * Math.cos(pitch), -Math.sin(pitch), 0,\r\n        Math.cos(yaw) * Math.sin(pitch) * Math.sin(roll) - Math.sin(yaw) * Math.cos(roll), Math.sin(yaw) * Math.sin(pitch) * Math.sin(roll) + Math.cos(yaw) * Math.cos(roll), Math.cos(pitch) * Math.sin(roll), 0,\r\n        Math.cos(yaw) * Math.sin(pitch) * Math.cos(roll) + Math.sin(yaw) * Math.sin(roll), Math.sin(yaw) * Math.sin(pitch) * Math.cos(roll) - Math.cos(yaw) * Math.sin(roll), Math.cos(pitch) * Math.cos(roll), 0,\r\n        0, 0, 0, 1]\r\n      ).transpose();\r\n    }\r\n\r\n    constructor(elements?: number[]) {\r\n      this.elements = elements || [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];\r\n    }\r\n\r\n    e(colIdx: number, rowIdx: number): number {\r\n      let idx = colIdx + (rowIdx || 0) * 4;\r\n      return idx >= 0 && idx < 16 ? this.elements[idx] : null;\r\n    };\r\n\r\n    row(idx: number): Vec4 {\r\n      if (idx >= 0 && idx < 4) {\r\n        return new Vec4(this.elements[idx * 4], this.elements[idx * 4 + 1], this.elements[idx * 4 + 2], this.elements[idx * 4 + 3]);\r\n      } else {\r\n        return null;\r\n      }\r\n    };\r\n\r\n    col(idx: number): Vec4 {\r\n      if (idx <= 0 && idx < 4) {\r\n        return new Vec4(this.elements[idx], this.elements[idx + 4], this.elements[idx + 8], this.elements[idx + 12]);\r\n      } else {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    equals(m: Matrix4) {\r\n      if (m) {\r\n        let l = this.elements;\r\n        let r = m.elements;\r\n\r\n        return l[0] == r[0] && l[1] == r[1] && l[2] == r[2] && l[3] == r[3] &&\r\n          l[4] == r[4] && l[5] == r[5] && l[6] == r[6] && l[7] == r[7] &&\r\n          l[8] == r[8] && l[9] == r[9] && l[10] == r[10] && l[11] == r[11] &&\r\n          l[12] == r[12] && l[13] == r[13] && l[14] == r[14] && l[15] == r[15];\r\n      } else {\r\n        return false;\r\n      }\r\n\r\n    }\r\n\r\n    multiply(m: Matrix4 | Vec4 | number): Matrix4 | Vec4 {\r\n      if (m instanceof Matrix4) {\r\n        let l = this.elements;\r\n        let r = m.elements;\r\n        return new Matrix4([\r\n          l[0] * r[0] + l[4] * r[1] + l[8] * r[2] + l[12] * r[3],\r\n          l[1] * r[0] + l[5] * r[1] + l[9] * r[2] + l[13] * r[3],\r\n          l[2] * r[0] + l[6] * r[1] + l[10] * r[2] + l[14] * r[3],\r\n          l[3] * r[0] + l[7] * r[1] + l[11] * r[2] + l[15] * r[3],\r\n\r\n          l[0] * r[4] + l[4] * r[5] + l[8] * r[6] + l[12] * r[7],\r\n          l[1] * r[4] + l[5] * r[5] + l[9] * r[6] + l[13] * r[7],\r\n          l[2] * r[4] + l[6] * r[5] + l[10] * r[6] + l[14] * r[7],\r\n          l[3] * r[4] + l[7] * r[5] + l[11] * r[6] + l[15] * r[7],\r\n\r\n          l[0] * r[8] + l[4] * r[9] + l[8] * r[10] + l[12] * r[11],\r\n          l[1] * r[8] + l[5] * r[9] + l[9] * r[10] + l[13] * r[11],\r\n          l[2] * r[8] + l[6] * r[9] + l[10] * r[10] + l[14] * r[11],\r\n          l[3] * r[8] + l[7] * r[9] + l[11] * r[10] + l[15] * r[11],\r\n\r\n          l[0] * r[12] + l[4] * r[13] + l[8] * r[14] + l[12] * r[15],\r\n          l[1] * r[12] + l[5] * r[13] + l[9] * r[14] + l[13] * r[15],\r\n          l[2] * r[12] + l[6] * r[13] + l[10] * r[14] + l[14] * r[15],\r\n          l[3] * r[12] + l[7] * r[13] + l[11] * r[14] + l[15] * r[15]\r\n        ]);\r\n      } else if (m instanceof Vec4) {\r\n        return new Vec4(\r\n          m.x * this.elements[0] + m.y * this.elements[1] + m.z * this.elements[2] + m.w * this.elements[3],\r\n          m.x * this.elements[4] + m.y * this.elements[5] + m.z * this.elements[6] + m.w * this.elements[7],\r\n          m.x * this.elements[8] + m.y * this.elements[9] + m.z * this.elements[10] + m.w * this.elements[11],\r\n          m.x * this.elements[12] + m.y * this.elements[13] + m.z * this.elements[14] + m.w * this.elements[15]);\r\n      } else {\r\n        return new Matrix4(this.elements.map(function (e) { return e * <number>m; }));\r\n      }\r\n    }\r\n\r\n    toRightTriangular(): Matrix4 {\r\n      return new Matrix4(Matrix.toRightTriangular(this.elements, 4, 4));\r\n    }\r\n\r\n    determinant(): number {\r\n      let m = this.toRightTriangular();\r\n      return m.elements[0] * m.elements[5] * m.elements[10] * m.elements[15];\r\n    }\r\n\r\n    isSingular(): boolean {\r\n      return this.determinant() === 0;\r\n    }\r\n\r\n    transpose(): Matrix4 {\r\n      let e = this.elements;\r\n      return new Matrix4([\r\n        e[0], e[4], e[8], e[12],\r\n        e[1], e[5], e[9], e[13],\r\n        e[2], e[6], e[10], e[14],\r\n        e[3], e[7], e[11], e[15]\r\n      ]);\r\n    }\r\n\r\n    inverse(): Matrix4 {\r\n      if (!this.isSingular()) {\r\n        let augmentedMatrix = [\r\n          this.elements[0], this.elements[1], this.elements[2], this.elements[3], 1, 0, 0, 0,\r\n          this.elements[4], this.elements[5], this.elements[6], this.elements[7], 0, 1, 0, 0,\r\n          this.elements[8], this.elements[9], this.elements[10], this.elements[11], 0, 0, 1, 0,\r\n          this.elements[12], this.elements[13], this.elements[14], this.elements[15], 0, 0, 0, 1\r\n        ];\r\n\r\n        let m = Matrix.toRightTriangular(augmentedMatrix, 4, 8);\r\n\r\n        for (let row = 3; row >= 0; row--) {\r\n          let divisor = m[row * 9];\r\n          for (let col = 0; col < 8; col++) {\r\n            m[row * 8 + col] = m[row * 8 + col] / divisor;\r\n          }\r\n\r\n          for (let altrow = row - 1; altrow >= 0; altrow--) {\r\n            let multiplier = m[altrow * 8 + row];\r\n            for (let col = 0; col < 8; col++) {\r\n              m[altrow * 8 + col] = m[altrow * 8 + col] - m[row * 8 + col] * multiplier;\r\n            }\r\n          }\r\n        }\r\n        return new Matrix4([\r\n          m[4], m[5], m[6], m[7],\r\n          m[12], m[13], m[14], m[15],\r\n          m[20], m[21], m[22], m[23],\r\n          m[28], m[29], m[30], m[31]\r\n        ]);\r\n      }\r\n      else {\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n\r\n\r\n  export class Matrix3 {\r\n    elements: number[];\r\n\r\n    constructor(elements?: number[]) {\r\n      this.elements = elements || [1, 0, 0, 0, 1, 0, 0, 0, 1];\r\n    }\r\n\r\n    static Identity = new Matrix3();\r\n\r\n    e(colIdx: number, rowIdx: number): number {\r\n      let idx = colIdx + (rowIdx || 0) * 3;\r\n      return idx >= 0 && idx < 9 ? this.elements[idx] : null;\r\n    }\r\n\r\n    row(idx: number): Vec3 {\r\n      if (idx >= 0 && idx < 3) {\r\n        return new Vec3(this.elements[idx * 3], this.elements[idx * 3 + 1], this.elements[idx * 3 + 2]);\r\n      } else {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    col(idx: number): Vec3 {\r\n      if (idx <= 0 && idx < 3) {\r\n        return new Vec3(this.elements[idx], this.elements[idx + 3], this.elements[idx + 6]);\r\n      } else {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    multiply(m: Matrix3 | Vec3 | number): Matrix3 | Vec3 {\r\n      if (m instanceof Matrix3) {\r\n        let l = this.elements;\r\n        let r = m.elements;\r\n        return new Matrix3([\r\n          l[0] * r[0] + l[3] * r[1] + l[6] * r[2],\r\n          l[1] * r[0] + l[4] * r[1] + l[7] * r[2],\r\n          l[2] * r[0] + l[5] * r[1] + l[8] * r[2],\r\n\r\n          l[0] * r[3] + l[3] * r[4] + l[6] * r[5],\r\n          l[1] * r[3] + l[4] * r[4] + l[7] * r[5],\r\n          l[2] * r[3] + l[5] * r[4] + l[8] * r[5],\r\n\r\n          l[0] * r[6] + l[3] * r[7] + l[6] * r[8],\r\n          l[1] * r[6] + l[4] * r[7] + l[7] * r[8],\r\n          l[2] * r[6] + l[5] * r[7] + l[8] * r[8]\r\n        ]);\r\n      } else if (m instanceof Vec3) {\r\n        return new Vec3(\r\n          m.x * this.elements[0] + m.y * this.elements[1] + m.z * this.elements[2],\r\n          m.x * this.elements[3] + m.y * this.elements[4] + m.z * this.elements[5],\r\n          m.x * this.elements[6] + m.y * this.elements[7] + m.z * this.elements[8]);\r\n      } else {\r\n        return new Matrix3(this.elements.map(function (e) { return e * <number>m; }));\r\n      }\r\n    }\r\n\r\n    toRightTriangular(): Matrix3 {\r\n      return new Matrix3(Matrix.toRightTriangular(this.elements, 3, 3));\r\n    }\r\n\r\n    determinant(): number {\r\n      let m = this.toRightTriangular();\r\n      return m.elements[0] * m.elements[4] * m.elements[8];\r\n    }\r\n\r\n    isSingular(): boolean {\r\n      return this.determinant() === 0;\r\n    }\r\n\r\n    transpose(): Matrix3 {\r\n      let e = this.elements;\r\n      return new Matrix3([\r\n        e[0], e[3], e[6],\r\n        e[1], e[4], e[7],\r\n        e[2], e[5], e[8]\r\n      ]);\r\n    }\r\n\r\n    inverse(): Matrix3 {\r\n      if (!this.isSingular()) {\r\n        let augmentedMatrix = [\r\n          this.elements[0], this.elements[1], this.elements[2], 1, 0, 0,\r\n          this.elements[3], this.elements[4], this.elements[5], 0, 1, 0,\r\n          this.elements[6], this.elements[7], this.elements[8], 0, 0, 1,\r\n        ];\r\n\r\n        let m = Matrix.toRightTriangular(augmentedMatrix, 3, 6);\r\n\r\n        for (let row = 2; row >= 0; row--) {\r\n          let divisor = m[row * 7];\r\n          for (let col = 0; col < 6; col++) {\r\n            m[row * 7 + col] = m[row * 7 + col] / divisor;\r\n          }\r\n\r\n          for (let altrow = row - 1; altrow >= 0; altrow--) {\r\n            let multiplier = m[altrow * 6 + row];\r\n            for (let col = 0; col < 6; col++) {\r\n              m[altrow * 6 + col] = m[altrow * 6 + col] - m[row * 6 + col] * multiplier;\r\n            }\r\n          }\r\n        }\r\n        return new Matrix3([\r\n          m[3], m[4], m[5],\r\n          m[9], m[10], m[11],\r\n          m[15], m[16], m[17]\r\n        ]);\r\n      }\r\n      else {\r\n        return null;\r\n      }\r\n    }\r\n  }\r\n\r\n  export class Matrix {\r\n    static toRightTriangular(elements, rows, cols) {\r\n      let m = elements.slice(0);\r\n\r\n      for (let row = 0; row < rows; row++) {\r\n        if (m[row * (cols + 1)] == 0) {\r\n          for (let altrow = row + 1; altrow < rows; altrow++) {\r\n            if (m[altrow * cols + row] != 0) {\r\n              for (let j = 0; j < cols; j++) {\r\n                m[row * cols + j] += m[altrow * cols + j];\r\n              }\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (m[row * (cols + 1)] != 0) {\r\n          for (let altrow = row + 1; altrow < rows; altrow++) {\r\n            let multiplier = m[altrow * cols + row] / m[row * (cols + 1)];\r\n            for (let j = 0; j < cols; j++) {\r\n              m[altrow * cols + j] = j < row ? 0 : m[altrow * cols + j] - m[row * cols + j] * multiplier;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return m;\r\n    }\r\n  }\r\n\r\n  export class Vec3 {\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n\r\n    constructor(x?, y?, z?) {\r\n      this.x = x || 0.0;\r\n      this.y = y || 0.0;\r\n      this.z = z || 0.0;\r\n    }\r\n\r\n    asVec3() {\r\n      return this;\r\n    }\r\n\r\n    asVec4(w?: number): Vec4 {\r\n      return new Vec4(this.x, this.y, this.z, w || 1.0);\r\n    }\r\n\r\n    equals(v: Vec3): boolean {\r\n      return this.x == v.x && this.y == v.y && this.z == v.z;\r\n    }\r\n\r\n    assignPoint(x, y, z) {\r\n      this.x = x;\r\n      this.y = y;\r\n      this.z = z;\r\n    }\r\n\r\n    assignVec(v: Vec3 | Vec4) {\r\n      this.x = v.x;\r\n      this.y = v.y;\r\n      this.z = v.z;\r\n    }\r\n\r\n    add(vec: Vec3 | Vec4): Vec3 {\r\n      return new Vec3(this.x + vec.x, this.y + vec.y, this.z + vec.z);\r\n    }\r\n\r\n    sub(vec: Vec3 | Vec4): Vec3 {\r\n      return new Vec3(this.x - vec.x, this.y - vec.y, this.z - vec.z);\r\n    }\r\n\r\n    dot(vec: Vec3 | Vec4): number {\r\n      return this.x * vec.x + this.y * vec.y + this.z * vec.z;\r\n    }\r\n\r\n    cross(v: Vec3 | Vec4) {\r\n      return new Vec3(\r\n        (this.y * v.z) - (this.z * v.y),\r\n        (this.z * v.x) - (this.x * v.z),\r\n        (this.x * v.y) - (this.y * v.x)\r\n      );\r\n    }\r\n\r\n    multiply(s: number) {\r\n      return new Vec3(this.x * s, this.y * s, this.z * s);\r\n    }\r\n\r\n    applyQuaternion(q: Quaternion) {\r\n      let x = this.x;\r\n      let y = this.y;\r\n      let z = this.z;\r\n\r\n      let qx = q.x;\r\n      let qy = q.y;\r\n      let qz = q.z;\r\n      let qw = q.w;\r\n\r\n      // quaternion * vector\r\n      let px = qw * x + qy * z - qz * y;\r\n      let py = qw * y + qz * x - qx * z;\r\n      let pz = qw * z + qx * y - qy * x;\r\n      let pw = -qx * x - qy * y - qz * z;\r\n\r\n      // product * inverse quaternion\r\n      this.x = px * qw - pw * qx - py * qz + pz * qy;\r\n      this.y = py * qw - pw * qy - pz * qx + px * qz;\r\n      this.z = pz * qw - pw * qz - px * qy + py * qx;\r\n\r\n      return this;\r\n    }\r\n\r\n    norm() {\r\n      return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\r\n    }\r\n\r\n    normalize() {\r\n      return this.multiply(1 / this.norm());\r\n    }\r\n\r\n    elements() {\r\n      return [this.x, this.y, this.z];\r\n    }\r\n\r\n    squaredDist(v: Vec3 | Vec4) {\r\n      return (this.x - v.x) * (this.x - v.x) +\r\n        (this.y - v.y) * (this.y - v.y) +\r\n        (this.z - v.z) * (this.z - v.z);\r\n    }\r\n  }\r\n\r\n  export class Vec4 {\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n    w: number;\r\n\r\n    public static Zero = new Vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n    public static One = new Vec4(1.0, 1.0, 1.0, 1.0);\r\n\r\n    constructor(x?, y?, z?, w?) {\r\n      this.x = x || 0.0;\r\n      this.y = y || 0.0;\r\n      this.z = z || 0.0;\r\n      this.w = w || 0.0;\r\n    }\r\n\r\n    equals(v: Vec4): boolean {\r\n      return this.x == v.x && this.y == v.y && this.z == v.z && this.w == v.w;\r\n    }\r\n\r\n    asVec3(): Vec3 {\r\n      return new Vec3(this.x, this.y, this.z);\r\n    }\r\n\r\n    asVec4(): Vec4 {\r\n      return this;\r\n    }\r\n\r\n    add(vec: Vec4): Vec4 {\r\n      return new Vec4(this.x + vec.x, this.y + vec.y, this.z + vec.z, this.w + vec.w);\r\n    }\r\n\r\n    sub(vec: Vec4): Vec4 {\r\n      return new Vec4(this.x - vec.x, this.y - vec.y, this.z - vec.z, this.w - vec.w);\r\n    }\r\n\r\n    dot(vec: Vec4): number {\r\n      return this.x * vec.x + this.y * vec.y + this.z * vec.z + this.w * vec.w;\r\n    }\r\n\r\n    cross(v: Vec4): Vec4 {\r\n      return new Vec4(\r\n        (this.y * v.z) - (this.z * v.y),\r\n        (this.z * v.x) - (this.x * v.z),\r\n        (this.x * v.y) - (this.y * v.x),\r\n        1.0\r\n      );\r\n    }\r\n\r\n    multiply(s: number): Vec4 {\r\n      return new Vec4(this.x * s, this.y * s, this.z * s, this.w * s);\r\n    }\r\n\r\n    norm(): number {\r\n      return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z + this.w * this.w);\r\n    }\r\n\r\n    normalize(): Vec4 {\r\n      return this.multiply(1 / this.norm());\r\n    }\r\n\r\n    elements(): number[] {\r\n      return [this.x, this.y, this.z, this.w];\r\n    }\r\n\r\n    squaredDist(v: Vec4) {\r\n      return (this.x - v.x) * (this.x - v.x) +\r\n        (this.y - v.y) * (this.y - v.y) +\r\n        (this.z - v.z) * (this.z - v.z) +\r\n        (this.w - v.w) * (this.w - v.w);\r\n    }\r\n  }\r\n\r\n  export class Quaternion {\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n    w: number;\r\n\r\n    constructor(x?: number, y?: number, z?: number, w?: number) {\r\n      this.x = x || 0.0;\r\n      this.y = y || 0.0;\r\n      this.z = z || 0.0;\r\n      this.w = typeof w == 'undefined' ? 1.0 : w;\r\n    }\r\n\r\n    setFromAxisAngle(axis: Vec3, angle: number): Quaternion {\r\n      let halfAngle = angle / 2;\r\n      let s = Math.sin(halfAngle);\r\n\r\n      this.x = axis.x * s;\r\n      this.y = axis.y * s;\r\n      this.z = axis.z * s;\r\n      this.w = Math.cos(halfAngle);\r\n\r\n      return this;\r\n    }\r\n\r\n    multiply(q: Quaternion) {\r\n      let x = this.x, y = this.y, z = this.z, w = this.w;\r\n      let qx = q.x, qy = q.y, qz = q.z, qw = q.w;\r\n\r\n      this.x = x * qw + w * qx + y * qz - z * qy;\r\n      this.y = y * qw + w * qy + z * qx - x * qz;\r\n      this.z = z * qw + w * qz + x * qy - y * qx;\r\n      this.w = w * qw - x * qx - y * qy - z * qz;\r\n    }\r\n  }\r\n\r\n  export class AABB3D {\r\n    public minX: number = +Infinity;\r\n    public maxX: number = -Infinity;\r\n    public minY: number = +Infinity;\r\n    public maxY: number = -Infinity;\r\n    public minZ: number = +Infinity;\r\n    public maxZ: number = -Infinity;\r\n\r\n    public addPoint(x: number, y: number, z: number) {\r\n      this.minX = Math.min(this.minX, x);\r\n      this.maxX = Math.max(this.maxX, x);\r\n      this.minY = Math.min(this.minY, y);\r\n      this.maxY = Math.max(this.maxY, y);\r\n      this.minZ = Math.min(this.minZ, z);\r\n      this.maxZ = Math.max(this.maxZ, z);\r\n    }\r\n\r\n    public addVector(v: Vec3 | Vec4) {\r\n      this.addPoint(v.x, v.y, v.z);\r\n    }\r\n\r\n    public addAABB(box: AABB3D) {\r\n      this.addPoint(box.minX, box.minY, box.minZ);\r\n      this.addPoint(box.maxX, box.maxY, box.maxZ);\r\n    }\r\n\r\n    public clear() {\r\n      this.minX = +Infinity;\r\n      this.maxX = -Infinity;\r\n      this.minY = +Infinity;\r\n      this.maxY = -Infinity;\r\n      this.minZ = +Infinity;\r\n      this.maxZ = -Infinity;\r\n    }\r\n\r\n    public center(): Vec3 {\r\n      return new Vec3(\r\n        .5 * (this.minX + this.maxX),\r\n        .5 * (this.minY + this.maxY),\r\n        .5 * (this.minZ + this.maxZ)\r\n      );\r\n    }\r\n\r\n    public extents(): Vec3 {\r\n      return new Vec3(\r\n        (this.maxX - this.minX),\r\n        (this.maxY - this.minY),\r\n        (this.maxZ - this.minZ)\r\n      );\r\n    }\r\n\r\n    public min(): Vec3 {\r\n      return new Vec3(\r\n        this.minX,\r\n        this.minY,\r\n        this.minZ\r\n      );\r\n    }\r\n\r\n    public max(): Vec3 {\r\n      return new Vec3(\r\n        this.maxX,\r\n        this.maxY,\r\n        this.maxZ\r\n      );\r\n    }\r\n\r\n    public contains(v: Vec3 | Vec4) {\r\n      return v.x >= this.minX && v.x <= this.maxX &&\r\n        v.y >= this.minY && v.y <= this.maxY &&\r\n        v.z >= this.minZ && v.z <= this.maxZ;\r\n    }\r\n\r\n    public transform(matrix: Matrix4): AABB3D {\r\n      let result = new AABB3D();\r\n\r\n      let minV = <Vec4>matrix.multiply(new Vec4(this.minX, this.minY, this.minZ, 1));\r\n      let maxV = <Vec4>matrix.multiply(new Vec4(this.maxX, this.maxY, this.maxZ, 1));\r\n\r\n      result.minX = minV.x; result.minY = minV.y; result.minZ = minV.z;\r\n      result.maxX = maxV.x; result.maxY = maxV.y; result.maxZ = maxV.z;\r\n\r\n      return result;\r\n    }\r\n\r\n    public intersectsRay(ray: Line3D): Vec3 {\r\n      let result: Vec3 = null;\r\n\r\n      let v0 = ray.p0.asVec3();\r\n      let dir = ray.p1.asVec3().sub(ray.p0.asVec3());\r\n\r\n      let intX0 = ray.intersectRayWithPlane(new Vec3(this.minX, 0, 0), new Vec3(-1, 0, 0));\r\n      let intX1 = ray.intersectRayWithPlane(new Vec3(this.maxX, 0, 0), new Vec3(1, 0, 0));\r\n      let intY0 = ray.intersectRayWithPlane(new Vec3(0, this.minY, 0), new Vec3(0, -1, 0));\r\n      let intY1 = ray.intersectRayWithPlane(new Vec3(0, this.maxY, 0), new Vec3(0, 1, 0));\r\n      let intZ0 = ray.intersectRayWithPlane(new Vec3(0, 0, this.minZ), new Vec3(0, 0, -1));\r\n      let intZ1 = ray.intersectRayWithPlane(new Vec3(0, 0, this.maxZ), new Vec3(0, 0, 1));\r\n\r\n      let currDist = Infinity;\r\n      if (intX0 && this.contains(intX0)) { currDist = v0.squaredDist(intX0); result = intX0; }\r\n      if (intX1 && this.contains(intX1) && v0.squaredDist(intX1) < currDist) { currDist = v0.squaredDist(intX1); result = intX1; }\r\n      if (intY0 && this.contains(intY0) && v0.squaredDist(intY0) < currDist) { currDist = v0.squaredDist(intY0); result = intY0; }\r\n      if (intY1 && this.contains(intY1) && v0.squaredDist(intY1) < currDist) { currDist = v0.squaredDist(intY1); result = intY1; }\r\n      if (intZ0 && this.contains(intZ0) && v0.squaredDist(intZ0) < currDist) { currDist = v0.squaredDist(intZ0); result = intZ0; }\r\n      if (intZ1 && this.contains(intZ1) && v0.squaredDist(intZ1) < currDist) { currDist = v0.squaredDist(intZ1); result = intZ1; }\r\n\r\n      return result;\r\n    }\r\n  }\r\n\r\n  export class Point3D {\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n\r\n    constructor(x?, y?, z?) {\r\n      this.x = x || 0.0;\r\n      this.y = y || 0.0;\r\n      this.z = z || 0.0;\r\n    }\r\n\r\n    asVec3(): Vec3 {\r\n      return new Vec3(this.x, this.y, this.z);\r\n    }\r\n\r\n    asVec4(w?: number): Vec4 {\r\n      return new Vec4(this.x, this.y, this.z, w || 1.0);\r\n    }\r\n  }\r\n\r\n  export class Line3D {\r\n    p0: Point3D;\r\n    p1: Point3D;\r\n\r\n    constructor(p0, p1) {\r\n      this.p0 = p0 || new Point3D();\r\n      this.p1 = p1 || new Point3D();\r\n    }\r\n\r\n    public intersectRayWithPlane(v0: Vec3, n: Vec3): Vec3 {\r\n      let result: Vec3 = null;\r\n\r\n      let u = this.p1.asVec3().sub(this.p0.asVec3());\r\n\r\n      let D = n.dot(u);\r\n      if (D != 0) {\r\n        let w = this.p0.asVec3().sub(v0);\r\n        let N = -n.dot(w);\r\n        let sI = N / D;\r\n\r\n        if (sI >= 0) {\r\n          result = this.p0.asVec3().add(u.multiply(sI));\r\n        }\r\n      }\r\n\r\n      return result;\r\n    }\r\n\r\n    intersectTriangle(p0, p1, p2) {\r\n      let matrix = new Matrix3([\r\n        this.p0.x - this.p1.x, p1.x - p0.x, p2.x - p0.x,\r\n        this.p0.y - this.p1.y, p1.y - p0.y, p2.y - p0.y,\r\n        this.p0.z - this.p1.z, p1.z - p0.z, p2.z - p0.z\r\n      ]).inverse();\r\n\r\n      if (matrix) {\r\n        let res = matrix.multiply(this.p0.asVec3().sub(p0.asVec3()));\r\n        if (res && (<Vec3>res).y >= 0 && (<Vec3>res).y <= 1.0 && (<Vec3>res).z >= 0 && (<Vec3>res).z <= 1.0 && (<Vec3>res).y + (<Vec3>res).z <= 1.0) {\r\n          return p0.asVec3()\r\n            .add(p1.asVec3().sub(p0.asVec3()).multiply((<Vec3>res).y))\r\n            .add(p2.asVec3().sub(p0.asVec3()).multiply((<Vec3>res).z));\r\n        } else {\r\n          return null;\r\n        }\r\n      } else {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    transform(matrix: Matrix4) {\r\n      let v0 = <Vec4>matrix.multiply(this.p0.asVec4());\r\n      let v1 = <Vec4>matrix.multiply(this.p1.asVec4());\r\n      return new Line3D(new Point3D(v0.x, v0.y, v0.z), new Point3D(v1.x, v1.y, v1.z));\r\n    }\r\n  }\r\n\r\n  export class Camera {\r\n    private _position: Vec3;\r\n    private _direction: Vec3;\r\n    private _up: Vec3;\r\n\r\n    private currentViewMatrix: Matrix4;\r\n\r\n    constructor(position?: Vec3, direction?: Vec3, up?: Vec3) {\r\n      this._position = position || new Vec3(0.0, 0.0, 20.0);\r\n      this._direction = direction || new Vec3(0.0, 0.0, -1.0);\r\n      this._up = up || new Vec3(0.0, 1.0, 0.0);\r\n    }\r\n\r\n    changed() {\r\n      this.currentViewMatrix = null;\r\n    }\r\n\r\n    setPosition(x?: number, y?: number, z?: number) {\r\n      this._position.x = x || 0.0;\r\n      this._position.y = y || 0.0;\r\n      this._position.z = z || 0.0;\r\n      this.changed();\r\n    }\r\n\r\n    setDirection(x: number, y: number, z: number) {\r\n      this._direction.x = x;\r\n      this._direction.y = y;\r\n      this._direction.z = z;\r\n      this.changed();\r\n    }\r\n\r\n    setCenter(x: number, y: number, z: number) {\r\n      this._direction.x = x - this._position.x;\r\n      this._direction.y = y - this._position.y;\r\n      this._direction.z = z - this._position.z;\r\n      this.changed();\r\n    }\r\n\r\n    getPosition(): Vec3 {\r\n      return this._position;\r\n    }\r\n\r\n    asVec3(): Vec3 {\r\n      return this._position;\r\n    }\r\n\r\n    asVec4(): Vec4 {\r\n      return this._position.asVec4();\r\n    }\r\n\r\n    getProjectionMatrix(width, height): Matrix4 {\r\n      return this.makePerspective(45, width / height, 0.1, 10000.0);\r\n    }\r\n\r\n    getViewMatrix(): Matrix4 {\r\n      return <psgeometry.Matrix4>this.makeLookAt();\r\n    }\r\n\r\n    private makePerspective(fovy, aspect, znear, zfar): Matrix4 {\r\n      let ymax = znear * Math.tan(fovy * Math.PI / 360.0);\r\n      let ymin = -ymax;\r\n      let xmin = ymin * aspect;\r\n      let xmax = ymax * aspect;\r\n\r\n      return this.makeFrustum(xmin, xmax, ymin, ymax, znear, zfar);\r\n    }\r\n\r\n    private makeFrustum(left, right,\r\n      bottom, top,\r\n      znear, zfar): Matrix4 {\r\n      let x = 2 * znear / (right - left);\r\n      let y = 2 * znear / (top - bottom);\r\n      let a = (right + left) / (right - left);\r\n      let b = (top + bottom) / (top - bottom);\r\n      let c = -(zfar + znear) / (zfar - znear);\r\n      let d = -2 * zfar * znear / (zfar - znear);\r\n\r\n      return new Matrix4(\r\n        [x, 0, a, 0,\r\n          0, y, b, 0,\r\n          0, 0, c, d,\r\n          0, 0, -1, 0]);\r\n    }\r\n\r\n    private makeOrtho(left, right, bottom, top, znear, zfar): Matrix4 {\r\n      let tx = -(right + left) / (right - left);\r\n      let ty = -(top + bottom) / (top - bottom);\r\n      let tz = -(zfar + znear) / (zfar - znear);\r\n\r\n      return new Matrix4(\r\n        [2 / (right - left), 0, 0, tx,\r\n          0, 2 / (top - bottom), 0, ty,\r\n          0, 0, -2 / (zfar - znear), tz,\r\n          0, 0, 0, 1]);\r\n    }\r\n\r\n    private makeLookAt(): Matrix4 {\r\n      let eye = this._position;\r\n      let center = this._position.add(this._direction);\r\n      let up = this._up;\r\n\r\n      let z = eye.sub(center).normalize();\r\n      let x = up.cross(z).normalize();\r\n      let y = z.cross(x).normalize();\r\n\r\n      let m = new Matrix4([\r\n        x.x, x.y, x.z, 0,\r\n        y.x, y.y, y.z, 0,\r\n        z.x, z.y, z.z, 0,\r\n        0, 0, 0, 1]);\r\n\r\n      let t = new Matrix4([\r\n        1, 0, 0, -eye.x,\r\n        0, 1, 0, -eye.y,\r\n        0, 0, 1, -eye.z,\r\n        0, 0, 0, 1]);\r\n\r\n      return <Matrix4>t.multiply(m);\r\n    }\r\n  }\r\n\r\n  function pointInTriangle(p, a, b, c): boolean {\r\n    // Compute vectors        \r\n    let v0 = c.subtract(a);\r\n    let v1 = b.subtract(a);\r\n    let v2 = p.subtract(a);\r\n\r\n    // Compute dot products\r\n    let dot00 = v0.dot(v0)\r\n    let dot01 = v0.dot(v1)\r\n    let dot02 = v0.dot(v2)\r\n    let dot11 = v1.dot(v1)\r\n    let dot12 = v1.dot(v2)\r\n\r\n    // Compute barycentric coordinates\r\n    let invDenom = 1 / (dot00 * dot11 - dot01 * dot01)\r\n    let u = (dot11 * dot02 - dot01 * dot12) * invDenom\r\n    let v = (dot00 * dot12 - dot01 * dot02) * invDenom\r\n\r\n    // Check if point is in triangle\r\n    return (u >= 0) && (v >= 0) && (u + v < 1);\r\n  }\r\n\r\n\r\n  export class Vec2 {\r\n    public x: number;\r\n    public y: number;\r\n\r\n    constructor(x?: number, y?: number) {\r\n      this.x = x || 0.0;\r\n      this.y = y || 0.0;\r\n    }\r\n\r\n    public sub(v: Vec2) {\r\n      return new Vec2(this.x - v.x, this.y - v.y);\r\n    }\r\n\r\n    public static insideTri(a: Vec2, b: Vec2, c: Vec2, p: Vec2) {\r\n      return Vec2.cross(c.sub(b), p.sub(b)) >= .0 &&\r\n        Vec2.cross(a.sub(c), p.sub(c)) >= .0 &&\r\n        Vec2.cross(b.sub(a), p.sub(a)) >= .0;\r\n    };\r\n\r\n    public static cross(v0: Vec2, v1: Vec2): number {\r\n      return v0.x * v1.y - v0.y * v1.x;\r\n    }\r\n\r\n  }\r\n\r\n  export class Polygon2D {\r\n\r\n    private static Epsilon = 1e-10;\r\n\r\n    private vertices: Array<Vec2> = [];\r\n\r\n    public get Vertices() {\r\n      return this.vertices;\r\n    }\r\n\r\n    public addVertex(x: number, y: number) {\r\n      this.vertices.push(new Vec2(x, y));\r\n    }\r\n\r\n    public addVector(v: Vec2) {\r\n      this.vertices.push(v);\r\n    }\r\n\r\n    public addToAABB(box: AABB2D) {\r\n      this.vertices.forEach((p) => {\r\n        box.addVector(p);\r\n      });\r\n    }\r\n\r\n    public clear() {\r\n      this.vertices.length = 0;\r\n    }\r\n\r\n    public getArea(): number {\r\n      // see: https://stackoverflow.com/a/1165943\r\n      let result = 0;\r\n\r\n      let n = this.vertices.length;\r\n      for (let i = n - 1, q = 0; q < n; i = q++) {\r\n        result += this.vertices[i].x * this.vertices[q].y - this.vertices[q].x * this.vertices[i].y;\r\n      }\r\n\r\n      return result * 0.5;\r\n    }\r\n\r\n\r\n\r\n    private snip(u: number, v: number, w: number, n: number, indices: Array<number>) {\r\n      let result;\r\n\r\n      let a = this.vertices[indices[u]];\r\n      let b = this.vertices[indices[v]];\r\n      let c = this.vertices[indices[w]];\r\n      let p: Vec2;\r\n\r\n      result = (b.x - a.x) * (c.y - a.y) - (b.y - a.y) * (c.x - a.x) > Polygon2D.Epsilon;\r\n\r\n      for (let i = 0; i < n && result; ++i) {\r\n        if ((i != u) && (i != v) && (i != w)) {\r\n          p = this.vertices[indices[i]];\r\n          result = !Vec2.insideTri(a, b, c, p);\r\n        }\r\n      }\r\n\r\n      return result;\r\n    }\r\n\r\n    public triangulate(): Polygon2D {\r\n      let result = new Polygon2D();\r\n\r\n      let n = this.vertices.length;\r\n\r\n      if (n > 2) {\r\n        let indices: Array<number> = [];\r\n\r\n        if (this.getArea() > .0) {\r\n          for (let i = 0; i < n; ++i) indices[i] = i;\r\n        } else {\r\n          for (let i = 0; i < n; ++i) indices[i] = (n - 1) - i;\r\n        }\r\n\r\n        let nv = n;\r\n\r\n        /*  remove nv-2 Vertices, creating 1 triangle every time */\r\n        let count = 2 * nv;   /* error detection */\r\n\r\n        for (let m = 0, v = nv - 1; nv > 2;) {\r\n          /* if we loop, it is probably a non-simple polygon */\r\n          if (0 >= count--) {\r\n            return new Polygon2D();\r\n          }\r\n\r\n          /* three consecutive vertices in current polygon, <u,v,w> */\r\n          let u = v; if (nv <= u) u = 0;     /* previous */\r\n          v = u + 1; if (nv <= v) v = 0;     /* new v    */\r\n          let w = v + 1; if (nv <= w) w = 0;     /* next     */\r\n\r\n          if (this.snip(u, v, w, nv, indices)) {\r\n            let a, b, c, s, t;\r\n\r\n            /* true names of the vertices */\r\n            a = indices[u]; b = indices[v]; c = indices[w];\r\n\r\n            /* output Triangle */\r\n            result.addVector(this.vertices[c]);\r\n            result.addVector(this.vertices[b]);\r\n            result.addVector(this.vertices[a]);\r\n\r\n            ++m;\r\n\r\n            /* remove v from remaining polygon */\r\n            for (s = v, t = v + 1; t < nv; s++ , t++) {\r\n              indices[s] = indices[t];\r\n            }\r\n            --nv;\r\n\r\n            /* reset error detection counter */\r\n            count = 2 * nv;\r\n          }\r\n        }\r\n      }\r\n\r\n      return result;\r\n    }\r\n  }\r\n\r\n  export class AABB2D {\r\n    public minX: number = +Infinity;\r\n    public maxX: number = -Infinity;\r\n    public minY: number = +Infinity;\r\n    public maxY: number = -Infinity;\r\n\r\n    public addPoint(x: number, y: number) {\r\n      this.minX = Math.min(this.minX, x);\r\n      this.maxX = Math.max(this.maxX, x);\r\n      this.minY = Math.min(this.minY, y);\r\n      this.maxY = Math.max(this.maxY, y);\r\n    }\r\n\r\n    public addVector(v: Vec2 | Vec3 | Vec4) {\r\n      this.addPoint(v.x, v.y);\r\n    }\r\n\r\n    public addAABB(box: AABB2D) {\r\n      this.addPoint(box.minX, box.minY);\r\n      this.addPoint(box.maxX, box.maxY);\r\n    }\r\n\r\n    public clear() {\r\n      this.minX = +Infinity;\r\n      this.maxX = -Infinity;\r\n      this.minY = +Infinity;\r\n      this.maxY = -Infinity;\r\n    }\r\n\r\n    public center(): Vec2 {\r\n      return new Vec2(\r\n        .5 * (this.minX + this.maxX),\r\n        .5 * (this.minY + this.maxY)\r\n      );\r\n    }\r\n\r\n    public extents(): Vec2 {\r\n      return new Vec2(\r\n        (this.maxX - this.minX),\r\n        (this.maxY - this.minY)\r\n      );\r\n    }\r\n\r\n    public min(): Vec2 {\r\n      return new Vec2(\r\n        this.minX,\r\n        this.minY\r\n      );\r\n    }\r\n\r\n    public max(): Vec2 {\r\n      return new Vec2(\r\n        this.maxX,\r\n        this.maxY\r\n      );\r\n    }\r\n\r\n    public contains(v: Vec2 | Vec3 | Vec4) {\r\n      return v.x >= this.minX && v.x <= this.maxX &&\r\n        v.y >= this.minY && v.y <= this.maxY\r\n    }\r\n  }\r\n\r\n  /** Represents a point in 3D space using spherical coordinates.\r\n   */\r\n  export class Spherical {\r\n\r\n    public r = 0;\r\n    public azimuth = 0;\r\n    public polar = 0;\r\n\r\n    public constructor(r: number, azimuth: number, polar: number) {\r\n      this.r = r;\r\n      this.azimuth = azimuth;\r\n      this.polar = polar;\r\n    }\r\n\r\n    /** Converts cartesian coordinates x,y,z to spherical coordinates.\r\n      */\r\n    public static FromCartesian(x: number, y: number, z: number): Spherical {\r\n      let r = Math.sqrt(x * x + y * y + z * z);\r\n      return new Spherical(\r\n        r,\r\n        Math.asin(y / r),\r\n        Math.atan2(-x, z));\r\n    }\r\n\r\n    /** Converts cartesian vector to spherical coordinates.\r\n      */\r\n    public static FromCartesianVector(v: Vec4 | Vec3) {\r\n      return Spherical.FromCartesian(v.x, v.y, v.z);\r\n    }\r\n\r\n    /** Converts spherical coordinates to cartesian vector.\r\n      */\r\n    public static ToCartesian(r: number, polar: number, azimuth: number): Vec4 {\r\n      return new Vec4(r * Math.cos(polar) * Math.sin(azimuth),\r\n        -r * Math.sin(polar),\r\n        -r * Math.cos(polar) * Math.cos(azimuth));\r\n    }\r\n\r\n    /** Converts spherical coordinates to cartesian vector.\r\n      */\r\n    public toCartesian(): Vec4 {\r\n      return new Vec4(this.r * Math.cos(this.polar) * Math.sin(this.azimuth),\r\n        -this.r * Math.sin(this.polar),\r\n        -this.r * Math.cos(this.polar) * Math.cos(this.azimuth));\r\n    }\r\n\r\n    }\r\n}\r\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","/// ModelStage Â© 2018 Plansysteme GmbH, Hamburg, Germany. All rights reserved.\r\n\r\nimport { psgeometry } from './ps-geometry';\r\nimport { HubConnectionBuilder, LogLevel, HubConnection } from '@aspnet/signalr';\r\n\r\nexport module modelstageweb {\r\n\r\n    export function uuidv4(): string {\r\n\r\n        let crypto = window.crypto || (<any>window).msCrypto;\r\n\r\n        return ('' + 1e7 + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, (c: any) =>\r\n            (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16));\r\n    }\r\n\r\n    export class ToolsWebGL {\r\n\r\n        private stage: StageWebGL;\r\n         \r\n        constructor(stage: StageWebGL) {\r\n            this.stage = stage;\r\n        }\r\n\r\n        public createShader(shaderType: GLenum, shaderSource: string): WebGLShader {\r\n            let shader = this.stage.gl.createShader(shaderType);\r\n\r\n            this.stage.gl.shaderSource(shader, shaderSource);\r\n            this.stage.gl.compileShader(shader);\r\n\r\n            console.log(this.stage.gl.getShaderInfoLog(shader));\r\n\r\n            return shader;\r\n        }\r\n    }\r\n\r\n    export class BlockStreamBlockDescriptor {\r\n\r\n        private blockType: string;\r\n\r\n        private majorVersion: number;\r\n\r\n        private minorVersion: number;\r\n\r\n        private flags: number;\r\n\r\n        private payloadBytes: number;\r\n\r\n        public get BlockType() {\r\n            return this.blockType;\r\n        }\r\n\r\n        public set BlockType(value: string) {\r\n            this.blockType = value;\r\n        }\r\n\r\n        public get MajorVersion() {\r\n            return this.majorVersion;\r\n        }\r\n\r\n        public set MajorVersion(value: number) {\r\n            this.majorVersion = value;\r\n        }\r\n\r\n        public get MinorVersion() {\r\n            return this.minorVersion;\r\n        }\r\n\r\n        public set MinorVersion(value: number) {\r\n            this.minorVersion = value;\r\n        }\r\n\r\n        public get Flags() {\r\n            return this.flags;\r\n        }\r\n\r\n        public set Flags(value: number) {\r\n            this.flags = value;\r\n        }\r\n\r\n        public get PayloadBytes() {\r\n            return this.payloadBytes;\r\n        }\r\n\r\n        public set PayloadBytes(value: number) {\r\n            this.payloadBytes = value;\r\n        }\r\n    }\r\n\r\n    export enum BlockStreamReaderStates {\r\n        FILE_HEADER_EXPECTED = 0,\r\n        BLOCK_DESCRIPTOR_EXPECTED = 1,\r\n        PAYLOAD_EXPECTED = 2\r\n    }\r\n\r\n    export class BlockStreamReader {\r\n\r\n        private arrayBuffer: ArrayBuffer = null;\r\n\r\n        private byteArray: Uint8Array = null;\r\n\r\n        private currentPos: number = 0;\r\n\r\n        private currentBlockDescriptor: BlockStreamBlockDescriptor;\r\n\r\n        private blockEnd: number = 0;\r\n\r\n        private isComplete: boolean = false;\r\n\r\n        private fatalError: boolean = false;\r\n\r\n        private state: BlockStreamReaderStates = BlockStreamReaderStates.FILE_HEADER_EXPECTED;\r\n\r\n        public get CurrentBlockDescriptor() {\r\n            return this.currentBlockDescriptor;\r\n        }\r\n\r\n        public get FatalError() {\r\n            return this.fatalError;\r\n        }\r\n\r\n        constructor(buffer: ArrayBuffer) {\r\n            this.arrayBuffer = buffer;\r\n            this.byteArray = new Uint8Array(buffer);\r\n\r\n            this.assureFileHeader();\r\n        }\r\n\r\n        public remainingBytesInBlock(): number {\r\n            return this.blockEnd - this.currentPos;\r\n        }\r\n\r\n        public assureRemainingBytesInBlock(count: number): boolean {\r\n            return this.currentPos + count <= this.blockEnd;\r\n        }\r\n\r\n        public readBytes(count: number): ArrayBuffer\r\n        {\r\n            return this.arrayBuffer.slice(this.currentPos, this.currentPos + count); \r\n        }\r\n\r\n        public tryReadInt16(lambda: (value: number) => void): boolean {\r\n            let result = this.assureRemainingBytesInBlock(2);\r\n\r\n            if (result) {\r\n                lambda(this.byteArray[this.currentPos++] +\r\n                    this.byteArray[this.currentPos++] * 256);\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public tryReadFloat(lambda: (value: number) => void): boolean {\r\n            let result = this.assureRemainingBytesInBlock(4);\r\n\r\n            if (result) {\r\n                let buf = new ArrayBuffer(4);\r\n                let view = new DataView(buf);\r\n                view.setUint8(0, this.byteArray[this.currentPos++]);\r\n                view.setUint8(1, this.byteArray[this.currentPos++]);\r\n                view.setUint8(2, this.byteArray[this.currentPos++]);\r\n                view.setUint8(3, this.byteArray[this.currentPos++]);\r\n\r\n                //let view = new DataView(this.byteArray.buffer, this.currentPos, 4);\r\n                lambda(view.getFloat32(0, true));\r\n                //this.currentPos += 4;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public tryReadInt(lambda: (value: number) => void): boolean {\r\n            let result = this.assureRemainingBytesInBlock(4);\r\n\r\n            if (result) {\r\n                lambda(this.byteArray[this.currentPos++] +\r\n                    this.byteArray[this.currentPos++] * 256 +\r\n                    this.byteArray[this.currentPos++] * 65536 +\r\n                    this.byteArray[this.currentPos++] * 16777216);\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public tryReadInt64(lambda: (value: number) => void): boolean {\r\n            let result = this.assureRemainingBytesInBlock(8);\r\n\r\n            if (result) {\r\n                lambda(this.byteArray[this.currentPos++] +\r\n                    this.byteArray[this.currentPos++] * 256 +\r\n                    this.byteArray[this.currentPos++] * 65536 +\r\n                    this.byteArray[this.currentPos++] * 16777216 +\r\n                    this.byteArray[this.currentPos++] * 4294967296 +\r\n                    this.byteArray[this.currentPos++] * 1099511627776 +\r\n                    this.byteArray[this.currentPos++] * 281474976710656 +\r\n                    this.byteArray[this.currentPos++] * 72057594037927936);\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public tryReadString(lambda: (value: string) => void): boolean {\r\n            let result = false;\r\n\r\n\r\n            this.tryReadInt((stringLength) => {\r\n                let value: string = '';\r\n\r\n                if (this.assureRemainingBytesInBlock(stringLength)) {\r\n                    \r\n                    for (let i: number = 0; i < stringLength; ++i) {\r\n                        value += String.fromCharCode(this.byteArray[this.currentPos++]);\r\n                    }\r\n                }\r\n\r\n                lambda(value);\r\n\r\n                result = true;\r\n            });\r\n\r\n            return result;\r\n        }\r\n\r\n        public readString(): string {\r\n            let result: string = '';\r\n            this.tryReadString((value) => { result = value; });\r\n            return result;\r\n        }\r\n\r\n        public readMatrix4(): psgeometry.Matrix4 {\r\n            let result = new psgeometry.Matrix4();\r\n            for (let i = 0; i < 16; ++i) {\r\n                this.tryReadFloat((val) => { result.elements[i] = val; });\r\n            }\r\n            return result.transpose();\r\n        }\r\n\r\n        private internalReadString(startPos: number, length: number): string {\r\n            let result: string = '';\r\n            for (let i: number = 0; i < length; ++i) {\r\n                result += String.fromCharCode(this.byteArray[startPos + i]);\r\n            }\r\n            return result;\r\n        }\r\n\r\n        private internalReadInt(startPos: number): number {\r\n            return this.byteArray[startPos] +\r\n                this.byteArray[startPos + 1] * 256 +\r\n                this.byteArray[startPos + 2] * 65536 +\r\n                this.byteArray[startPos + 3] * 16777216;\r\n        }\r\n\r\n        private assureFileHeader() {\r\n            if (this.byteArray.byteLength >= 8) {\r\n                if (this.byteArray[0] == 0x70 && // =\"psblstr1\"\r\n                    this.byteArray[1] == 0x73 &&\r\n                    this.byteArray[2] == 0x62 &&\r\n                    this.byteArray[3] == 0x6C &&\r\n                    this.byteArray[4] == 0x73 &&\r\n                    this.byteArray[5] == 0x74 &&\r\n                    this.byteArray[6] == 0x72 &&\r\n                    this.byteArray[7] == 0x31) {\r\n                    this.currentPos += 8;\r\n                    this.state = BlockStreamReaderStates.BLOCK_DESCRIPTOR_EXPECTED;\r\n                } else {\r\n                    this.fatalError = true;\r\n                }\r\n            } else {\r\n                this.fatalError = this.isComplete;\r\n            }\r\n        }\r\n\r\n        public enterBlock(): { success: boolean, descriptor: BlockStreamBlockDescriptor } {\r\n            let result: { success: boolean, descriptor: BlockStreamBlockDescriptor } = { success: false, descriptor: null };\r\n\r\n            if (this.byteArray.byteLength >= this.currentPos + 5) {\r\n                if (this.byteArray[this.currentPos] == 0x70 && // = \"psbl\"\r\n                    this.byteArray[this.currentPos + 1] == 0x73 &&\r\n                    this.byteArray[this.currentPos + 2] == 0x62 &&\r\n                    this.byteArray[this.currentPos + 3] == 0x6C) {\r\n                    let blockTypeLength = this.byteArray[this.currentPos + 4];\r\n                    if (this.byteArray.byteLength >= this.currentPos + 5 + blockTypeLength + 8) {\r\n                        // read the descriptor from stream\r\n                        result.descriptor = new BlockStreamBlockDescriptor();\r\n                        result.descriptor.BlockType = this.internalReadString(this.currentPos + 5, blockTypeLength);\r\n                        result.descriptor.MajorVersion = this.byteArray[this.currentPos + 5 + blockTypeLength];\r\n                        result.descriptor.MinorVersion = this.byteArray[this.currentPos + 5 + blockTypeLength + 1];\r\n                        result.descriptor.Flags = this.byteArray[this.currentPos + 5 + blockTypeLength + 2] * 256 + this.byteArray[this.currentPos + 5 + blockTypeLength + 3];\r\n                        result.descriptor.PayloadBytes = this.internalReadInt(this.currentPos + 5 + blockTypeLength + 4);\r\n                        this.state = BlockStreamReaderStates.PAYLOAD_EXPECTED;\r\n                        this.currentPos += 5 + blockTypeLength + 8;\r\n                        this.blockEnd = this.currentPos + result.descriptor.PayloadBytes;\r\n\r\n                        this.currentBlockDescriptor = result.descriptor;\r\n\r\n                        result.success = true;\r\n                    } else {\r\n                        // there are too few bytes to make a full block descriptor, but the stream is completely read\r\n                        this.fatalError = this.isComplete;\r\n                    }\r\n                } else {\r\n                    // no valid block header found\r\n                    this.fatalError = true;\r\n                }\r\n            } else {\r\n                // there are too few bytes to make a block header, but the stream is completely read \r\n                this.fatalError = this.isComplete && (this.byteArray.byteLength > this.currentPos);\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public leaveBlock() {\r\n            this.currentPos = this.blockEnd;\r\n            this.state = BlockStreamReaderStates.BLOCK_DESCRIPTOR_EXPECTED;\r\n        }\r\n    }\r\n\r\n    export class ShaderInstance {\r\n\r\n        private shaderKey: string;\r\n\r\n        private references: { [index: string]: string } = {};\r\n\r\n        private figureID: string;\r\n\r\n        public get FigureID() {\r\n            return this.figureID;\r\n        }\r\n\r\n        public set FigureID(value: string) {\r\n            this.figureID = value;\r\n        }\r\n\r\n        public get ShaderKey() {\r\n            return this.shaderKey;\r\n        }\r\n\r\n        public set ShaderKey(value: string) {\r\n            this.shaderKey = value;\r\n        }\r\n\r\n        public getReference(key: string) {\r\n            return this.references[key];\r\n        }\r\n\r\n        constructor(shaderKey: string) {\r\n            this.shaderKey = shaderKey;\r\n        }\r\n\r\n        public construct(reader: BlockStreamReader) {\r\n        }\r\n\r\n        public addReference(key: string, value: string) {\r\n            this.references[key] = value;\r\n        }\r\n    }\r\n\r\n    export class MeshShaderInstance extends ShaderInstance {\r\n\r\n        SIZE_OF_FLOAT = 4;\r\n\r\n        protected bufferID: string;\r\n\r\n        protected priority: number;\r\n\r\n        constructor(shaderKey: string) {\r\n            super(shaderKey);\r\n        }\r\n\r\n        public construct(reader: BlockStreamReader) {\r\n            if (!reader.tryReadString((id) => { this.bufferID = id; })) {\r\n                this.bufferID = '_default';\r\n            }\r\n            if (!reader.tryReadInt16((priority) => { this.priority = priority; })) {\r\n                this.priority = 0;\r\n            }\r\n        }\r\n\r\n        public getStride(): number {\r\n            return this.ShaderKey == 'TransparentMeshShader' ? 10 * this.SIZE_OF_FLOAT : 9 * this.SIZE_OF_FLOAT;\r\n        }\r\n\r\n    }\r\n\r\n    export class TexturedMeshShaderInstance extends MeshShaderInstance {\r\n\r\n        protected textureID: string;\r\n\r\n        public get TextureID() {\r\n            return this.textureID;\r\n        }\r\n\r\n        constructor(shaderKey: string) {\r\n            super(shaderKey);\r\n        }\r\n\r\n        public construct(reader: BlockStreamReader) {\r\n            let result = reader.tryReadString((textureID) => { this.textureID = textureID; });\r\n\r\n            if (result) {\r\n                this.addReference('TextureBuffer', this.textureID);\r\n\r\n                super.construct(reader);\r\n            }\r\n        }\r\n\r\n        public getStride(): number {\r\n            return 11 * this.SIZE_OF_FLOAT;\r\n        }\r\n\r\n    }\r\n\r\n    function ShaderInstanceFromReader(reader: BlockStreamReader): ShaderInstance {\r\n        let result: ShaderInstance = null;\r\n\r\n        let shaderKey;\r\n        if (reader.tryReadString((key) => { shaderKey = key; })) {\r\n            if (shaderKey == 'OpaqueMeshShader' || shaderKey == 'TransparentMeshShader') {\r\n                result = new MeshShaderInstance(shaderKey);\r\n            }\r\n            else if (shaderKey == 'TexturedMeshShader') {\r\n                result = new TexturedMeshShaderInstance(shaderKey);\r\n            }\r\n\r\n            if (result) {\r\n                result.construct(reader);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    export class Mesh3DLib {\r\n        private rootNode: NodeAsset;\r\n\r\n        public constructor(private objectNamePrefix: string) {\r\n        }\r\n\r\n        public setRootNode(rootNode: NodeAsset) {\r\n            this.rootNode = rootNode;\r\n        }\r\n\r\n        public getNodeFromPath(path: string): NodeAsset {\r\n            if (path.length == 0 || !this.rootNode || this.rootNode.Name == path) {\r\n                return this.rootNode;\r\n            }\r\n            else {\r\n                return this.rootNode.getChildNodeFromPath(path.substr(this.rootNode.Name.length));\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    export class AssetFactoryWebGL {\r\n\r\n        private lastPercentage = -1;\r\n\r\n        private stage: StageWebGL;\r\n\r\n        private currentFigure: FigureWebGL;\r\n\r\n        private currentShaderInstance: ShaderInstance;\r\n\r\n        private currentSceneMesh3DLib: Mesh3DLib;\r\n\r\n        constructor(stage: StageWebGL) {\r\n            this.stage = stage;\r\n        }\r\n\r\n        protected createFigure(reader: BlockStreamReader, stage: StageWebGL, assetStore: AssetStoreWebGL) {\r\n            this.currentFigure = new FigureWebGL(reader.readString());\r\n\r\n            if (this.currentSceneMesh3DLib) {\r\n                reader.tryReadString((nodePath) => {\r\n                    this.currentFigure.Node = this.currentSceneMesh3DLib.getNodeFromPath(nodePath);\r\n                });\r\n            }\r\n\r\n\r\n            assetStore.addFigure(this.currentFigure);\r\n            return true;\r\n        }\r\n\r\n        protected createMesh(reader: BlockStreamReader, stage: StageWebGL, assetStore: AssetStoreWebGL) {\r\n            let result: boolean = false;\r\n\r\n            this.currentShaderInstance = ShaderInstanceFromReader(reader);\r\n\r\n            if (this.currentShaderInstance && this.currentFigure) {\r\n                this.currentFigure.addShaderInstance(this.currentShaderInstance);\r\n                result = true;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        protected createMeshBuffer(reader: BlockStreamReader, stage: StageWebGL, assetStore: AssetStoreWebGL) {\r\n            let bufferAsset = new BufferAssetWebGL(reader, 'VertexBuffer', false);\r\n            let currentID: string = bufferAsset.BufferID;\r\n            let counter = 1;\r\n            while (assetStore.getBufferAsset(currentID)) {\r\n                currentID = bufferAsset.BufferID + counter++;\r\n            }\r\n            bufferAsset.BufferID = currentID;\r\n            assetStore.addBufferAsset(currentID, bufferAsset);\r\n\r\n            if (this.currentShaderInstance && this.currentFigure) {\r\n                // extract triangles from vertex buffer, this information is used by Octree to determine triangle data from triangle indices stored in Octree data structure.\r\n                // this.currentShaderInstance.pushTriangles(this.currentFigure.getTriangles(), bufferAsset.getBufferData(), bufferAsset.getBufferSize());\r\n            }\r\n\r\n            bufferAsset.initialize(stage);\r\n\r\n            if (this.currentShaderInstance) {\r\n                this.currentShaderInstance.addReference('VertexBuffer', bufferAsset.BufferID);\r\n            }\r\n        }\r\n\r\n        protected createMeshIndicesBuffer(reader: BlockStreamReader, stage: StageWebGL, assetStore: AssetStoreWebGL) {\r\n            let bufferAsset = new BufferAssetWebGL(reader, 'IndexBuffer', true);\r\n            let currentID = bufferAsset.BufferID;\r\n            let counter = 1;\r\n            while (assetStore.getBufferAsset(currentID)) {\r\n                currentID = bufferAsset.BufferID + counter++;\r\n            }\r\n            bufferAsset.BufferID = currentID;\r\n            assetStore.addBufferAsset(currentID, bufferAsset);\r\n\r\n            bufferAsset.initialize(stage);\r\n\r\n            if (this.currentShaderInstance) {\r\n                this.currentShaderInstance.addReference('IndexBuffer', bufferAsset.BufferID);\r\n            }\r\n        }\r\n\r\n        protected createTexture(reader: BlockStreamReader, stage: StageWebGL, assetStore: AssetStoreWebGL, deferreds: Array<JQuery.Deferred<boolean>>) {\r\n            let textureName: string; \r\n            let pixelDataSize;\r\n            if (reader.tryReadString((value) => { textureName = value; }) && reader.tryReadInt64((value) => { pixelDataSize = value; })) {\r\n                let imageData = reader.readBytes(pixelDataSize);\r\n                let extension = textureName.substr(textureName.lastIndexOf('.')).toLowerCase();\r\n                let imageType = 'jpeg';\r\n                if (extension == '.png') {\r\n                    imageType = 'png';\r\n                }\r\n                let blob = new Blob([imageData], { 'type': 'image/' + imageType });\r\n                let url = URL.createObjectURL(blob);\r\n                let image = new Image();\r\n\r\n                let deferred = $.Deferred();\r\n                deferreds.push(deferred);\r\n                image.onload = () => {\r\n                    this.stage.AssetStore.addTextureAsset(textureName, new TextureAssetWebGL(this.stage, image));\r\n                    deferred.resolve();\r\n                }\r\n                image.onerror = () => {\r\n                    console.error('Error processing texture blob ' + textureName);\r\n                    deferred.reject();\r\n                }\r\n                image.src = url;\r\n            }\r\n        }\r\n\r\n        protected createOctree(reader: BlockStreamReader, stage: StageWebGL, assetStore: AssetStoreWebGL) {\r\n            this.currentFigure.setIntersector(Octree.CreateFromBlockStream(reader));\r\n        }\r\n\r\n        protected createScene(reader: BlockStreamReader, stage: StageWebGL, assetStore: AssetStoreWebGL) {\r\n            this.currentSceneMesh3DLib = new Mesh3DLib(reader.readString());\r\n        }\r\n\r\n        protected createRootNode(reader: BlockStreamReader, stage: StageWebGL, assetStore: AssetStoreWebGL) {\r\n            if (this.currentSceneMesh3DLib) {\r\n                let rootNode = NodeAsset.FromBlockStream(reader, this.currentSceneMesh3DLib);\r\n                this.currentSceneMesh3DLib.setRootNode(rootNode);\r\n                this.stage.AssetStore.addRootNode(rootNode);\r\n            }\r\n        }\r\n\r\n        private processBlock(blockType: string, reader: BlockStreamReader, stage: StageWebGL, assetStore: AssetStoreWebGL, deferreds: Array<JQuery.Deferred<boolean>>) {\r\n            if (blockType == 'PSScene') {\r\n                this.createScene(reader, stage, assetStore);\r\n            }\r\n            else if (blockType == 'PSFigure') {\r\n                this.createFigure(reader, stage, assetStore);\r\n            }\r\n            else if (blockType == 'PSMesh') {\r\n                this.createMesh(reader, stage, assetStore);\r\n            }\r\n            else if (blockType == 'PSMeshData') {\r\n                this.createMeshBuffer(reader, stage, assetStore);\r\n            }\r\n            else if (blockType == 'PSMeshIndices') {\r\n                this.createMeshIndicesBuffer(reader, stage, assetStore);\r\n            }\r\n            else if (blockType == 'PSTexture') {\r\n                this.createTexture(reader, stage, assetStore, deferreds);\r\n            }\r\n            else if (blockType == 'PSMeshOctree') {\r\n                this.createOctree(reader, stage, assetStore);\r\n            }\r\n            else if (blockType == 'PSRootNode') {\r\n                this.createRootNode(reader, stage, assetStore);\r\n            }\r\n\r\n        }\r\n\r\n        private loadFromArrayBuffer(buffer: ArrayBuffer): JQuery.Deferred<boolean> {\r\n            let deferreds: Array<JQuery.Deferred<boolean>> = [];\r\n\r\n            let assetStore = this.stage.AssetStore;\r\n\r\n            let reader: BlockStreamReader = new BlockStreamReader(buffer);\r\n            try {\r\n                let res = reader.enterBlock();\r\n                while (res.success) {\r\n                    this.processBlock(res.descriptor.BlockType, reader, this.stage, assetStore, deferreds);\r\n                    reader.leaveBlock();\r\n                    res = reader.enterBlock();\r\n                }\r\n            }\r\n            catch (error) {\r\n                console.log(JSON.stringify(error));\r\n            }\r\n\r\n            return $.when.apply($, deferreds);\r\n        }\r\n\r\n        public getFromUrl(url: string): JQuery.Deferred<Boolean> {\r\n            let deferred: JQuery.Deferred<Boolean> = $.Deferred();\r\n\r\n            let req: XMLHttpRequest = new XMLHttpRequest();\r\n\r\n            req.open('GET', url, true);\r\n            req.responseType = 'arraybuffer';\r\n\r\n            req.onload = (event) => {\r\n                this.loadFromArrayBuffer(<ArrayBuffer>req.response).done(() => {\r\n                    deferred.resolve(true);\r\n                });\r\n            };\r\n\r\n            req.onerror = (event) => {\r\n                deferred.reject(event);\r\n            };\r\n\r\n            req.addEventListener('progress', (oEvent) => {\r\n                if (oEvent.lengthComputable) {\r\n                    let percentComplete = oEvent.loaded / oEvent.total;\r\n                    if (this.lastPercentage != Math.floor(percentComplete * 100)) {\r\n                        this.lastPercentage = Math.floor(percentComplete * 100);\r\n                        deferred.notify(Math.round(percentComplete * 100));\r\n                    }\r\n                } else {\r\n                    // Unable to compute progress information since the total size is unknown\r\n                }\r\n            });\r\n\r\n            req.send(null);\r\n\r\n            return deferred;\r\n        }\r\n\r\n    }\r\n\r\n    export interface Intersector {\r\n        getBoundingBox(): psgeometry.AABB3D;\r\n    }\r\n\r\n    export class BoundingBoxIntersector implements Intersector {\r\n        constructor(private boundingBox: psgeometry.AABB3D) {\r\n        }\r\n\r\n        public getBoundingBox(): psgeometry.AABB3D {\r\n            return this.boundingBox;\r\n        }\r\n    }\r\n\r\n    export class Octree implements Intersector {\r\n        private boundingBox = new psgeometry.AABB3D();\r\n\r\n        static CreateFromBlockStream(reader: BlockStreamReader): Octree {\r\n            let octree = new Octree();\r\n            let x0, y0, z0, x1, y1, z1;\r\n            let levels;\r\n             \r\n            if (reader.tryReadInt((val) => { levels = val; }) &&\r\n                reader.tryReadFloat((val) => x0 = val) &&\r\n                reader.tryReadFloat((val) => y0 = val) &&\r\n                reader.tryReadFloat((val) => z0 = val) &&\r\n                reader.tryReadFloat((val) => x1 = val) &&\r\n                reader.tryReadFloat((val) => y1 = val) &&\r\n                reader.tryReadFloat((val) => z1 = val)) {\r\n                octree.boundingBox.addPoint(x0, y0, z0);\r\n                octree.boundingBox.addPoint(x1, y1, z1);\r\n            }\r\n            \r\n            return octree;\r\n        }\r\n\r\n        public getBoundingBox(): psgeometry.AABB3D {\r\n            return this.boundingBox;\r\n        }\r\n\r\n    }\r\n\r\n    export class FigureWebGL {\r\n\r\n        private figureID: string;\r\n\r\n        private shaderInstances: ShaderInstance[] = [];\r\n\r\n        private intersector: Intersector;\r\n\r\n        private node: NodeAsset;\r\n\r\n        public get Node() {\r\n            return this.node;\r\n        }\r\n\r\n        public set Node(value: NodeAsset) {\r\n            this.node = value;\r\n        }\r\n\r\n        public get FigureID() {\r\n            return this.figureID;\r\n        }\r\n\r\n        public get ShaderInstances() {\r\n            return this.shaderInstances;\r\n        }\r\n\r\n        constructor(figureID: string) {\r\n            this.figureID = figureID;\r\n        }\r\n\r\n        public getBoundingBox(): psgeometry.AABB3D {\r\n            if (this.intersector) {\r\n                return this.Node ? this.intersector.getBoundingBox().transform(this.Node.AbsoluteTransformation) : this.intersector.getBoundingBox();\r\n            } else {\r\n                return new psgeometry.AABB3D();\r\n            }\r\n        }\r\n\r\n        public addShaderInstance(shaderInstance: ShaderInstance) {\r\n            this.shaderInstances.push(shaderInstance);\r\n        }\r\n\r\n        public render(context: RenderContextWebGL) {\r\n            let stage = context.Stage;\r\n\r\n            this.shaderInstances.forEach((shaderInstance) => {\r\n                shaderInstance.FigureID = this.figureID;\r\n                let shaderProgram = stage.getShaderProgram(context, shaderInstance.ShaderKey);\r\n                if (shaderProgram) {\r\n                    context.ShaderProgram = shaderProgram;\r\n                    context.NodeTransform = this.Node ? this.Node.AbsoluteTransformation : null;\r\n                    shaderProgram.render(context, shaderInstance);\r\n                }\r\n            });\r\n        }\r\n\r\n        public setIntersector(intersector: Intersector) {\r\n            this.intersector = intersector;\r\n        }\r\n\r\n        public intersectsBoundingBox(ray: psgeometry.Line3D, at: psgeometry.Vec3) {\r\n            let result = false;\r\n            if (this.intersector) {\r\n                let intersectionPoint = this.intersector.getBoundingBox().intersectsRay(ray);\r\n                if (intersectionPoint) {\r\n                    at.assignVec(intersectionPoint);\r\n                    result = true\r\n                }\r\n            }\r\n            return result;\r\n        }\r\n    }\r\n\r\n    export class AnimationTransformation {\r\n        public static FromBlockStream(reader: BlockStreamReader, mesh3DLib: Mesh3DLib): AnimationTransformation {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    export class NodeAsset {\r\n        private name: string;\r\n\r\n        private parentNode: NodeAsset;\r\n\r\n        private childNodes: { [index: string]: NodeAsset } = {};\r\n\r\n        private localTransformation: psgeometry.Matrix4;\r\n\r\n        private absoluteTransformation: psgeometry.Matrix4;\r\n\r\n        public get Name() {\r\n            return this.name;\r\n        }\r\n\r\n        public get AbsoluteTransformation() {\r\n            return this.absoluteTransformation;\r\n        }\r\n\r\n        public get LocalTransformation() {\r\n            return this.localTransformation;\r\n        }\r\n\r\n        public getChildNodeFromPath(path: string) {\r\n            for (let child in this.childNodes) {\r\n                if (path == this.childNodes[child].Name) {\r\n                    return this.childNodes[child];\r\n                }\r\n            }\r\n            for (let child in this.childNodes) {\r\n                if (path.substring(0, this.childNodes[child].Name.length) == this.childNodes[child].Name) {\r\n                    return this.childNodes[child].getChildNodeFromPath(path.substr(this.childNodes[child].Name.length));\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n\r\n\r\n        public static FromBlockStream(reader: BlockStreamReader, mesh3DLib: Mesh3DLib, parentNode?: NodeAsset): NodeAsset {\r\n            let result = new NodeAsset();\r\n\r\n            result.name = reader.readString();\r\n            result.localTransformation = reader.readMatrix4();\r\n            result.absoluteTransformation = NodeAsset.calculateAbsoluteTransformation(result.localTransformation, parentNode);\r\n            result.parentNode = parentNode;\r\n            result.readChildNodes(reader, mesh3DLib);\r\n            result.readAnimationTransformations(reader, mesh3DLib);\r\n\r\n            return result;\r\n        }\r\n\r\n        private static calculateAbsoluteTransformation(localTransformation: psgeometry.Matrix4, parentNode: NodeAsset): psgeometry.Matrix4 {\r\n            if (parentNode) {\r\n                return <psgeometry.Matrix4>localTransformation.multiply(parentNode.AbsoluteTransformation);\r\n            }\r\n            else {\r\n                return localTransformation;\r\n            }\r\n        }\r\n\r\n        private readChildNodes(reader: BlockStreamReader, mesh3DLib: Mesh3DLib) {\r\n            reader.tryReadInt((childNameCount) => {\r\n                for (let i = 0; i < childNameCount; ++i) {\r\n                    this.addChildNode(NodeAsset.FromBlockStream(reader, mesh3DLib, this));\r\n                }\r\n            });\r\n        }\r\n\r\n        private readAnimationTransformations(reader: BlockStreamReader, mesh3DLib: Mesh3DLib) {\r\n            reader.tryReadInt((numAnimationTransformations) => {\r\n                for (let i = 0; i < numAnimationTransformations; ++i) {\r\n                    this.addAnimationTransformation(AnimationTransformation.FromBlockStream(reader, mesh3DLib));\r\n                }\r\n            });\r\n        }\r\n\r\n        private addChildNode(node: NodeAsset) {\r\n            this.childNodes[node.Name] = node;\r\n        } \r\n\r\n        private addAnimationTransformation(animationTransformation: AnimationTransformation) {\r\n\r\n        }\r\n    }\r\n\r\n    export class BufferAssetWebGL {\r\n\r\n        private bufferID: string;\r\n\r\n        private bufferSize: number = 0;\r\n\r\n        public bufferData: ArrayBuffer | SharedArrayBuffer;\r\n\r\n        private webGLBuffer: WebGLBuffer;\r\n\r\n        private isElementBuffer: boolean = false;\r\n\r\n        public get BufferID() {\r\n            return this.bufferID;\r\n        }\r\n\r\n        public set BufferID(value: string) {\r\n            this.bufferID = value;\r\n        }\r\n\r\n        public get Buffer() {\r\n            return this.webGLBuffer;\r\n        }\r\n\r\n        public get BufferSize() {\r\n            return this.bufferSize;\r\n        }\r\n\r\n        public set BufferSize(value: number) {\r\n            this.bufferSize = value;\r\n        }\r\n\r\n        constructor(reader: BlockStreamReader, bufferID: string, isElementBuffer: boolean) {\r\n            this.bufferID = bufferID;\r\n            this.isElementBuffer = isElementBuffer;\r\n\r\n            if (reader) {\r\n                let descriptor = reader.CurrentBlockDescriptor;\r\n                if (descriptor) {\r\n\r\n                    // read additional meta data if available\r\n                    if (descriptor.MajorVersion > 1) {\r\n                        this.bufferID = reader.readString();\r\n                    }\r\n\r\n                    this.bufferSize = reader.remainingBytesInBlock();\r\n                    this.bufferData = reader.readBytes(this.bufferSize);\r\n                }\r\n            }\r\n        }\r\n\r\n        public initialize(stage: StageWebGL) {\r\n            this.webGLBuffer = stage.gl.createBuffer();\r\n\r\n            if (this.isElementBuffer) {\r\n                stage.gl.bindBuffer(stage.gl.ELEMENT_ARRAY_BUFFER, this.webGLBuffer);\r\n                stage.gl.bufferData(stage.gl.ELEMENT_ARRAY_BUFFER, <ArrayBuffer>this.bufferData, stage.gl.STATIC_DRAW);\r\n            } else {\r\n                stage.gl.bindBuffer(stage.gl.ARRAY_BUFFER, this.webGLBuffer);\r\n                stage.gl.bufferData(stage.gl.ARRAY_BUFFER, <ArrayBuffer>this.bufferData, stage.gl.STATIC_DRAW);\r\n            }\r\n        }\r\n\r\n        public bind(stage: StageWebGL) {\r\n            if (this.isElementBuffer) {\r\n                stage.gl.bindBuffer(stage.gl.ELEMENT_ARRAY_BUFFER, this.webGLBuffer);\r\n            } else {\r\n                stage.gl.bindBuffer(stage.gl.ARRAY_BUFFER, this.webGLBuffer);\r\n            }\r\n        }\r\n\r\n        public bindInterleaved(stage: StageWebGL, attributeLocation: number, size: number, stride: number, offset: number) {\r\n            if (attributeLocation >= 0) {\r\n                stage.gl.bindBuffer(stage.gl.ARRAY_BUFFER, this.webGLBuffer);\r\n                stage.gl.enableVertexAttribArray(attributeLocation);\r\n                stage.gl.vertexAttribPointer(attributeLocation, size, stage.gl.FLOAT, false, stride, offset);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    export class OpaqueMeshBuilder {\r\n\r\n        private vertices: Array<number> = [];\r\n\r\n        private indices: Array<number> = [];\r\n\r\n        private vertBufferAsset: BufferAssetWebGL;\r\n\r\n        private indBufferAsset: BufferAssetWebGL;\r\n\r\n        constructor() {\r\n        }\r\n\r\n        public addTri(x0: number, y0: number, z0: number,\r\n            x1: number, y1: number, z1: number,\r\n            x2: number, y2: number, z2: number,\r\n            r: number, g: number, b: number, doubleSided?: boolean) {\r\n\r\n            this.vertices.push(\r\n                x0, y0, z0, 0, 0, 1, r, g, b,\r\n                x1, y1, z1, 0, 0, 1, r, g, b,\r\n                x2, y2, z2, 0, 0, 1, r, g, b);\r\n\r\n            let i = this.indices.length;\r\n            this.indices.push(i, i + 1, i + 2);\r\n\r\n            if (doubleSided) {\r\n                this.vertices.push(\r\n                    x1, y1, z1, 0, 0, 1, r, g, b,\r\n                    x0, y0, z0, 0, 0, 1, r, g, b,\r\n                    x2, y2, z2, 0, 0, 1, r, g, b);\r\n\r\n                i = this.indices.length;\r\n                this.indices.push(i, i + 1, i + 2);\r\n            }\r\n        }\r\n\r\n        public addQuad(x0: number, y0: number, z0: number,\r\n            x1: number, y1: number, z1: number,\r\n            x2: number, y2: number, z2: number,\r\n            x3: number, y3: number, z3: number,\r\n            r: number, g: number, b: number, doubleSided?: boolean) {\r\n\r\n            this.addTri(x0, y0, z0,\r\n                x1, y1, z1,\r\n                x2, y2, z2,\r\n                r, g, b, doubleSided);\r\n            this.addTri(x0, y0, z0,\r\n                x2, y2, z2,\r\n                x3, y3, z3,\r\n                r, g, b, doubleSided);\r\n        }\r\n\r\n        public addStroke(x0: number, y0: number, z0: number,\r\n            x1: number, y1: number, z1: number,\r\n            r: number, g: number, b: number) {\r\n\r\n            let dir = new psgeometry.Vec3(x1, y1, z1).sub(new psgeometry.Vec3(x0, y0, z0));\r\n            let radius = dir.norm();\r\n            let azimuth = Math.atan2(-dir.z, dir.x);\r\n            let polar = Math.asin(dir.y / radius);\r\n\r\n            let thickness = .01;\r\n            let up = <psgeometry.Vec4>psgeometry.Matrix4.FromRotation(azimuth, polar, 0).multiply(new psgeometry.Vec4(0, thickness, 0, 1));\r\n            let front = <psgeometry.Vec4>psgeometry.Matrix4.FromRotation(azimuth, polar, 0).multiply(new psgeometry.Vec4(0, 0, thickness, 1));\r\n\r\n            this.addQuad(x0 + up.x - front.x, y0 + up.y - front.y, z0 + up.z - front.z,\r\n                x1 + up.x - front.x, y1 + up.y - front.y, z1 + up.z - front.z,\r\n                x1 - up.x - front.x, y1 - up.y - front.y, z1 - up.z - front.z,\r\n                x0 - up.x - front.x, y0 - up.y - front.y, z0 - up.z - front.z,\r\n                r, g, b);\r\n\r\n            this.addQuad(x0 - up.x + front.x, y0 - up.y + front.y, z0 - up.z + front.z,\r\n                x1 - up.x + front.x, y1 - up.y + front.y, z1 - up.z + front.z,\r\n                x1 + up.x + front.x, y1 + up.y + front.y, z1 + up.z + front.z,\r\n                x0 + up.x + front.x, y0 + up.y + front.y, z0 + up.z + front.z,\r\n                r, g, b);\r\n\r\n            this.addQuad(x0 - up.x - front.x, y0 - up.y - front.y, z0 - up.z - front.z,\r\n                x1 - up.x - front.x, y1 - up.y - front.y, z1 - up.z - front.z,\r\n                x1 - up.x + front.x, y1 - up.y + front.y, z1 - up.z + front.z,\r\n                x0 - up.x + front.x, y0 - up.y + front.y, z0 - up.z + front.z,\r\n                r, g, b);\r\n\r\n            this.addQuad(x0 + up.x + front.x, y0 + up.y + front.y, z0 + up.z + front.z,\r\n                x1 + up.x + front.x, y1 + up.y + front.y, z1 + up.z + front.z,\r\n                x1 + up.x - front.x, y1 + up.y - front.y, z1 + up.z - front.z,\r\n                x0 + up.x - front.x, y0 + up.y - front.y, z0 + up.z - front.z,\r\n                r, g, b);\r\n\r\n        }\r\n\r\n        public initialize(stage: StageWebGL) {\r\n            let vertBuf = new Float32Array(this.vertices.length);\r\n            vertBuf.set(this.vertices);\r\n            this.vertBufferAsset.bufferData = vertBuf.buffer;\r\n            this.vertBufferAsset.BufferSize = this.indices.length * 9 * 4;\r\n\r\n            let indBuf = new Int32Array(this.indices.length);\r\n            indBuf.set(this.indices);\r\n            this.indBufferAsset.bufferData = indBuf.buffer;\r\n\r\n            this.vertBufferAsset.initialize(stage);\r\n            this.indBufferAsset.initialize(stage);\r\n        }\r\n\r\n        public createFigure(stage: StageWebGL, figureID: string): FigureWebGL {\r\n            this.indBufferAsset = new modelstageweb.BufferAssetWebGL(undefined, figureID + '_indices', true);\r\n            this.vertBufferAsset = new modelstageweb.BufferAssetWebGL(undefined, figureID + '_vertices', false);\r\n\r\n            this.initialize(stage);\r\n\r\n            stage.AssetStore.addBufferAsset(figureID + '_indices', this.indBufferAsset);\r\n            stage.AssetStore.addBufferAsset(figureID + '_vertices', this.vertBufferAsset);\r\n\r\n            let shaderInstance = new modelstageweb.MeshShaderInstance('OpaqueMeshShader');\r\n            shaderInstance.addReference('IndexBuffer', figureID + '_indices');\r\n            shaderInstance.addReference('VertexBuffer', figureID + '_vertices');\r\n\r\n            let figure = new modelstageweb.FigureWebGL(figureID);\r\n            figure.addShaderInstance(shaderInstance);\r\n\r\n            return figure;\r\n        }\r\n    }\r\n\r\n    export class TransparentMeshBuilder {\r\n\r\n        private vertices: Array<number> = [];\r\n\r\n        private indices: Array<number> = [];\r\n\r\n        constructor(protected vertBufferAsset: BufferAssetWebGL, protected indBufferAsset: BufferAssetWebGL) {\r\n        }\r\n\r\n        public addTri(x0: number, y0: number, z0: number,\r\n            x1: number, y1: number, z1: number,\r\n            x2: number, y2: number, z2: number,\r\n            r: number, g: number, b: number, a: number, twoSided?: boolean) {\r\n\r\n            this.vertices.push(\r\n                x0, y0, z0, 0, 0, 1, r, g, b, a,\r\n                x1, y1, z1, 0, 0, 1, r, g, b, a,\r\n                x2, y2, z2, 0, 0, 1, r, g, b, a);\r\n\r\n            let i = this.indices.length;\r\n            this.indices.push(i, i + 1, i + 2);\r\n\r\n            if (twoSided) {\r\n                this.addTri(x0, y0, z0,\r\n                    x2, y2, z2,\r\n                    x1, y1, z1,\r\n                    r, g, b, a);\r\n            }\r\n        }\r\n\r\n        public addQuad(x0: number, y0: number, z0: number,\r\n            x1: number, y1: number, z1: number,\r\n            x2: number, y2: number, z2: number,\r\n            x3: number, y3: number, z3: number,\r\n            r: number, g: number, b: number, a: number, twoSided?: boolean) {\r\n\r\n            this.addTri(x0, y0, z0,\r\n                x1, y1, z1,\r\n                x2, y2, z2,\r\n                r, g, b, a, twoSided);\r\n            this.addTri(x0, y0, z0,\r\n                x2, y2, z2,\r\n                x3, y3, z3,\r\n                r, g, b, a, twoSided);\r\n        }\r\n\r\n        public initialize(stage: StageWebGL) {\r\n            let vertBuf = new Float32Array(this.vertices.length);\r\n            vertBuf.set(this.vertices);\r\n            this.vertBufferAsset.bufferData = vertBuf.buffer;\r\n            this.vertBufferAsset.BufferSize = this.indices.length * 10 * 4;\r\n\r\n            let indBuf = new Int32Array(this.indices.length);\r\n            indBuf.set(this.indices);\r\n            this.indBufferAsset.bufferData = indBuf.buffer;\r\n\r\n            this.vertBufferAsset.initialize(stage);\r\n            this.indBufferAsset.initialize(stage);\r\n        }\r\n    }\r\n\r\n    export class TexturedMeshBuilder {\r\n\r\n        private vertices: Array<number> = [];\r\n\r\n        private indices: Array<number> = [];\r\n\r\n        constructor(protected vertBufferAsset: BufferAssetWebGL, protected indBufferAsset: BufferAssetWebGL) {\r\n        }\r\n\r\n        public addTri(x0: number, y0: number, z0: number, u0: number, v0: number,\r\n            x1: number, y1: number, z1: number, u1: number, v1: number,\r\n            x2: number, y2: number, z2: number, u2: number, v2: number,\r\n            r: number, g: number, b: number, twoSided?: boolean) {\r\n\r\n            this.vertices.push(\r\n                x0, y0, z0, 0, 0, 1, r, g, b, u0, v0,\r\n                x1, y1, z1, 0, 0, 1, r, g, b, u1, v1,\r\n                x2, y2, z2, 0, 0, 1, r, g, b, u2, v2);\r\n\r\n            let i = this.indices.length;\r\n            this.indices.push(i, i + 1, i + 2);\r\n\r\n            if (twoSided) {\r\n                this.addTri(x0, y0, z0, u0, v0,\r\n                    x2, y2, z2, u2, v2,\r\n                    x1, y1, z1, u1, v1,\r\n                    r, g, b);\r\n            }\r\n        }\r\n\r\n        public addQuad(x0: number, y0: number, z0: number, u0: number, v0: number,\r\n            x1: number, y1: number, z1: number, u1: number, v1: number,\r\n            x2: number, y2: number, z2: number, u2: number, v2: number,\r\n            x3: number, y3: number, z3: number, u3: number, v3: number,\r\n            r: number, g: number, b: number, twoSided?: boolean) {\r\n\r\n            this.addTri(x0, y0, z0, u0, v0,\r\n                x1, y1, z1, u1, v1,\r\n                x2, y2, z2, u2, v2,\r\n                r, g, b, twoSided);\r\n            this.addTri(x0, y0, z0, u0, v0,\r\n                x2, y2, z2, u2, v2, \r\n                x3, y3, z3, u3, v3,\r\n                r, g, b, twoSided);\r\n        }\r\n\r\n        public initialize(stage: StageWebGL) {\r\n            let vertBuf = new Float32Array(this.vertices.length);\r\n            vertBuf.set(this.vertices);\r\n            this.vertBufferAsset.bufferData = vertBuf.buffer;\r\n            this.vertBufferAsset.BufferSize = this.indices.length * 11 * 4;\r\n\r\n            let indBuf = new Int32Array(this.indices.length);\r\n            indBuf.set(this.indices);\r\n            this.indBufferAsset.bufferData = indBuf.buffer;\r\n\r\n            this.vertBufferAsset.initialize(stage);\r\n            this.indBufferAsset.initialize(stage);\r\n        }\r\n    }\r\n\r\n    export class TextureAssetWebGL {\r\n\r\n        private texture: WebGLTexture;\r\n\r\n        constructor(stage: StageWebGL, image: HTMLImageElement | WebGLTexture) {\r\n            if (image instanceof WebGLTexture) {\r\n                this.texture = image;\r\n            } else {\r\n                this.texture = stage.gl.createTexture();\r\n                stage.gl.bindTexture(stage.gl.TEXTURE_2D, this.texture);\r\n                stage.gl.texImage2D(stage.gl.TEXTURE_2D, 0, stage.gl.RGBA, stage.gl.RGBA, stage.gl.UNSIGNED_BYTE, image);\r\n                stage.gl.texParameteri(stage.gl.TEXTURE_2D, stage.gl.TEXTURE_MAG_FILTER, stage.gl.LINEAR);\r\n                stage.gl.texParameteri(stage.gl.TEXTURE_2D, stage.gl.TEXTURE_MIN_FILTER, stage.gl.LINEAR_MIPMAP_NEAREST);\r\n                stage.gl.generateMipmap(stage.gl.TEXTURE_2D);\r\n                stage.gl.bindTexture(stage.gl.TEXTURE_2D, null);\r\n            }\r\n        }\r\n\r\n        bind(stage: StageWebGL, program: ShaderProgramWebGL, attributeName: string) {\r\n            stage.gl.activeTexture(stage.gl.TEXTURE0);\r\n            stage.gl.uniform1i(stage.gl.getUniformLocation(program.Program, attributeName), 0);\r\n            stage.gl.bindTexture(stage.gl.TEXTURE_2D, this.texture);\r\n        }\r\n\r\n        unbind(stage: StageWebGL, program: ShaderProgramWebGL, attributeName: string) {\r\n            stage.gl.activeTexture(stage.gl.TEXTURE0);\r\n            stage.gl.bindTexture(stage.gl.TEXTURE_2D, null);\r\n        }\r\n\r\n    }\r\n\r\n    /// An asset store class for WebGL.\r\n    export class AssetStoreWebGL {\r\n\r\n        /// All aggregated figures.\r\n        private figures: { [index: string]: FigureWebGL } = {};\r\n\r\n        /// All aggregated nodes assets.\r\n        private rootNodeAssets: { [index: string]: NodeAsset } = {};\r\n\r\n        /// All aggregated buffer assets.\r\n        private bufferAssets: { [index: string]: BufferAssetWebGL } = {};\r\n\r\n        /// All aggregated texture assets.\r\n        private textureAssets: { [index: string]: TextureAssetWebGL } = {};\r\n\r\n\r\n        /// Adds the specified figure to the the store.\r\n        public addFigure(figure: FigureWebGL) {\r\n            this.figures[figure.FigureID] = figure;\r\n        }\r\n\r\n        /// Determines the figure with the the specified id.\r\n        public getFigure(figureID: string): FigureWebGL {\r\n            return this.figures[figureID];\r\n        }\r\n\r\n        /// Adds a buffer asset to the store.\r\n        public addBufferAsset(bufferAssetID: string, bufferAsset: BufferAssetWebGL) {\r\n            this.bufferAssets[bufferAssetID] = bufferAsset;\r\n        }\r\n\r\n        public addRootNode(node: NodeAsset) {\r\n            this.rootNodeAssets[node.Name] = node;\r\n        }\r\n\r\n        /// Determines the buffer asset with the specified id.\r\n        public getBufferAsset(bufferAssetID: string): BufferAssetWebGL {\r\n            return this.bufferAssets[bufferAssetID];\r\n        }\r\n\r\n        /// Adds a texture asset to the store.\r\n        public addTextureAsset(textureAssetID: string, textureAsset: TextureAssetWebGL) {\r\n            this.textureAssets[textureAssetID] = textureAsset;\r\n        }\r\n\r\n        /// Determines the texture asset with the specified id.\r\n        public getTextureAsset(textureAssetID: string): TextureAssetWebGL {\r\n            return this.textureAssets[textureAssetID];\r\n        }\r\n\r\n        /// Returns the map of aggregated figures.\r\n        public get Figures(): { [index: string]: FigureWebGL } {\r\n            return this.figures;\r\n        }\r\n\r\n        public getRootNode(name: string): NodeAsset {\r\n            return this.rootNodeAssets[name];\r\n        }\r\n\r\n    }\r\n\r\n    export interface SceneItemFilterWebGL {\r\n        passes(sceneItem: SceneItemWebGL, context: RenderContextWebGL);\r\n    }\r\n\r\n    export class GenericSceneItemFilterWebGL implements SceneItemFilterWebGL {\r\n        passes(sceneItem: SceneItemWebGL, context: RenderContextWebGL) {\r\n            return context.Phase != 'Shadow';\r\n        }\r\n\r\n    }\r\n\r\n    export class SceneItemWebGL {\r\n\r\n        protected scene: SceneWebGL;\r\n\r\n        protected parent: SceneItemWebGL;\r\n\r\n        protected sceneItemID: string;\r\n\r\n        protected children: Array<SceneItemWebGL> = []\r\n\r\n        protected childrenByKey: { [sceneItemID: string]: SceneItemWebGL } = {}\r\n\r\n        protected isVisible: boolean;\r\n\r\n        protected childrenVisible: boolean;\r\n\r\n        protected testIntersection: boolean;\r\n\r\n        protected testChildrenIntersection: boolean;\r\n\r\n        protected filter: SceneItemFilterWebGL;\r\n\r\n        private data: { [index: string]: any } = {};\r\n\r\n        public get Data(): { [index: string]: any } {\r\n            return this.data;\r\n        }\r\n\r\n        public get Scene() {\r\n            return this.scene;\r\n        }\r\n\r\n        public get SceneItemID() {\r\n            return this.sceneItemID;\r\n        }\r\n\r\n        public get Children() {\r\n            return this.children;\r\n        }\r\n\r\n        public get TestChildrenIntersection() {\r\n            return this.testChildrenIntersection;\r\n        }\r\n\r\n        public set TestChildrenIntersection(val: boolean) {\r\n            this.testChildrenIntersection = val;\r\n        }\r\n\r\n        public get TestIntersection() {\r\n            return this.testIntersection;\r\n        }\r\n\r\n        public set TestIntersection(val: boolean) {\r\n            this.testIntersection = val;\r\n        }\r\n\r\n        public get Filter() { return this.filter; }\r\n\r\n        public set Filter(value: SceneItemFilterWebGL) {\r\n            this.filter = value;\r\n        }\r\n\r\n        constructor(scene: SceneWebGL, sceneItemID: string, isVisible?: boolean, testIntersection?: boolean, childrenVisible?: boolean, testChildrenIntersection?: boolean) {\r\n            this.scene = scene;\r\n            this.sceneItemID = sceneItemID;\r\n            this.isVisible = isVisible || typeof isVisible === 'undefined';\r\n            this.childrenVisible = childrenVisible || typeof childrenVisible === 'undefined';\r\n            this.testIntersection = testIntersection || typeof testIntersection === 'undefined';\r\n            this.testChildrenIntersection = testChildrenIntersection || typeof testChildrenIntersection === 'undefined';\r\n        }\r\n\r\n        public addChild(sceneItem: SceneItemWebGL) {\r\n            this.childrenByKey[sceneItem.sceneItemID] = sceneItem;\r\n            this.children.push(sceneItem);\r\n            sceneItem.addedToSceneGraph(this);\r\n        }\r\n\r\n        public getChild(sceneItemID: string) {\r\n            return this.childrenByKey[sceneItemID];\r\n        }\r\n\r\n        public removeChild(sceneItemID: string) {\r\n            this.children = this.children.filter(sceneItem => sceneItem.sceneItemID != sceneItemID);\r\n            delete this.childrenByKey[sceneItemID];\r\n        }\r\n\r\n        public insertChild(sceneItem: SceneItemWebGL, index: number) {\r\n            this.childrenByKey[sceneItem.sceneItemID] = sceneItem;\r\n            this.children.splice(index, 0, sceneItem);\r\n            sceneItem.addedToSceneGraph(this);\r\n        }\r\n\r\n        protected beginRender(context: RenderContextWebGL) {\r\n        }\r\n\r\n        protected endRender(context: RenderContextWebGL) {\r\n        }\r\n\r\n        public render(context: RenderContextWebGL) {\r\n            if (!this.filter || this.filter.passes(this, context)) {\r\n                if (this.isVisible) {\r\n                    this.beginRender(context);\r\n                    this.renderChildren(context);\r\n                    this.endRender(context);\r\n                } else {\r\n                    this.renderChildren(context);\r\n                }\r\n            }\r\n        }\r\n\r\n        protected renderChildren(context: RenderContextWebGL) {\r\n            if (this.childrenVisible) {\r\n                this.children.forEach((child) => {\r\n                    child.render(context);\r\n                });\r\n            }\r\n        }\r\n\r\n        public addedToSceneGraph(parentSceneItem: SceneItemWebGL) {\r\n            this.scene = parentSceneItem.scene;\r\n            this.parent = parentSceneItem;\r\n        }\r\n\r\n        public intersectsBoundingBox(ray: psgeometry.Line3D, at: psgeometry.Vec3): Boolean {\r\n            return false;\r\n        } \r\n\r\n        protected isIntersectionCandidate(ray: psgeometry.Line3D, at: psgeometry.Vec3): Boolean {\r\n            return this.intersectsBoundingBox(ray, at);\r\n        }\r\n\r\n        public addIntersectionCandidates(ray: psgeometry.Line3D, candidates: Array<IntersectionCandidate>) {\r\n            if (this.testIntersection) {\r\n                let at = new psgeometry.Vec3();\r\n                if (this.isIntersectionCandidate(ray, at)) {\r\n                    candidates.push(new IntersectionCandidate(this, at.squaredDist(ray.p0.asVec3())));\r\n                }\r\n            }\r\n            if (this.testChildrenIntersection) {\r\n                for (let i in this.children) {\r\n                    this.children[i].addIntersectionCandidates(ray, candidates);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    export class ActorWebGL extends SceneItemWebGL {\r\n        private figures: FigureWebGL[] = [];\r\n\r\n        private lastModelTransform: psgeometry.Matrix4;\r\n\r\n        private inverseModelTransform: psgeometry.Matrix4;\r\n\r\n        private state: RenderState = new RenderState();\r\n\r\n        public get State() {\r\n            return this.state;\r\n        }\r\n\r\n        public get Figures() {\r\n            return this.figures;\r\n        }\r\n\r\n        constructor(scene: SceneWebGL, actorID: string) {\r\n            super(scene, actorID);\r\n        }\r\n\r\n        public addFigure(figure: FigureWebGL) {\r\n            this.figures.push(figure);\r\n        }\r\n\r\n        public beginRender(context: RenderContextWebGL) {\r\n            this.figures.forEach((figure) => {\r\n                figure.render(context);\r\n            });\r\n\r\n        }\r\n\r\n        public intersectsBoundingBox(ray: psgeometry.Line3D, at: psgeometry.Vec3): Boolean {\r\n            let transformedRay = this.inverseModelTransform ? ray.transform(this.inverseModelTransform) : ray;\r\n\r\n            let result = false;\r\n            for (let figureIdx in this.figures)\r\n            {\r\n                if (!result) {\r\n                    result = this.figures[figureIdx].intersectsBoundingBox(transformedRay, at);\r\n                    if (result) {\r\n                        at.assignVec(<psgeometry.Vec4>this.lastModelTransform.multiply(at.asVec4()));\r\n                    }\r\n                }\r\n            }\r\n            return result;\r\n        }\r\n\r\n        public render(context: RenderContextWebGL) {\r\n            if (!this.filter || this.filter.passes(this, context)) {\r\n                if (this.isVisible || this.childrenVisible) {\r\n                    context.pushState(this.state);\r\n\r\n                    if (this.isVisible) {\r\n                        this.beginRender(context);\r\n                        this.renderChildren(context);\r\n                        this.endRender(context);\r\n                    } else {\r\n                        this.renderChildren(context);\r\n                    }\r\n\r\n                    let modelTransform = context.NodeTransform ? <psgeometry.Matrix4>context.NodeTransform.multiply(context.ModelTransform) : context.ModelTransform;\r\n                    if (!modelTransform.equals(this.lastModelTransform)) {\r\n                        this.inverseModelTransform = modelTransform.inverse();\r\n                        this.lastModelTransform = modelTransform;\r\n                    }\r\n\r\n                    context.popState();\r\n                }\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    export class IntersectionCandidate {\r\n        public sceneItem: SceneItemWebGL;\r\n\r\n        private squaredDist: number = Infinity;\r\n\r\n        constructor(sceneItem: SceneItemWebGL, squaredDist: number) {\r\n            this.sceneItem = sceneItem;\r\n            this.squaredDist = squaredDist;\r\n        }\r\n\r\n        public compare(intersectionCandidate: IntersectionCandidate) {\r\n            return this.squaredDist < intersectionCandidate.squaredDist ? -1 :\r\n                (this.squaredDist > intersectionCandidate.squaredDist ? 1 : 0);\r\n        }\r\n    }\r\n\r\n    export class RenderState {\r\n        private parent: RenderState;\r\n\r\n        private entries: { [key: string]: any } = {};\r\n\r\n        public get Parent() {\r\n            return this.parent;\r\n        }\r\n\r\n        public set Parent(val: RenderState) {\r\n            this.parent = val;\r\n        }\r\n\r\n        private evaluate(entry: any): any {\r\n            return typeof entry == 'function' ? entry(this) : entry;\r\n        }\r\n\r\n        public contains(key: string) {\r\n            return this.entries[key] != undefined;\r\n        }\r\n\r\n        public get<T>(key: string, defaultValue: T): T {\r\n            let result = defaultValue;\r\n            this.tryGet(key, (val) => { result = val; });\r\n            return result;\r\n        }\r\n\r\n        public tryGet(key: string, lambda: (val: any) => void): boolean {\r\n            if (this.contains(key)) {\r\n                lambda(this.evaluate(this.entries[key]));\r\n                return true;\r\n            } else {\r\n                return this.parent == null ? false : this.parent.tryGet(key, lambda);\r\n            }\r\n        }\r\n\r\n        public set(key: string, value: any) {\r\n            this.entries[key] = value;\r\n        }\r\n    }\r\n\r\n    export class SceneWebGL {\r\n\r\n        private isInitialized: boolean = false;\r\n\r\n        private sceneHierarchy: SceneItemWebGL = new SceneItemWebGL(this, '');\r\n\r\n        private dirty = true;\r\n\r\n        private state = new RenderState();\r\n\r\n        public get SceneHierarchy() {\r\n            return this.sceneHierarchy;\r\n        }\r\n\r\n        public get IsInitialized() {\r\n            return this.isInitialized;\r\n        }\r\n\r\n        public set IsInitialized(value: boolean) {\r\n            this.isInitialized = value;\r\n        }\r\n\r\n        public get State() {\r\n            return this.state;\r\n        }\r\n\r\n        public initialize() {\r\n        }\r\n\r\n        public setDirty() {\r\n            this.dirty = true;\r\n        }\r\n\r\n        public isDirty() {\r\n            if (this.dirty) {\r\n                this.dirty = false;\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        public render(context: RenderContextWebGL) {\r\n            if (this.isInitialized) {\r\n\r\n                context.SceneCategory = this.getSceneCategory();\r\n\r\n                // updateRunningSequences(context);\r\n\r\n                context.pushState(this.state);\r\n\r\n                this.sceneHierarchy.render(context);\r\n\r\n                context.popState();\r\n            }\r\n        }\r\n\r\n        public addSceneItem(sceneItem: SceneItemWebGL, makeVisible: boolean) {\r\n            this.sceneHierarchy.addChild(sceneItem);\r\n            this.setDirty();\r\n        }\r\n\r\n        public getSceneItem(sceneItemID: string) {\r\n            return this.sceneHierarchy.getChild(sceneItemID);\r\n        }\r\n\r\n        public removeSceneItem(sceneItemID: string) {\r\n            this.sceneHierarchy.removeChild(sceneItemID);\r\n\r\n            this.setDirty();\r\n        }\r\n\r\n        public insertSceneItem(sceneItem: SceneItemWebGL, index: number, makeVisible: boolean) {\r\n            this.sceneHierarchy.insertChild(sceneItem, index);\r\n\r\n            this.setDirty();\r\n        }\r\n\r\n        protected getSceneCategory() {\r\n            return '';\r\n        }\r\n\r\n        public getIntersectionCandidates(ray: psgeometry.Line3D, candidates: Array<IntersectionCandidate>) {\r\n            this.sceneHierarchy.addIntersectionCandidates(ray, candidates);\r\n            candidates.sort((a, b) => { return a.compare(b); })\r\n        }\r\n\r\n        public beginFrame() {}\r\n\r\n        /** Update is called periodically (once per frame) to allow updating the state of the scene.\r\n          */\r\n        public update() {}\r\n\r\n        public endFrame() {}\r\n\r\n    }\r\n\r\n    export class Camera {\r\n        protected projectionMatrix: psgeometry.Matrix4;\r\n\r\n        protected inverseProjectionMatrix: psgeometry.Matrix4;\r\n\r\n        protected viewMatrix: psgeometry.Matrix4;\r\n\r\n        protected inverseViewMatrix: psgeometry.Matrix4;\r\n\r\n        private dirty = true;\r\n\r\n        public get ProjectionMatrix() { return this.projectionMatrix; }\r\n\r\n        public get ViewMatrix() { return this.viewMatrix; }\r\n\r\n        protected setDirty() {\r\n            this.dirty = true;\r\n        }\r\n\r\n        public isDirty() {\r\n            if (this.dirty) {\r\n                this.dirty = false;\r\n                return true;\r\n            } else {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        public createViewMatrix(eye: psgeometry.Vec3, center: psgeometry.Vec3, up: psgeometry.Vec3): psgeometry.Matrix4 {\r\n            let z = eye.sub(center).normalize();\r\n            let x = up.cross(z).normalize();\r\n            let y = z.cross(x).normalize();\r\n\r\n            let m = new psgeometry.Matrix4([x.x, x.y, x.z, 0,\r\n            y.x, y.y, y.z, 0,\r\n            z.x, z.y, z.z, 0,\r\n                0, 0, 0, 1]);\r\n\r\n            let t = new psgeometry.Matrix4([1, 0, 0, -eye.x,\r\n                0, 1, 0, -eye.y,\r\n                0, 0, 1, -eye.z,\r\n                0, 0, 0, 1]);\r\n            return <psgeometry.Matrix4>t.multiply(m);\r\n        }\r\n\r\n        public createPerspectiveMatrix(fovy, aspect, znear, zfar): psgeometry.Matrix4 {\r\n            let ymax = znear * Math.tan(fovy * Math.PI / 360.0);\r\n            let ymin = -ymax;\r\n            let xmin = ymin * aspect;\r\n            let xmax = ymax * aspect;\r\n\r\n            return this.makeFrustum(xmin, xmax, ymin, ymax, znear, zfar);\r\n        }\r\n\r\n        public createOrthographicMatrix(left, right, bottom, top, near, far): psgeometry.Matrix4 {\r\n            return new psgeometry.Matrix4([\r\n                2 / (right - left), 0, 0, 0,\r\n                0, 2 / (top - bottom), 0, 0,\r\n                0, 0, 2 / (near - far), 0,\r\n\r\n                (left + right) / (left - right),\r\n                (bottom + top) / (bottom - top),\r\n                (near + far) / (near - far),\r\n                1,\r\n            ]);\r\n        }\r\n\r\n        public makeFrustum(left, right, bottom, top, znear, zfar): psgeometry.Matrix4 {\r\n            let X: number = 2 * znear / (right - left);\r\n            let Y: number = 2 * znear / (top - bottom);\r\n            let A: number = (right + left) / (right - left);\r\n            let B: number = (top + bottom) / (top - bottom);\r\n            let C: number = -(zfar + znear) / (zfar - znear);\r\n            let D: number = -2 * zfar * znear / (zfar - znear);\r\n\r\n            return new psgeometry.Matrix4([\r\n                X, 0, A, 0,\r\n                0, Y, B, 0,\r\n                0, 0, C, D,\r\n                0, 0, -1, 0]);\r\n        }\r\n\r\n    }\r\n\r\n    export class ShadowCameraWebGL extends Camera {\r\n\r\n        private shadowMapWidth = 1024;\r\n\r\n        private shadowMapHeight = 1024;\r\n\r\n        private shadowFramebuffer;\r\n\r\n        private shadowDepthTexture; \r\n\r\n        private renderBuffer;\r\n\r\n\r\n        public resize(stage: StageWebGL) {\r\n\r\n            this.projectionMatrix = this.createOrthographicMatrix(-5, 5, -5, 5, -30, 30);\r\n            this.update(new psgeometry.Vec3(0, 10, 0), new psgeometry.Vec3(0, 0, 0), new psgeometry.Vec3(0, 0, -1));\r\n\r\n            this.shadowFramebuffer = stage.gl.createFramebuffer();\r\n            this.shadowDepthTexture = stage.gl.createTexture();\r\n            this.renderBuffer = stage.gl.createRenderbuffer();\r\n\r\n            let shadowTexture = new TextureAssetWebGL(stage, this.shadowDepthTexture);\r\n            stage.AssetStore.addTextureAsset('Shadow', shadowTexture);\r\n\r\n            stage.gl.bindFramebuffer(stage.gl.FRAMEBUFFER, this.shadowFramebuffer);\r\n            stage.gl.bindTexture(stage.gl.TEXTURE_2D, this.shadowDepthTexture);\r\n            stage.gl.texParameteri(stage.gl.TEXTURE_2D, stage.gl.TEXTURE_MAG_FILTER, stage.gl.LINEAR);\r\n            stage.gl.texParameteri(stage.gl.TEXTURE_2D, stage.gl.TEXTURE_MIN_FILTER, stage.gl.LINEAR);\r\n            stage.gl.texImage2D(stage.gl.TEXTURE_2D, 0, stage.gl.RGBA, this.shadowMapWidth, this.shadowMapHeight, 0, stage.gl.RGBA, stage.gl.UNSIGNED_BYTE, null);\r\n\r\n            stage.gl.bindRenderbuffer(stage.gl.RENDERBUFFER, this.renderBuffer);\r\n            stage.gl.renderbufferStorage(stage.gl.RENDERBUFFER, stage.gl.DEPTH_COMPONENT16, this.shadowMapWidth, this.shadowMapHeight);\r\n\r\n            stage.gl.framebufferTexture2D(stage.gl.FRAMEBUFFER, stage.gl.COLOR_ATTACHMENT0, stage.gl.TEXTURE_2D, this.shadowDepthTexture, 0);\r\n            stage.gl.framebufferRenderbuffer(stage.gl.FRAMEBUFFER, stage.gl.DEPTH_ATTACHMENT, stage.gl.RENDERBUFFER, this.renderBuffer);\r\n\r\n            stage.gl.bindTexture(stage.gl.TEXTURE_2D, null);\r\n            stage.gl.bindRenderbuffer(stage.gl.RENDERBUFFER, null); \r\n        }\r\n\r\n        public updateShadowArea(bbox: psgeometry.AABB2D) {\r\n            var center = bbox.center();\r\n            var extents = bbox.extents();\r\n            this.projectionMatrix = this.createOrthographicMatrix(-extents.x / 2, extents.x / 2, -extents.y / 2, extents.y / 2, -30, 30);\r\n            this.update(new psgeometry.Vec3(center.x, 10, center.y), new psgeometry.Vec3(center.x, 0, center.y), new psgeometry.Vec3(0, 0, -1));\r\n            this.setDirty();\r\n        }\r\n\r\n        public update(pos: psgeometry.Vec3, lookAt: psgeometry.Vec3, up: psgeometry.Vec3) {\r\n            this.viewMatrix = this.createViewMatrix(pos, lookAt, up);\r\n\r\n            this.setDirty();\r\n        }\r\n\r\n        public beginRender(stage: StageWebGL) {\r\n            stage.gl.bindFramebuffer(stage.gl.FRAMEBUFFER, this.shadowFramebuffer);\r\n\r\n            // Set the viewport to match\r\n            stage.gl.viewport(0, 0, this.shadowMapWidth, this.shadowMapHeight);\r\n\r\n            stage.gl.clearColor(0.2, 0.2, 0.2, 0.0);\r\n            stage.gl.clearDepth(0.0);\r\n            stage.gl.clear(stage.gl.COLOR_BUFFER_BIT | stage.gl.DEPTH_BUFFER_BIT);\r\n\r\n            stage.gl.enable(stage.gl.DEPTH_TEST);\r\n            stage.gl.enable(stage.gl.CULL_FACE);\r\n            stage.gl.frontFace(stage.gl.CCW);\r\n            stage.gl.cullFace(stage.gl.BACK);\r\n            stage.gl.depthFunc(stage.gl.GEQUAL);\r\n        }\r\n\r\n        public endRender(stage: StageWebGL) {\r\n        }\r\n\r\n    }\r\n\r\n    export class CameraWebGL extends Camera {\r\n\r\n        private currentCameraPos: psgeometry.Vec3;\r\n\r\n        private clientWidth: number = 1.0;\r\n\r\n        private clientHeight: number = 1.0;\r\n\r\n\r\n        public get ProjectionMatrix() {\r\n            return this.projectionMatrix;\r\n        }\r\n\r\n        public get ViewMatrix() {\r\n            return this.viewMatrix;\r\n        }\r\n\r\n        public resize(stage: StageWebGL) {\r\n            let realToCSSPixels = window.devicePixelRatio || 1;\r\n\r\n            this.clientWidth = stage.gl.canvas.clientWidth;\r\n            this.clientHeight = stage.gl.canvas.clientHeight;\r\n\r\n            // Lookup the size the browser is displaying the canvas in CSS pixels\r\n            // and compute a size needed to make our drawingbuffer match it in\r\n            // device pixels.\r\n            let displayWidth = Math.floor(stage.gl.canvas.clientWidth * realToCSSPixels);\r\n            let displayHeight = Math.floor(stage.gl.canvas.clientHeight * realToCSSPixels);\r\n\r\n            // Make the canvas the same size\r\n            stage.gl.canvas.width = displayWidth / realToCSSPixels;\r\n            stage.gl.canvas.height = displayHeight / realToCSSPixels;\r\n\r\n            this.projectionMatrix = this.createPerspectiveMatrix(45.0, stage.gl.canvas.clientWidth / stage.gl.canvas.clientHeight, 0.1, 200.0);\r\n            //this.projectionMatrix = this.createOrthographicMatrix(-5, 5, -5, 5, -30, 30);\r\n            this.inverseProjectionMatrix = this.projectionMatrix.inverse();\r\n            //this.viewMatrix = this.createViewMatrix(new psgeometry.Vec3(0.0, 1.8, 15.0), new psgeometry.Vec3(0.0, 0.0, 0.0), new psgeometry.Vec3(0.0, 1.0, 0.0));\r\n\r\n            this.setDirty();\r\n        }\r\n\r\n        public update(pos: psgeometry.Vec3, lookAt: psgeometry.Vec3, up: psgeometry.Vec3) {\r\n            this.currentCameraPos = pos;\r\n            this.viewMatrix = this.createViewMatrix(pos, lookAt, up);\r\n            this.inverseViewMatrix = this.viewMatrix.inverse();\r\n\r\n            this.setDirty();\r\n        }\r\n\r\n        public beginRender(stage: StageWebGL) {\r\n\r\n            // Set the viewport to match\r\n            stage.gl.viewport(0, 0, stage.gl.canvas.clientWidth, stage.gl.canvas.clientHeight);\r\n\r\n            stage.gl.bindFramebuffer(stage.gl.FRAMEBUFFER, null);\r\n\r\n            stage.gl.clearColor(0.3, 0.3, 0.3, 1.0);\r\n            stage.gl.clearDepth(1.0);\r\n            stage.gl.clear(stage.gl.DEPTH_BUFFER_BIT); // stage.gl.COLOR_BUFFER_BIT | \r\n\r\n            stage.gl.enable(stage.gl.DEPTH_TEST);\r\n            stage.gl.enable(stage.gl.CULL_FACE);\r\n            stage.gl.frontFace(stage.gl.CCW);\r\n            stage.gl.cullFace(stage.gl.BACK);\r\n            stage.gl.depthFunc(stage.gl.LEQUAL);       \r\n        }\r\n\r\n        public endRender(stage: StageWebGL) {\r\n        }\r\n\r\n        public getViewRay(clientX: number, clientY: number): psgeometry.Line3D {\r\n            let cursor = new psgeometry.Vec4(clientX / this.clientWidth * 2.0 - 1.0, 1.0 - clientY / this.clientHeight * 2.0, -1.0, 1.0);\r\n            let direction = <psgeometry.Vec4>this.inverseProjectionMatrix.multiply(cursor);\r\n            direction.w = 1.0;\r\n            let forward = this.inverseViewMatrix.multiply(direction);\r\n            return new psgeometry.Line3D(this.currentCameraPos, forward);\r\n        }\r\n\r\n    }\r\n\r\n    export class ShaderProgramWebGL {\r\n\r\n        protected isInitialized = false;\r\n\r\n        protected vertexShader: WebGLShader;\r\n\r\n        protected fragmentShader: WebGLShader;\r\n\r\n        protected program: WebGLProgram;\r\n\r\n        public get Program() {\r\n            return this.program;\r\n        }\r\n\r\n        public render(context: RenderContextWebGL, shaderInstance: ShaderInstance) {\r\n            if (this.isInitialized && this.beginRender(context, shaderInstance)) {\r\n                context.Stage.applyState(context);\r\n                this.internalRender(context, shaderInstance);\r\n                this.endRender(context, shaderInstance);\r\n            }\r\n        }\r\n\r\n        protected getAttribLocation(stage: StageWebGL, attribName: string): number {\r\n            return stage.gl.getAttribLocation(this.program, attribName);\r\n        }\r\n\r\n        protected beginRender(context: RenderContextWebGL, shaderInstance: ShaderInstance): boolean {\r\n            context.Stage.gl.useProgram(this.program);\r\n            return true;\r\n        }\r\n\r\n        protected SIZE_OF_FLOAT = 4;\r\n\r\n        protected internalRender(context: RenderContextWebGL, shaderInstance: ShaderInstance) {\r\n        }\r\n\r\n        protected endRender(context: RenderContextWebGL, shaderInstance: ShaderInstance) {\r\n        }\r\n\r\n        public initialize(stage: StageWebGL) {\r\n            this.vertexShader = stage.Tools.createShader(stage.gl.VERTEX_SHADER, this.getVertexShaderSrc());\r\n            this.fragmentShader = stage.Tools.createShader(stage.gl.FRAGMENT_SHADER, this.getFragmentShaderSrc());\r\n\r\n            this.program = stage.gl.createProgram();\r\n\r\n            stage.gl.attachShader(this.program, this.vertexShader);\r\n            stage.gl.attachShader(this.program, this.fragmentShader);\r\n\r\n            stage.gl.linkProgram(this.program);\r\n\r\n            stage.gl.detachShader(this.program, this.vertexShader);\r\n            stage.gl.detachShader(this.program, this.fragmentShader);\r\n\r\n            console.log(stage.gl.getProgramInfoLog(this.program));\r\n\r\n            this.isInitialized = true;\r\n        }\r\n\r\n        public getVertexShaderSrc(): string {\r\n            return '';\r\n        }\r\n\r\n        public getFragmentShaderSrc(): string {\r\n            return '';\r\n        }\r\n\r\n    }\r\n\r\n    export class OpaqueMeshShaderProgramWebGL extends ShaderProgramWebGL {\r\n\r\n        protected getStride() {\r\n            return this.SIZE_OF_FLOAT * 9;\r\n        }\r\n\r\n        protected internalRender(context: RenderContextWebGL, shaderInstance: ShaderInstance) {\r\n            let stage = context.Stage;\r\n\r\n            let bufferKey = shaderInstance.getReference('IndexBuffer');\r\n            if (bufferKey) {\r\n                let bufferAsset = stage.AssetStore.getBufferAsset(bufferKey);\r\n                bufferAsset.bind(stage);\r\n\r\n                bufferKey = shaderInstance.getReference('VertexBuffer');\r\n                bufferAsset = stage.AssetStore.getBufferAsset(bufferKey);\r\n\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aPosition'), 3, this.getStride(), 0);\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aNormal'), 3, this.getStride(), 3 * this.SIZE_OF_FLOAT);\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aColor'), 3, this.getStride(), 6 * this.SIZE_OF_FLOAT);\r\n\r\n                // draw triangles\r\n                let triangleCount = bufferAsset.BufferSize / this.getStride();\r\n                stage.gl.drawElements(stage.gl.TRIANGLES, triangleCount, stage.gl.UNSIGNED_INT, 0);\r\n\r\n                // bind with 0, so, switch back to normal pointer operation\r\n                //stage.gl.bindBuffer(stage.gl.ELEMENT_ARRAY_BUFFER, 0);\r\n                //stage.gl.bindBuffer(stage.gl.ARRAY_BUFFER, 0);\r\n            }\r\n        }\r\n\r\n\r\n        public getVertexShaderSrc(): string {\r\n            return `uniform mat4 uMMatrix;\r\n                uniform mat4 uVMatrix;\r\n                uniform mat4 uPMatrix;\r\n\r\n                attribute vec3 aPosition;\r\n                attribute vec3 aNormal;\r\n                attribute vec3 aColor;\r\n\r\n                varying mediump vec4 vColor;\r\n\r\n                void main()\r\n                {\r\n                   gl_Position = uPMatrix * uVMatrix * uMMatrix * vec4(aPosition, 1.0);\r\n                   vec3 normal = aNormal;\r\n                   vec4 diffuseColor = vec4(aColor, 1.0);\r\n                   vec4 ambientColor = vec4(1.0, 1.0, 1.0, 1.0);\r\n\r\n                   vec3 lightDir = vec3(0.9, 0.7, 1.0);\r\n                   mediump float lightIntensity = clamp(dot(normalize(normal), normalize(lightDir)), 0.0, 1.0);\r\n\r\n                   vColor = vec4((aColor * 0.65 + ambientColor.rgb * 0.35)*(0.7 + lightIntensity * 0.3), 1.0);\r\n                }`;\r\n        }\r\n\r\n        public getFragmentShaderSrc(): string {\r\n            return `varying mediump vec4 vColor;\r\n\r\n                void main()\r\n                {\r\n                   gl_FragColor = vColor;\r\n                }`;\r\n        }\r\n\r\n    }\r\n\r\n    export class TransparentMeshShaderProgramWebGL extends ShaderProgramWebGL {\r\n\r\n        protected getStride() {\r\n            return this.SIZE_OF_FLOAT * 10;\r\n        }\r\n\r\n        protected internalRender(context: RenderContextWebGL, shaderInstance: ShaderInstance) {\r\n            let stage = context.Stage;\r\n\r\n            let bufferKey = shaderInstance.getReference('IndexBuffer');\r\n            if (bufferKey) {\r\n                let bufferAsset = stage.AssetStore.getBufferAsset(bufferKey);\r\n                bufferAsset.bind(stage);\r\n\r\n                bufferKey = shaderInstance.getReference('VertexBuffer');\r\n                bufferAsset = stage.AssetStore.getBufferAsset(bufferKey);\r\n\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aPosition'), 3, this.getStride(), 0);\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aNormal'), 3, this.getStride(), 3 * this.SIZE_OF_FLOAT);\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aColor'), 4, this.getStride(), 6 * this.SIZE_OF_FLOAT);\r\n\r\n                stage.gl.enable(stage.gl.BLEND);\r\n                stage.gl.blendFunc(stage.gl.SRC_ALPHA, stage.gl.ONE_MINUS_SRC_ALPHA);\r\n                stage.gl.depthMask(false);\r\n\r\n                // draw triangles\r\n                let triangleCount = bufferAsset.BufferSize / this.getStride();\r\n                stage.gl.drawElements(stage.gl.TRIANGLES, triangleCount, stage.gl.UNSIGNED_INT, 0);\r\n\r\n                stage.gl.depthMask(true);\r\n                stage.gl.disable(stage.gl.BLEND);\r\n\r\n                // bind with 0, so, switch back to normal pointer operation\r\n                //stage.gl.bindBuffer(stage.gl.ELEMENT_ARRAY_BUFFER, 0);\r\n                //stage.gl.bindBuffer(stage.gl.ARRAY_BUFFER, 0);\r\n            }\r\n        }\r\n\r\n\r\n        public getVertexShaderSrc(): string {\r\n            return `uniform mat4 uMMatrix;\r\n                uniform mat4 uVMatrix;\r\n                uniform mat4 uPMatrix;\r\n\r\n                attribute vec3 aPosition;\r\n                attribute vec3 aNormal;\r\n                attribute vec4 aColor;\r\n\r\n                varying mediump vec4 vColor;\r\n\r\n                void main()\r\n                {\r\n                   gl_Position = uPMatrix * uVMatrix * uMMatrix * vec4(aPosition, 1.0);\r\n                   vec3 normal = aNormal;\r\n                   vec4 diffuseColor = aColor;\r\n                   vec4 ambientColor = vec4(1.0, 1.0, 1.0, 1.0);\r\n\r\n                   vec3 lightDir = vec3(0.9, 0.7, 1.0);\r\n                   mediump float lightIntensity = clamp(dot(normalize(normal), normalize(lightDir)), 0.0, 1.0);\r\n\r\n                   vColor = vec4((aColor.rgb * 0.65 + ambientColor.rgb * 0.35)*(0.7 + lightIntensity * 0.3), aColor.a);\r\n                }`;\r\n        }\r\n\r\n        public getFragmentShaderSrc(): string {\r\n            return `varying mediump vec4 vColor;\r\n\r\n                void main()\r\n                {\r\n                   gl_FragColor = vColor;\r\n                }`;\r\n        }\r\n\r\n    }\r\n\r\n    export enum TexturedMeshShaderProgramVariants {\r\n        Diffuse,\r\n        Matcap\r\n    }\r\n\r\n    export class TexturedMeshShaderProgramWebGL extends ShaderProgramWebGL {\r\n\r\n        public constructor(private variant: TexturedMeshShaderProgramVariants = TexturedMeshShaderProgramVariants.Diffuse) {\r\n            super();\r\n        }\r\n\r\n        protected getStride() {\r\n            return this.SIZE_OF_FLOAT * 11;\r\n        }\r\n\r\n        protected internalRender(context: RenderContextWebGL, shaderInstance: ShaderInstance) {\r\n            let stage = context.Stage;\r\n\r\n            let bufferKey = shaderInstance.getReference('IndexBuffer');\r\n            if (bufferKey) {\r\n                let bufferAsset = stage.AssetStore.getBufferAsset(bufferKey);\r\n                bufferAsset.bind(stage);\r\n\r\n                bufferKey = shaderInstance.getReference('VertexBuffer');\r\n                bufferAsset = stage.AssetStore.getBufferAsset(bufferKey);\r\n\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aPosition'), 3, this.getStride(), 0);\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aNormal'), 3, this.getStride(), 3 * this.SIZE_OF_FLOAT);\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aColor'), 3, this.getStride(), 6 * this.SIZE_OF_FLOAT);\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aTextureCoords'), 2, this.getStride(), 9 * this.SIZE_OF_FLOAT);\r\n\r\n                let textureKey = shaderInstance.getReference('TextureBuffer');\r\n                let textureAsset = stage.AssetStore.getTextureAsset(textureKey);\r\n                if (textureAsset) {\r\n                    textureAsset.bind(stage, this, 'uTexture0');\r\n\r\n                    // draw triangles\r\n                    let triangleCount = bufferAsset.BufferSize / this.getStride();\r\n                    stage.gl.drawElements(stage.gl.TRIANGLES, triangleCount, stage.gl.UNSIGNED_INT, 0);\r\n                }\r\n\r\n                // bind with 0, so, switch back to normal pointer operation\r\n                //stage.gl.bindBuffer(stage.gl.ELEMENT_ARRAY_BUFFER, 0);\r\n                //stage.gl.bindBuffer(stage.gl.ARRAY_BUFFER, 0);\r\n            }\r\n        }\r\n\r\n        public getVertexShaderSrc(): string {\r\n            let result = `uniform mat4 uMMatrix;\r\n                uniform mat4 uVMatrix;\r\n                uniform mat4 uPMatrix;\r\n\r\n                attribute vec3 aPosition;\r\n                attribute vec3 aNormal;\r\n                attribute vec3 aColor;\r\n                attribute vec2 aTextureCoords;\r\n\r\n                varying mediump vec4 vColor;\r\n                varying mediump vec2 vTextureCoords;\r\n                varying mediump float vLightIntensity;\r\n\r\n                void main()\r\n                {\r\n                   vec4 pos = uMMatrix * vec4(aPosition, 1.0);\r\n                   gl_Position = uPMatrix * uVMatrix * pos;\r\n                   vec3 normal = normalize(uMMatrix * vec4(aNormal, 0.0)).xyz;\r\n\r\n                   vec3 lightDir = vec3(0.9, 0.7, 1.0);\r\n                   vLightIntensity = clamp(dot(normalize(normal), normalize(lightDir)), 0.0, 1.0);\r\n\r\n                   vColor = vec4(aColor, 1.0);\r\n`;\r\n\r\n            switch (this.variant) {\r\n                case TexturedMeshShaderProgramVariants.Diffuse: result +=\r\n                    `vTextureCoords = aTextureCoords;\r\n`;\r\n                    break;\r\n                case TexturedMeshShaderProgramVariants.Matcap: result +=\r\n                    `vec3 e = normalize(pos.xyz);\r\n\t                 vec3 r = reflect(e, (uVMatrix * vec4(normal, 0.0)).xyz);\r\n\t                 mediump float m = 2. * length(vec3(r.x, r.y, r.z + 1.));\r\n\t                 vTextureCoords = r.xy / m + .5;\r\n`;\r\n                    break;\r\n            }\r\n            \r\n            result += `}`;\r\n\r\n            return result;\r\n        }\r\n\r\n        public getFragmentShaderSrc(): string {\r\n            let result = `uniform sampler2D uTexture0;\r\n\r\n                varying mediump vec4 vColor;\r\n                varying mediump vec2 vTextureCoords;\r\n                varying mediump float vLightIntensity;\r\n\r\n                void main()\r\n                {\r\n            \t    mediump vec4 texColor = texture2D(uTexture0, vec2(vTextureCoords.x, 1.0 - vTextureCoords.y));\r\n`;\r\n            switch (this.variant) {\r\n                case TexturedMeshShaderProgramVariants.Diffuse: result +=\r\n                    `gl_FragColor = vec4(clamp(texColor.xyz * (1.0 + .15 * vLightIntensity), 0.0, 1.0), texColor.a); \r\n            `;\r\n                    break;\r\n                case TexturedMeshShaderProgramVariants.Matcap: result += \r\n                    `gl_FragColor = texColor.a;   \r\n`;\r\n                    break;\r\n            }\r\n\r\n            result += `}`;\r\n\r\n            return result;\r\n        }\r\n        \r\n    }\r\n\r\n    export class ShadowTexturedMeshShaderProgramWebGL extends TexturedMeshShaderProgramWebGL {\r\n\r\n        public getVertexShaderSrc(): string {\r\n            return `uniform mat4 uMMatrix;\r\n                uniform mat4 uVMatrix;\r\n                uniform mat4 uPMatrix;\r\n\r\n                attribute vec3 aPosition;\r\n                attribute vec3 aNormal;\r\n                attribute vec3 aColor;\r\n                attribute vec2 aTextureCoords;\r\n\r\n                varying mediump float height;\r\n\r\n                void main()\r\n                {\r\n                   gl_Position = uPMatrix * uVMatrix * uMMatrix * vec4(aPosition, 1.0);\r\n                   height = (uMMatrix * vec4(aPosition, 1.0)).y;\r\n                }`;\r\n        }\r\n\r\n        public getFragmentShaderSrc(): string {\r\n            return `uniform sampler2D uTexture0;\r\n                varying mediump float height;\r\n\r\n\r\n                void main()\r\n                {\r\n                    gl_FragColor = vec4(.2, .2, .2, clamp(1.0 - (height / 3.0), 0.0, 1.0)); \r\n                }`;\r\n        }\r\n\r\n    }\r\n\r\n    export class MatCapShaderProgramWebGL extends ShaderProgramWebGL {\r\n\r\n        protected getStride() {\r\n            return this.SIZE_OF_FLOAT * 11;\r\n        }\r\n\r\n        protected internalRender(context: RenderContextWebGL, shaderInstance: ShaderInstance) {\r\n            let stage = context.Stage;\r\n\r\n            let bufferKey = shaderInstance.getReference('IndexBuffer');\r\n            if (bufferKey) {\r\n                let bufferAsset = stage.AssetStore.getBufferAsset(bufferKey);\r\n                bufferAsset.bind(stage);\r\n\r\n                bufferKey = shaderInstance.getReference('VertexBuffer');\r\n                bufferAsset = stage.AssetStore.getBufferAsset(bufferKey);\r\n\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aPosition'), 3, this.getStride(), 0);\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aNormal'), 3, this.getStride(), 3 * this.SIZE_OF_FLOAT);\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aColor'), 3, this.getStride(), 6 * this.SIZE_OF_FLOAT);\r\n                bufferAsset.bindInterleaved(stage, this.getAttribLocation(stage, 'aTextureCoords'), 2, this.getStride(), 9 * this.SIZE_OF_FLOAT);\r\n\r\n                let textureKey = shaderInstance.getReference('TextureBuffer');\r\n                let textureAsset = stage.AssetStore.getTextureAsset(textureKey);\r\n                if (textureAsset) {\r\n                    textureAsset.bind(stage, this, 'uTexture0');\r\n\r\n                    let color = context.State.get('Color', psgeometry.Vec4.One);\r\n                    let uColorLoc = stage.gl.getUniformLocation(this.program, 'uColor');\r\n                    stage.gl.uniform4fv(uColorLoc, color.elements()); \r\n\r\n                    // draw triangles\r\n                    let triangleCount = bufferAsset.BufferSize / this.getStride();\r\n                    stage.gl.drawElements(stage.gl.TRIANGLES, triangleCount, stage.gl.UNSIGNED_INT, 0);\r\n                }\r\n            }\r\n        }\r\n\r\n        public getVertexShaderSrc(): string {\r\n            let result = `uniform mat4 uMMatrix;\r\n                uniform mat4 uVMatrix;\r\n                uniform mat4 uPMatrix;\r\n\r\n                attribute vec3 aPosition;\r\n                attribute vec3 aNormal;\r\n                attribute vec3 aColor;\r\n                attribute vec2 aTextureCoords;\r\n\r\n                varying mediump vec4 vColor;\r\n                varying mediump vec2 vTextureCoords;\r\n\r\n                void main()\r\n                {\r\n                   vec4 pos = uMMatrix * vec4(aPosition, 1.0);\r\n                   gl_Position = uPMatrix * uVMatrix * pos;\r\n                   vec3 normal = normalize(uMMatrix * vec4(aNormal, 0.0)).xyz;\r\n\r\n                   vec3 e = normalize(pos.xyz);\r\n\t               vec3 r = reflect(e, (uVMatrix * vec4(normal, 0.0)).xyz);\r\n\t               mediump float m = 2. * length(vec3(r.x, r.y, r.z + 1.));\r\n\t               vTextureCoords = r.xy / m + .5;\r\n                }`;\r\n\r\n            return result;\r\n        }\r\n\r\n        public getFragmentShaderSrc(): string {\r\n            let result = `uniform sampler2D uTexture0;\r\n                uniform mediump vec4 uColor;\r\n\r\n                varying mediump vec4 vColor;\r\n                varying mediump vec2 vTextureCoords;\r\n\r\n                void main()\r\n                {\r\n            \t    mediump vec4 texColor = texture2D(uTexture0, vec2(vTextureCoords.x, 1.0 - vTextureCoords.y));\r\n                    //mediump vec3 green = vec3(0, 0.44, 0.09);\r\n                    //mediump vec3 green = vec3(0.69, 0.34, 0.00);  //or\r\n                    //mediump vec3 green = vec3(0.02, 0.31, 0.06);  // g\r\n                    //mediump vec3 green = vec3(0.31, 0.02, 0.06);  // r\r\n                    //mediump vec3 green = vec3(0.02, 0.17, 0.31);  // b\r\n                    mediump float colorFac = (texColor.x - texColor.y) / 0.65;\r\n                    mediump float whiteFac = (1.0 - colorFac) * 0.75;\r\n                    mediump vec3 color = vec3(whiteFac, whiteFac, whiteFac) + colorFac * uColor.rgb;\r\n\r\n                    gl_FragColor = vec4(color, texColor.a * uColor.a);   \r\n            }`;\r\n\r\n            return result;\r\n        }\r\n    }\r\n\r\n    class RenderStateStack {\r\n        private modelTransform: Array<psgeometry.Matrix4> = [psgeometry.Matrix4.Identity];\r\n\r\n        private stack: Array<RenderState> = [];\r\n\r\n        /** Top of the state stack.\r\n          */\r\n        public get Top() {\r\n            return this.stack[this.stack.length - 1];\r\n        }\r\n\r\n        /** Determines the current model transformation.\r\n          */\r\n        public get CurrentModelTransform() {\r\n            return this.modelTransform[this.modelTransform.length - 1];\r\n        }\r\n\r\n        /** Pushes the specified state on the state stack.\r\n          */\r\n        public pushState(state: RenderState) {\r\n            state.Parent = this.stack.length == 0 ? null : this.Top;\r\n            this.stack.push(state);\r\n            if (state.contains('ModelTransform')) {\r\n                let modelTransform = state.get('ModelTransform', psgeometry.Matrix4.Identity);\r\n                this.modelTransform.push(<psgeometry.Matrix4>this.CurrentModelTransform.multiply(modelTransform));\r\n            }\r\n            else {\r\n                this.modelTransform.push(this.CurrentModelTransform);\r\n            }\r\n        }\r\n\r\n        /** Removes the top element from the state stack.\r\n          */\r\n        public popState() {\r\n            this.Top.Parent = null;\r\n            this.stack.pop();\r\n            this.modelTransform.pop();\r\n        }\r\n    }\r\n\r\n    /** A RenderContext instance is used to pass environment data to SceneItems during the rendition process.\r\n\t  *\r\n\t  * Besides the Stage that the SceneItems are being rendered to, the render context is the owner of a state stack\r\n\t  * that may be updated by SceneItems and that is consequently used by ShaderPrograms to set shader data and resources (like model transformation\r\n\t  * and auxiliary data). As SceneItems are organized in a hierarchical way, the current state may be defined by the current SceneItem, but\r\n\t  * also by previously traversed SceneItems in the scene hierarchy.\r\n\t  */\r\n    export class RenderContextWebGL {\r\n        private stage: StageWebGL;\r\n\r\n        private camera: Camera;\r\n\r\n        private shaderProgram: ShaderProgramWebGL;\r\n\r\n        private sceneCategory: string = '';\r\n\r\n        private stateStack: RenderStateStack = new RenderStateStack();\r\n\r\n        private modelTransform: psgeometry.Matrix4 = null;\r\n\r\n        private nodeTransform: psgeometry.Matrix4 = null;\r\n\r\n        private phase: string = '';\r\n\r\n        public get Phase() { return this.phase; }\r\n\r\n        public set Phase(value: string) { this.phase = value; }\r\n\r\n        /** Returns the current state that is composed of previously set state values.\r\n          */\r\n        public get State() {\r\n            return this.stateStack.Top;\r\n        }\r\n\r\n        /** Pushes the specified state on the state stack.\r\n          */\r\n        public pushState(state: RenderState) {\r\n            this.stateStack.pushState(state);\r\n        }\r\n\r\n        /** Removes the top element from the state stack.\r\n          */\r\n        public popState() {\r\n            this.stateStack.popState();\r\n        }\r\n\r\n        public get ModelTransform() {\r\n            return this.stateStack.CurrentModelTransform;\r\n        }\r\n\r\n        /** The current scene's category.\r\n          */\r\n        public get SceneCategory() {\r\n            return this.sceneCategory;\r\n        }\r\n\r\n        /** The current scene's category.\r\n          */\r\n        public set SceneCategory(value: string) {\r\n            this.sceneCategory = value;\r\n        }\r\n\r\n        /** The stage the SceneItems are being rendered to.\r\n          */\r\n        public get Stage() {\r\n            return this.stage;\r\n        }\r\n\r\n        /** The stage the SceneItems are being rendered to.\r\n          */\r\n        public set Stage(value: StageWebGL) {\r\n            this.stage = value;\r\n        }\r\n\r\n        public get Camera() {\r\n            return this.camera;\r\n        }\r\n\r\n        public set Camera(value: Camera) {\r\n            this.camera = value;\r\n        }\r\n\r\n        /** The current shader program.\r\n          */\r\n        public get ShaderProgram() {\r\n            return this.shaderProgram;\r\n        }\r\n\r\n        /** The current shader program.\r\n          */\r\n        public set ShaderProgram(value: ShaderProgramWebGL) {\r\n            this.shaderProgram = value;\r\n        }\r\n\r\n        public get NodeTransform() {\r\n            return this.nodeTransform;\r\n        }\r\n\r\n        public set NodeTransform(value: psgeometry.Matrix4) {\r\n            this.nodeTransform = value;\r\n        }\r\n    }\r\n\r\n    export class StageWebGL {\r\n\r\n        public gl: WebGLRenderingContext;\r\n\r\n        private canvas: HTMLCanvasElement;\r\n\r\n        private camera: CameraWebGL;\r\n\r\n        private shadowCamera: ShadowCameraWebGL;\r\n\r\n        private context: RenderContextWebGL;\r\n\r\n        private assetFactory: AssetFactoryWebGL;\r\n\r\n        private assetStore: AssetStoreWebGL;\r\n\r\n        private phaseSpecificShaderPrograms: { [index: string]: { [index: string]: ShaderProgramWebGL } } = {};\r\n\r\n        private shaderPrograms: { [index: string]: ShaderProgramWebGL } = {};\r\n\r\n        private tools: ToolsWebGL = new ToolsWebGL(this);\r\n\r\n        public get Canvas() {\r\n            return this.canvas;\r\n        }\r\n\r\n        public get Camera() {\r\n            return this.camera;\r\n        }\r\n\r\n        public get Tools() {\r\n            return this.tools;\r\n        }\r\n\r\n        public get AssetFactory() {\r\n            return this.assetFactory;\r\n        }\r\n\r\n        public get AssetStore() {\r\n            return this.assetStore;\r\n        }\r\n\r\n        constructor(canvasElementId: string) {\r\n            try {\r\n                this.context = new RenderContextWebGL();\r\n                this.context.Stage = this;\r\n\r\n                this.assetStore = new AssetStoreWebGL();\r\n                this.assetFactory = new AssetFactoryWebGL(this);\r\n\r\n                this.canvas = <HTMLCanvasElement>document.getElementById(canvasElementId);\r\n\r\n                if (this.canvas) {\r\n                    this.gl = <WebGLRenderingContext>(this.canvas.getContext('webgl') || (this.canvas.getContext('experimental-webgl')));\r\n                    let ext = this.gl.getExtension('OES_element_index_uint');\r\n\r\n                    window.addEventListener('resize', () => {\r\n                        this.resize();\r\n                    });\r\n                }\r\n\r\n                if (!this.gl) {\r\n                    alert('Unable to initialize WebGL. Your browser may not support it.');\r\n                }\r\n            }\r\n            catch (e) {\r\n                alert('Unable to initialize WebGL. Your browser may not support it. Error: ' + e);\r\n            }\r\n        }\r\n\r\n        public initialize() {\r\n            this.shadowCamera = new ShadowCameraWebGL();\r\n            this.shadowCamera.resize(this);\r\n            this.camera = new CameraWebGL();\r\n            this.camera.resize(this);\r\n            this.resize();\r\n        }\r\n\r\n        public updateShadowArea(box: psgeometry.AABB2D) {\r\n            this.shadowCamera.updateShadowArea(box);\r\n        }\r\n\r\n        public applyState(context: RenderContextWebGL) {\r\n            let program = context.ShaderProgram.Program;\r\n\r\n            let resultingModelTransformation = psgeometry.Matrix4.Identity;\r\n            if (context.ModelTransform && context.NodeTransform) {\r\n                resultingModelTransformation = <psgeometry.Matrix4>context.NodeTransform.multiply(context.ModelTransform);\r\n            } else if (context.ModelTransform) {\r\n                resultingModelTransformation = context.ModelTransform;\r\n            } else if (context.NodeTransform) {\r\n                resultingModelTransformation = context.NodeTransform;\r\n            }\r\n\r\n            let mMatrixLoc = this.gl.getUniformLocation(program, 'uMMatrix');\r\n            this.gl.uniformMatrix4fv(mMatrixLoc, false, resultingModelTransformation.transpose().elements);\r\n            let vMatrixLoc = this.gl.getUniformLocation(program, 'uVMatrix');\r\n            this.gl.uniformMatrix4fv(vMatrixLoc, false, context.Camera.ViewMatrix.transpose().elements);\r\n            let pMatrixLoc = this.gl.getUniformLocation(program, 'uPMatrix');\r\n            this.gl.uniformMatrix4fv(pMatrixLoc, false, context.Camera.ProjectionMatrix.transpose().elements); \r\n        }\r\n\r\n        public render(scene: SceneWebGL) {\r\n            if (scene.isDirty() || this.camera.isDirty() || this.shadowCamera.isDirty()) {\r\n\r\n                this.context.Phase = 'Shadow';\r\n                this.context.Camera = this.shadowCamera;\r\n                this.shadowCamera.beginRender(this);\r\n                scene.render(this.context);\r\n                this.shadowCamera.endRender(this);\r\n\r\n                this.context.Phase = '';\r\n                this.context.Camera = this.camera;\r\n                this.camera.beginRender(this);\r\n                scene.render(this.context);\r\n                this.camera.endRender(this);\r\n            }\r\n        }\r\n\r\n        public registerShaderProgram(shaderProgramKey: string, shaderProgram: ShaderProgramWebGL) {\r\n            this.shaderPrograms[shaderProgramKey] = shaderProgram;\r\n        }\r\n\r\n        public registerPhaseSpecificShaderProgram(phaseKey: string, shaderProgramKey: string, shaderProgram: ShaderProgramWebGL) {\r\n            let phase = this.phaseSpecificShaderPrograms[phaseKey];\r\n            if (!phase) {\r\n                phase = {};\r\n                this.phaseSpecificShaderPrograms[phaseKey] = phase;\r\n            }\r\n\r\n            phase[shaderProgramKey] = shaderProgram;\r\n        }\r\n\r\n        public getShaderProgram(context, shaderProgramKey: string) {\r\n            let result;\r\n\r\n            if (context.phase) {\r\n                let phase = this.phaseSpecificShaderPrograms[context.phase];\r\n                if (phase) {\r\n                    result = phase[shaderProgramKey];\r\n                }\r\n            } \r\n\r\n            return result || this.shaderPrograms[shaderProgramKey];\r\n        }\r\n\r\n        private resize() {\r\n            this.canvas.width = this.canvas.parentElement.offsetWidth;\r\n            this.canvas.height = this.canvas.parentElement.offsetHeight;\r\n            this.camera.resize(this);\r\n        }\r\n\r\n    }\r\n\r\n    export enum ConnectionState {\r\n        Ready,\r\n        Connecting,\r\n        Connected,\r\n        Error\r\n    };\r\n\r\n    export abstract class ServerConnection {\r\n\r\n        protected state: ConnectionState;\r\n\r\n        protected handleConnected: (event: Event) => void;\r\n\r\n        protected handleMessage: (Event: MessageEvent) => void;\r\n\r\n        public get IsConnected() {\r\n            return this.state == ConnectionState.Connected;\r\n        }\r\n\r\n        public constructor() {\r\n            this.state = ConnectionState.Ready;\r\n        }\r\n\r\n        public abstract connect();\r\n\r\n        public abstract disconnect();\r\n\r\n        public abstract send(data: any);\r\n\r\n        public onMessage(callback: (event: MessageEvent) => void) {\r\n            this.handleMessage = callback;\r\n        }\r\n\r\n        public onConnected(callback: (event: Event) => void) {\r\n            this.handleConnected = callback;\r\n        }\r\n\r\n    }\r\n\r\n    export class SignalRServerConnection extends ServerConnection {\r\n\r\n        private connection: HubConnection;\r\n\r\n        public constructor() {\r\n            super();\r\n\r\n            this.connection = new HubConnectionBuilder()\r\n                .withUrl('/api/state')\r\n                .configureLogging(LogLevel.Trace)\r\n                //.withHubProtocol(<any>(new MessagePackHubProtocol()))\r\n                .build();\r\n\r\n            this.connection.on('msg', (data) => {\r\n                if (this.handleMessage) {\r\n                    let msg = new MessageEvent('binary', { data: data });\r\n                    this.handleMessage(msg);\r\n                }\r\n            });\r\n        }\r\n\r\n        public connect() {\r\n            this.state = ConnectionState.Connecting;\r\n            this.connection.start()\r\n                .then(() => {\r\n                    if (this.handleConnected) {\r\n                        this.state = ConnectionState.Connected;\r\n                        this.handleConnected(new Event('connected'));\r\n                    }\r\n                })\r\n                .catch((e) => {\r\n                    this.state = ConnectionState.Error;\r\n                });\r\n        }\r\n\r\n        public disconnect() {\r\n            this.connection.stop()\r\n                .then(() => {\r\n                    this.state = ConnectionState.Ready;\r\n                })\r\n                .catch(() => {\r\n                    this.state = ConnectionState.Error;\r\n                });\r\n        }\r\n\r\n        public send(data: any) {\r\n            this.connection.invoke('Msg', data);\r\n        }\r\n\r\n    }\r\n\r\n    export class WebSocketServerConnection extends ServerConnection {\r\n        \r\n        private websocket: WebSocket;\r\n\r\n        public connect(url?: string) {\r\n            if (this.state == ConnectionState.Ready || this.state == ConnectionState.Error) {\r\n                let uri = url ? url : 'ws://' + window.location.host + '/api/scene';\r\n                this.state = ConnectionState.Connecting;\r\n                this.websocket = new WebSocket(uri);\r\n                this.websocket.binaryType = 'arraybuffer';\r\n                this.websocket.onopen = (event: Event) => {\r\n                    this.state = ConnectionState.Connected;\r\n                    console.log('websocket connected.')\r\n                    if (this.handleConnected) {\r\n                        this.handleConnected(event);\r\n                    }\r\n                };\r\n                this.websocket.onclose = (event) => {\r\n                    console.log('websocket closed.');\r\n                    this.state = ConnectionState.Ready;\r\n                };\r\n                this.websocket.onerror = (event) => {\r\n                    this.state = ConnectionState.Error;\r\n                    console.log('websocket error.')\r\n                };\r\n                this.websocket.onmessage = (event) => {\r\n                    if (this.handleMessage) {\r\n                        this.handleMessage(event);\r\n                    }\r\n                };\r\n            } else {\r\n            }\r\n        }\r\n\r\n        public disconnect() {\r\n            this.websocket.close();\r\n        }\r\n\r\n        public send(data: any) {\r\n            this.websocket.send(data);\r\n        }\r\n    }\r\n\r\n    export class Tool {\r\n\r\n        protected interfaceController: InterfaceController;\r\n\r\n        public enter(interfaceController: InterfaceController) {\r\n            this.interfaceController = interfaceController;\r\n        }\r\n\r\n        public leave() { }\r\n\r\n        public handleKeyUp(e: JQuery.Event): boolean { return false; }\r\n\r\n        public handleMouseMove(e: JQuery.Event, x: number, y: number) { }\r\n\r\n        public handleMouseDown(e: JQuery.Event) { }\r\n\r\n        public handleMouseUp(e: JQuery.Event) { }\r\n\r\n        public handleDrag(e: JQuery.Event, startX: number, startY: number, dX: number, dY: number) { }\r\n\r\n        public handleMouseWheel(e: JQuery.Event) { }\r\n\r\n        public handleClick(e: JQuery.Event, x: number, y: number) { }\r\n\r\n    }\r\n\r\n    export class InterfaceController {\r\n\r\n        private tools: Array<Tool> = [];\r\n\r\n        private hasTool() {\r\n            return this.tools.length > 0;\r\n        }\r\n\r\n        public get CurrentTool(): Tool {\r\n            return this.hasTool() ? this.tools[this.tools.length - 1] : null;\r\n        }\r\n\r\n        private leftButton = 0;\r\n\r\n        private leftButtonDown: boolean = false;\r\n\r\n        private startX: number = NaN;\r\n\r\n        private startY: number = NaN;\r\n\r\n        private lastX: number = NaN;\r\n\r\n        private lastY: number = NaN;\r\n\r\n        private target: JQuery;\r\n\r\n        public onMove: (e: JQuery.Event, x: number, y: number) => void = null;\r\n\r\n        public onDrag: (e: JQuery.Event, dX: number, dY: number) => void = null;\r\n\r\n        public onMouseWheel: (e: JQuery.Event) => void = null;\r\n\r\n        constructor() {\r\n        }\r\n\r\n        public bindEvents(target: JQuery) {\r\n            this.target = target;\r\n\r\n            $(target).on('mousewheel', (e) => {\r\n                this.mouseWheel(e);\r\n            });\r\n\r\n            $(target).on('mousedown touchstart', (e) => {\r\n                this.mouseDown(e);\r\n                e.preventDefault();\r\n            });\r\n\r\n            if (!(<any>target).setCapture) {\r\n                $(document).on('mousemove touchmove', (e) => {\r\n                    this.mouseMove(e);\r\n                });\r\n            } else {\r\n                $(target).on('mousemove touchmove', (e) => {\r\n                    this.mouseMove(e);\r\n                });\r\n            }\r\n\r\n            $(document).on('mouseup touchend touchcancel', (e) => {\r\n                this.mouseUp(e);\r\n                e.preventDefault();\r\n            });\r\n\r\n            $(target).on('losecapture', (e) => {\r\n                this.mouseUp(e);\r\n                e.preventDefault();\r\n            });\r\n\r\n            $(document).on('keyup', (e) => {\r\n                if (this.keyUp(e)) {\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n        }\r\n\r\n        private updateLastPosition(e: JQuery.Event) {\r\n            this.lastX = e.clientX;\r\n            this.lastY = e.clientY;\r\n        }\r\n\r\n        public pushTool(tool: Tool) {\r\n            if (this.CurrentTool) {\r\n                this.CurrentTool.leave();\r\n            }\r\n\r\n            this.tools.push(tool);\r\n\r\n            tool.enter(this);\r\n        }\r\n\r\n        public popTool() {\r\n            if (this.tools.length > 0) {\r\n                this.tools[this.tools.length - 1].leave();\r\n                this.tools.pop();\r\n            }\r\n            if (this.tools.length > 0) {\r\n                this.tools[this.tools.length - 1].enter(this);\r\n            }\r\n        }\r\n\r\n        private keyUp(e: JQuery.Event): boolean {\r\n            if (this.hasTool()) {\r\n                return this.CurrentTool.handleKeyUp(e);\r\n            } else {\r\n                return false;\r\n            }\r\n\r\n        }\r\n\r\n        private mouseDown(e: JQuery.TriggeredEvent) {\r\n            if (e.button == this.leftButton) {\r\n                this.leftButtonDown = true;\r\n                this.startX = e.clientX;\r\n                this.startY = e.clientY;\r\n                this.updateLastPosition(e);\r\n                if (e.target.setCapture) e.target.setCapture();\r\n            }\r\n\r\n            if (this.hasTool() && !e.ctrlKey) {\r\n                this.CurrentTool.handleMouseDown(e);\r\n            } \r\n        }\r\n\r\n        private mouseMove(e: JQuery.Event) {\r\n            if (this.hasTool() && !e.ctrlKey) {\r\n                if (this.leftButtonDown) {\r\n                    this.CurrentTool.handleDrag(e, this.startX, this.startY, e.clientX - this.lastX, e.clientY - this.lastY);\r\n                } \r\n                this.CurrentTool.handleMouseMove(e, e.clientX, e.clientY);\r\n                \r\n            } else {\r\n                if (this.leftButtonDown) {\r\n                    this.drag(e, e.clientX - this.lastX, e.clientY - this.lastY);\r\n                } else {\r\n                    this.onMove(e, e.clientX, e.clientY);\r\n                }\r\n            }\r\n\r\n            if (this.leftButtonDown) {\r\n                this.updateLastPosition(e);\r\n            }\r\n        }\r\n\r\n        private mouseUp(e: JQuery.TriggeredEvent) {\r\n            let updatePosition = false;\r\n            if (e.button == this.leftButton) {\r\n                this.leftButtonDown = false;\r\n                updatePosition = true;\r\n\r\n                if (e.target.releaseCapture) e.target.releaseCapture();\r\n            }\r\n\r\n            if (this.hasTool() && !e.ctrlKey) {\r\n                this.CurrentTool.handleMouseUp(e);\r\n            } else {\r\n                if (updatePosition) {\r\n                    this.updateLastPosition(e);\r\n                }\r\n            }\r\n        }\r\n\r\n        private drag(e: JQuery.Event, dX: number, dY: number) {\r\n            if (this.onDrag) {\r\n                this.onDrag(e, dX, dY);\r\n            }\r\n        }\r\n\r\n        private mouseWheel(e: JQuery.Event) {\r\n            if (this.hasTool() && !e.ctrlKey) {\r\n                this.CurrentTool.handleMouseWheel(e);\r\n            } else {\r\n                if (this.onMouseWheel) {\r\n                    this.onMouseWheel(e);\r\n                }\r\n                e.preventDefault();\r\n            }\r\n        }\r\n    }\r\n\r\n    export class CameraController {\r\n        private stage: StageWebGL;\r\n        private camera: CameraWebGL;\r\n        private connection: ServerConnection;\r\n        private radius: number = 20.0;\r\n        private yaw: number = 0.0;\r\n        private pitch: number = 0.0;\r\n        private center: psgeometry.Vec3;\r\n\r\n        private dragDivisor = 100.0;\r\n        private rotateDivisor = 200.0;\r\n\r\n        public get Yaw() {\r\n            return this.yaw;\r\n        }\r\n\r\n        public set Yaw(value: number) {\r\n            this.yaw = value;\r\n            this.updateCamera();\r\n        }\r\n\r\n        constructor(stage: StageWebGL, camera: CameraWebGL, interfaceController: InterfaceController, connection: ServerConnection) {\r\n            this.stage = stage;\r\n            this.camera = camera;\r\n            this.connection = connection;\r\n\r\n            interfaceController.bindEvents($(stage.Canvas));\r\n            interfaceController.onDrag = (e, dX, dY) => {\r\n                this.drag(e, dX, dY);\r\n            };\r\n\r\n            interfaceController.onMouseWheel = (e) => {\r\n                this.mouseWheel(e);\r\n            };\r\n\r\n            interfaceController.onMove = (e, x, y) => {\r\n                this.move(e, x, y);\r\n            };\r\n\r\n            this.center = new psgeometry.Vec3(0.0, 0.0, 0.0);\r\n\r\n            this.updateCamera();\r\n        }\r\n\r\n        public construct(radius: number, pitch: number, yaw: number) {\r\n            this.radius = radius;\r\n            this.pitch = pitch;\r\n            this.yaw = yaw;\r\n\r\n            this.updateCamera();\r\n        }\r\n\r\n        private mouseWheel(e: JQuery.Event) {\r\n            if (e.shiftKey) {\r\n                let d = this.getViewDir().multiply((<any>e).deltaY || (<any>e).deltaX);\r\n                this.center = this.center.sub(d);\r\n            } else {\r\n                this.radius += (<any>e).deltaY * Math.log(this.radius + 1) / 2;\r\n                this.radius = Math.max(0.01, this.radius);\r\n            }\r\n            this.updateCamera();\r\n        }\r\n\r\n        private move(e: JQuery.Event, x: number, y: number) {\r\n        }\r\n\r\n        private drag(e: JQuery.Event, dX: number, dY: number) {\r\n\r\n            if (e.shiftKey) {\r\n                let x = this.getViewPlaneX();\r\n                let y = this.getViewPlaneY();\r\n                this.center = this.center\r\n                    .add(x.multiply(dX / this.dragDivisor))\r\n                    .add(y.multiply(dY / this.dragDivisor));\r\n            } else {\r\n                this.yaw -= dX / this.rotateDivisor;\r\n                this.pitch = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, this.pitch - dY / this.rotateDivisor));\r\n            }\r\n\r\n            this.updateCamera();\r\n        }\r\n\r\n        private getViewPlaneX() {\r\n            let q, r, v;\r\n\r\n            v = new psgeometry.Vec3(-1.0, 0.0, 0.0);\r\n            q = new psgeometry.Quaternion();\r\n            r = new psgeometry.Quaternion();\r\n            q.setFromAxisAngle(new psgeometry.Vec3(0.0, 1.0, 0.0), this.yaw);\r\n            r.setFromAxisAngle(new psgeometry.Vec3(1.0, 0.0, 0.0), this.pitch);\r\n            v = v.applyQuaternion(r);\r\n            v = v.applyQuaternion(q);\r\n\r\n            return v; //.add(this.center);\r\n        }\r\n\r\n        private getViewPlaneY() {\r\n            let q, r, v;\r\n\r\n            v = new psgeometry.Vec3(0.0, 1.0, 0.0);\r\n            q = new psgeometry.Quaternion();\r\n            r = new psgeometry.Quaternion();\r\n            q.setFromAxisAngle(new psgeometry.Vec3(0.0, 1.0, 0.0), this.yaw);\r\n            r.setFromAxisAngle(new psgeometry.Vec3(1.0, 0.0, 0.0), this.pitch);\r\n            v = v.applyQuaternion(r);\r\n            v = v.applyQuaternion(q);\r\n\r\n            return v; //.add(this.center);\r\n        }\r\n\r\n        private getViewDir(): psgeometry.Vec3 {\r\n            let q, r, v;\r\n\r\n            v = new psgeometry.Vec3(0.0, 0.0, -1.0);\r\n            q = new psgeometry.Quaternion();\r\n            r = new psgeometry.Quaternion();\r\n            q.setFromAxisAngle(new psgeometry.Vec3(0.0, 1.0, 0.0), this.yaw);\r\n            r.setFromAxisAngle(new psgeometry.Vec3(1.0, 0.0, 0.0), this.pitch);\r\n            v = v.applyQuaternion(r);\r\n            v = v.applyQuaternion(q);\r\n\r\n            return v; //.add(this.center);\r\n        }\r\n\r\n        private getCameraPos() {\r\n            let q, r, v;\r\n\r\n            v = new psgeometry.Vec3(0.0, 0.0, this.radius);\r\n            q = new psgeometry.Quaternion();\r\n            r = new psgeometry.Quaternion();\r\n            q.setFromAxisAngle(new psgeometry.Vec3(0.0, 1.0, 0.0), this.yaw);\r\n            r.setFromAxisAngle(new psgeometry.Vec3(1.0, 0.0, 0.0), this.pitch);\r\n            v = v.applyQuaternion(r);\r\n            v = v.applyQuaternion(q);\r\n\r\n            return v.add(this.center);\r\n        }\r\n\r\n        private updateCamera() {\r\n            this.camera.update(this.getCameraPos(), this.center, new psgeometry.Vec3(0.0, 1.0, 0.0));\r\n        }\r\n    }\r\n\r\n    export class CommonMessageTypes {\r\n        public static AppStateDelta = 0x0100;\r\n        public static ServerHandshake = 0x0101;\r\n        public static ClientHandshake = 0x0102;\r\n        public static ClientConfirmation = 0x0103;\r\n        public static AppStateInitialization = 0x104;\r\n        public static AnchorRequest = 0x01fe;\r\n        public static SharedAnchor = 0x01ff;\r\n    }\r\n\r\n    export class NetworkChannelMessage {\r\n\r\n        public static HeaderSize = 8;\r\n\r\n        private messageType: number = CommonMessageTypes.AppStateDelta;\r\n\r\n        private content: Uint8Array;\r\n\r\n        public get Content() {\r\n            return this.content;\r\n        }\r\n\r\n        public get MessageType() {\r\n            return this.messageType;\r\n        }\r\n\r\n        public static FromBuffer(buffer: Uint8Array) {\r\n            let result = new NetworkChannelMessage();\r\n            result.content = buffer;\r\n            return result;\r\n        }\r\n\r\n        public get HasPayload() {\r\n            return this.content.byteLength > NetworkChannelMessage.HeaderSize;\r\n        }\r\n\r\n        public get PayloadSize() {\r\n            return this.content.byteLength - NetworkChannelMessage.HeaderSize;\r\n        }\r\n    \r\n    }\r\n\r\n}\r\n","/// ModelStage Â© 2018 Plansysteme GmbH, Hamburg, Germany. All rights reserved.\r\n\r\nimport { psgeometry } from './ps-geometry';\r\nimport { modelstageweb } from './mx-common';\r\n\r\nexport module modelstageappstate {\r\n\r\n    /** The base class for local app state storage.\r\n      *\r\n      * App state data is organized in clusters. Each cluster has a distinct data layout comparable to a struct data type.\r\n      * A cluster can store and manage multiple values (AppStateEntry). Depending on the nature of the data, it can be global\r\n      * (shared among all peers) or local (each peer has its own copy of the cluster and is aware of the remote peer's instances).\r\n      * Besides that, global as well as local clusters can be single-instance or multi-instance. Global, single-instance data exists\r\n      * only once. Global, multi-instance data is shared among all peers, but can consist of multiple instances of the same \r\n      * \"record\". Each instance has a peer ID and an instance ID both ID fields together build a \"globally\" unique ID. For\r\n      * local, single-instance clusters, each peer may or may not have a single instance of the cluster, for local, multi-instance\r\n      * clusters, each peer may have zero or more instances of the cluster, again identified by a combination of a peer ID and an\r\n      * instance ID.\r\n      */\r\n    export class AppStateBase {\r\n        private clusterManagers: { [key: string]: AppStateClusterManagerBase } = {};\r\n\r\n        private localPeerID: string;\r\n\r\n        public get LocalPeerID(): string {\r\n            return this.localPeerID;\r\n        }\r\n\r\n        public set LocalPeerID(value: string) {\r\n            this.localPeerID = value;\r\n        }\r\n\r\n        public getClusterManager(key: string) {\r\n            return this.clusterManagers[key];\r\n        }\r\n\r\n        /** Adds a certain cluster type (global/local, single/multi) to the app state.\r\n          */\r\n        public addCluster(key: string, cluster: AppStateClusterManagerBase) {\r\n            this.clusterManagers[key] = cluster;\r\n\r\n        }\r\n\r\n        /** Starts the transactional phase of the app state. Changes to entries and their values may only be carried out\r\n          * during the transactional phase of the app state.\r\n          */\r\n        public beginTransaction() {\r\n            for (let clusterManagerKey in this.clusterManagers) {\r\n                this.clusterManagers[clusterManagerKey].beginTransaction();\r\n            }\r\n        }\r\n\r\n        /** Ends the transactional phase of the app state. Afterwards, the synchronisation takes place. To ensure that local state\r\n          * changes aren't missed, an exception is thrown if the state is not transactional when entries or their values are being changed.\r\n          */\r\n        public endTransaction() {\r\n            for (let clusterManagerKey in this.clusterManagers) {\r\n                this.clusterManagers[clusterManagerKey].endTransaction();\r\n            }\r\n        }\r\n\r\n        /** Applies app state changes to the view state of the application. This method is being called after all local changes have\r\n          * been carried out (the \"transactional phase\") and after the synchronisation took place. Therefore, all changes for the current\r\n          * update cycle have been carried out and will be reflected in the view state. This method will be used in client-type applications that\r\n          * need to maintain a view state. For server-type applications, where this is not the case, use \\ref ProcessChanges() instead.\r\n          */\r\n        public applyChanges(scene: modelstageweb.SceneWebGL) {\r\n            for (let clusterManagerKey in this.clusterManagers) {\r\n                this.clusterManagers[clusterManagerKey].applyChanges(scene);\r\n            }\r\n        }\r\n\r\n        /** Writes all local operations that have been carried out during the transactional phase of this update cycle (\"Delta\"). \r\n          */\r\n        public serializeTransaction(deltaWriter: AppStateDeltaWriter) {\r\n            for (let clusterManagerKey in this.clusterManagers) {\r\n                this.clusterManagers[clusterManagerKey].serializeTransaction(deltaWriter, clusterManagerKey, this);\r\n            }\r\n        }\r\n\r\n        /** Retrieves all remote operations that have been received from remote peers.\r\n          */\r\n        public deserializeTransaction(deltaReader: AppStateDeltaReader, scene: modelstageweb.SceneWebGL) {\r\n            let success = true;\r\n\r\n            while (!deltaReader.isAtEnd() && success) {\r\n                let clusterID = deltaReader.readClusterID();\r\n\r\n                if (clusterID) {\r\n                    let clusterManager = this.clusterManagers[clusterID];\r\n                    if (clusterManager) {\r\n                        success = clusterManager.deserializeTransaction(deltaReader, this, scene);\r\n                    }\r\n                    else {\r\n                        success = false;\r\n                    }\r\n                }\r\n                else {\r\n                    success = false;\r\n                }\r\n            }\r\n\r\n            return success;\r\n        }\r\n    }\r\n\r\n    export class AppState extends AppStateBase {\r\n        private static Instance = null;\r\n        public static GetInstance(): AppState {\r\n            if (!AppState.Instance) {\r\n                AppState.Instance = new AppState();\r\n            }\r\n            return AppState.Instance;\r\n        }\r\n    }\r\n\r\n    export class BinaryWriter {\r\n        private buf: Array<number> = [];\r\n\r\n        public flush(): Uint8Array {\r\n            let result = new Uint8Array(this.buf.length);\r\n            result.set(this.buf);\r\n            return result;\r\n        }\r\n\r\n        public writeByte(val: number) {\r\n            this.buf.push(val);\r\n        }\r\n\r\n        public writeInt16(val: number) {\r\n            this.buf.push(val & 0xff,\r\n                (val >> 8) & 0xff);\r\n        }\r\n\r\n        public writeUInt16(val: number) {\r\n            this.buf.push(val & 0xff,\r\n                (val >> 8) & 0xff);\r\n        }\r\n\r\n        public writeInt32(val: number) {\r\n            this.buf.push(val & 0xff,\r\n                (val >> 8) & 0xff,\r\n                (val >> 16) & 0xff,\r\n                (val >> 24) & 0xff);\r\n        }\r\n\r\n        public writeInt64(val: number) {\r\n            this.buf.push(val & 0xff,\r\n                (val >> 8) & 0xff,\r\n                (val >> 16) & 0xff,\r\n                (val >> 24) & 0xff,\r\n                (val >> 32) & 0xff,\r\n                (val >> 40) & 0xff,\r\n                (val >> 48) & 0xff,\r\n                (val >> 56) & 0xff);\r\n        }\r\n\r\n        public writeTimestamp(val: number) {\r\n            this.writeInt64(val);\r\n        }\r\n\r\n        public writeFloat32(val: number) {\r\n            let buf = new ArrayBuffer(4);\r\n            let view = new DataView(buf);\r\n            view.setFloat32(0, val, true);\r\n            let byteBuf = new Int8Array(buf);\r\n            this.buf.push.apply(byteBuf);\r\n        }\r\n\r\n        public writeString(val: string) {\r\n            this.writeInt32(val.length);\r\n            this.writeCharArray(val, val.length);\r\n        }\r\n\r\n        public writeCharArray(val: string, arrayLength: number) {\r\n            for (let idx = 0; idx < arrayLength; ++idx) {\r\n                this.buf.push(idx < val.length ? val.charCodeAt(idx) : 0x00);\r\n            }\r\n        }\r\n\r\n        public writeWideCharArray(val: string, arrayLength: number) {\r\n            for (let idx = 0; idx < arrayLength; ++idx) {\r\n                this.buf.push(idx < val.length ? val.charCodeAt(idx) & 0xff : 0x00,\r\n                    idx < val.length ? (val.charCodeAt(idx) >> 8) & 0xff : 0x00);\r\n            }\r\n        }\r\n\r\n        public writeVec3(val: psgeometry.Vec4) {\r\n            let buf = new ArrayBuffer(12);\r\n            let view = new DataView(buf);\r\n            view.setFloat32(0, val.x, true);\r\n            view.setFloat32(4, val.y, true);\r\n            view.setFloat32(8, val.z, true);\r\n            let byteBuf = new Uint8Array(buf);\r\n            this.buf.push.apply(byteBuf);\r\n        }\r\n\r\n        public writeVec4(val: psgeometry.Vec4) {\r\n            let buf = new ArrayBuffer(16);\r\n            let view = new DataView(buf);\r\n            view.setFloat32(0, val.x, true);\r\n            view.setFloat32(4, val.y, true);\r\n            view.setFloat32(8, val.z, true);\r\n            view.setFloat32(12, val.w, true);\r\n            let byteBuf = new Uint8Array(buf);\r\n            this.buf.push(byteBuf[0], byteBuf[1], byteBuf[2], byteBuf[3],\r\n                byteBuf[4], byteBuf[5], byteBuf[6], byteBuf[7],\r\n                byteBuf[8], byteBuf[9], byteBuf[10], byteBuf[11],\r\n                byteBuf[12], byteBuf[13], byteBuf[14], byteBuf[15]\r\n            );\r\n        }\r\n    }\r\n\r\n    export class BinaryReader {\r\n        private buf: Uint8Array;\r\n\r\n        private currentPos: number = 8;\r\n\r\n        private error: boolean = false;\r\n\r\n        public get Error() {\r\n            return this.error;\r\n        }\r\n\r\n        public get AtEnd() {\r\n            return this.currentPos >= this.buf.byteLength;\r\n        }\r\n\r\n        constructor(buf: Uint8Array) {\r\n            this.buf = buf;\r\n        }\r\n\r\n        public assureRemainingBytes(count: number): boolean {\r\n            return this.currentPos + count <= this.buf.byteLength;\r\n        }\r\n\r\n        public readByte(): number {\r\n            if (this.assureRemainingBytes(1)) {\r\n                return this.buf[this.currentPos++];\r\n            } else {\r\n                this.error = true;\r\n                return NaN;\r\n            }\r\n        }\r\n\r\n        public readUInt16(): number {\r\n            if (this.assureRemainingBytes(2)) {\r\n                return this.buf[this.currentPos++] +\r\n                    this.buf[this.currentPos++] * 256;\r\n            } else {\r\n                this.error = true;\r\n                return NaN;\r\n            }\r\n        }\r\n\r\n        public readUInt64(): number {\r\n            if (this.assureRemainingBytes(8)) {\r\n                return this.buf[this.currentPos++] +\r\n                    this.buf[this.currentPos++] * 256 +\r\n                    this.buf[this.currentPos++] * 65536 +\r\n                    this.buf[this.currentPos++] * 16777216 +\r\n                    this.buf[this.currentPos++] * 4294967296 +\r\n                    this.buf[this.currentPos++] * 1099511627776 +\r\n                    this.buf[this.currentPos++] * 281474976710656 +\r\n                    this.buf[this.currentPos++] * 72057594037927936;\r\n            } else {\r\n                this.error = true;\r\n                return NaN;\r\n            }\r\n        }\r\n\r\n        public readUInt32(): number {\r\n            if (this.assureRemainingBytes(4)) {\r\n                return this.buf[this.currentPos++] +\r\n                    this.buf[this.currentPos++] * 256 +\r\n                    this.buf[this.currentPos++] * 65536 +\r\n                    this.buf[this.currentPos++] * 16777216;\r\n            } else {\r\n                this.error = true;\r\n                return NaN;\r\n            }\r\n        }\r\n\r\n        public readString(): string {\r\n            let result = null;\r\n            let length = this.readUInt32();\r\n            if (!this.error) {\r\n                if (this.assureRemainingBytes(length)) {\r\n                    result = this.readCharArray(length);\r\n                } else {\r\n                    this.error = true;\r\n                }\r\n            }\r\n            return result;\r\n        }\r\n\r\n        public readTimestamp(): number {\r\n            return this.readUInt64();\r\n        }\r\n\r\n        public readCharArray(arrayLength: number): string {\r\n            let result = [];\r\n            let idx = 0;\r\n            while (idx < arrayLength && this.buf[this.currentPos + idx] != 0x00 && !this.error) {\r\n                if (this.currentPos < this.buf.byteLength) {\r\n                    result.push(this.buf[this.currentPos + idx++]);\r\n                } else {\r\n                    this.error = true;\r\n                }\r\n            }\r\n            this.currentPos += arrayLength;\r\n            return String.fromCharCode.apply(null, result);\r\n        }\r\n\r\n        public readFloat32(): number {\r\n            let result = NaN;\r\n\r\n            if (this.assureRemainingBytes(4)) {\r\n                let buf = new ArrayBuffer(4);\r\n                let view = new DataView(buf);\r\n                view.setUint8(0, this.buf[this.currentPos++]);\r\n                view.setUint8(1, this.buf[this.currentPos++]);\r\n                view.setUint8(2, this.buf[this.currentPos++]);\r\n                view.setUint8(3, this.buf[this.currentPos++]);\r\n\r\n                result = view.getFloat32(0, true);\r\n            } else {\r\n                this.error = true;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public readVec3(): psgeometry.Vec3 {\r\n            let result = null;\r\n\r\n            if (this.assureRemainingBytes(12)) {\r\n                let buf = new ArrayBuffer(12);\r\n                let view = new DataView(buf);\r\n                for (let i = 0; i < 12; ++i) {\r\n                    view.setUint8(i, this.buf[this.currentPos++]);\r\n                }\r\n                result = new psgeometry.Vec3(view.getFloat32(0, true), view.getFloat32(4, true), view.getFloat32(8, true));\r\n            } else {\r\n                this.error = true;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public readVec4(): psgeometry.Vec4 {\r\n            let result = null;\r\n\r\n            if (this.assureRemainingBytes(16)) {\r\n                let buf = new ArrayBuffer(16);\r\n                let view = new DataView(buf);\r\n                for (let i = 0; i < 16; ++i) {\r\n                    view.setUint8(i, this.buf[this.currentPos++]);\r\n                }\r\n                result = new psgeometry.Vec4(view.getFloat32(0, true), view.getFloat32(4, true), view.getFloat32(8, true), view.getFloat32(12, true));\r\n            } else {\r\n                this.error = true;\r\n            }\r\n\r\n            return result;\r\n        }\r\n    }\r\n\r\n    export class AppStateDeltaReader {\r\n        private reader: BinaryReader;\r\n\r\n        private isInitializing: boolean = false;\r\n\r\n        public get Reader() {\r\n            return this.reader;\r\n        }\r\n\r\n        constructor(reader: BinaryReader) {\r\n            this.reader = reader;\r\n        }\r\n\r\n        /** Indicates if there is data left to process.\r\n          */\r\n        public isAtEnd() { return this.reader.AtEnd; }\r\n\r\n        /** Reads the cluster ID from the data.\r\n          */\r\n        public readClusterID(): string {\r\n            return this.reader.readString();\r\n        }\r\n\r\n        /** Indicates if the message is an initialization message rather than a \"normal\" delta package. \r\n          * This can be evaluated by the cluster to handle initialization different from updating.\r\n          */\r\n        public get IsInitializing() {\r\n            return this.isInitializing;\r\n        }\r\n    }\r\n\r\n    export class AppStateDeltaWriter {\r\n        private writer: BinaryWriter;\r\n\r\n        public get Writer() {\r\n            return this.writer;\r\n        }\r\n\r\n        constructor(writer: BinaryWriter) {\r\n            this.writer = writer;\r\n        }\r\n\r\n\r\n    }\r\n\r\n    export abstract class AppStateEntry {\r\n        private key: string;\r\n\r\n        private appState: AppState;\r\n\r\n        private transactional: boolean = false;\r\n\r\n        protected cluster: AppStateCluster;\r\n\r\n        public get AppState() {\r\n            return this.appState;\r\n        }\r\n\r\n        public set AppState(val: AppState) {\r\n            this.appState = val;\r\n        }\r\n\r\n        public register(key: string, cluster: AppStateCluster) {\r\n            this.key = key;\r\n            this.cluster = cluster;\r\n        }\r\n\r\n        public abstract deserializeDelta(reader: AppStateDeltaReader, key: string): boolean;\r\n\r\n        public abstract serializeDelta(writer: AppStateDeltaWriter, key: string);\r\n\r\n        public reconcile() {\r\n        }\r\n\r\n        public abstract isDirty();\r\n\r\n        public setDirty() {\r\n            this.cluster.setDirty();\r\n        }\r\n\r\n        public beginTransaction() {\r\n            //assert(!m_isTransactional);\r\n            this.transactional = true;\r\n        }\r\n\r\n        public endTransaction() {\r\n            //assert(m_isTransactional);\r\n            this.transactional = false;\r\n        }\r\n\r\n        public isTransactional(): boolean {\r\n            return this.transactional;\r\n        }\r\n\r\n        public isLocked(): boolean {\r\n            return this.cluster.IsLocked;\r\n        }\r\n\r\n    }\r\n\r\n    export abstract class CommonAppStateEntry extends AppStateEntry {\r\n        protected changedAt: number = 0;\r\n\r\n        public beginChanging() {\r\n            this.changedAt = Date.now();\r\n            this.setDirty();\r\n        }\r\n\r\n\r\n    }\r\n\r\n    export class AppStateStringValue extends CommonAppStateEntry {\r\n        private dirty: boolean = false;\r\n\r\n        private value: string;\r\n\r\n        private previousValue: string;\r\n\r\n        public set(value: string) {\r\n            if (value != this.value) {\r\n                this.changing();\r\n                this.value = value;\r\n            }\r\n        }\r\n\r\n        public get(): string {\r\n            return this.value;\r\n        }\r\n\r\n        public getPreviousValue(): string {\r\n            return this.previousValue;\r\n        }\r\n\r\n        public changing() {\r\n            //assert(IsTransactional());\r\n            if (!this.dirty && !this.isLocked()) {\r\n                this.beginChanging();\r\n                this.previousValue = this.value;\r\n                this.dirty = true;\r\n            }\r\n        }\r\n\r\n        public isDirty() {\r\n            return this.dirty;\r\n        }\r\n\r\n        public beginTransaction() {\r\n            super.beginTransaction();\r\n            this.dirty = false;\r\n        }\r\n\r\n        public deserializeDelta(reader: AppStateDeltaReader, key: string) {\r\n            let result = false;\r\n\r\n            // key was read by cluster\r\n            let changedAt = reader.Reader.readTimestamp();\r\n            if (changedAt != null) {\r\n                let prevValue = reader.Reader.readString();\r\n                if (prevValue != null) {\r\n                    this.value = reader.Reader.readString();\r\n                    this.dirty = true;\r\n                    this.setDirty();\r\n                    result = true;\r\n                }\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public serializeDelta(writer: AppStateDeltaWriter, key: string) {\r\n            writer.Writer.writeString(key);\r\n            writer.Writer.writeTimestamp(this.changedAt);\r\n            writer.Writer.writeString(this.previousValue);\r\n            writer.Writer.writeString(this.value);\r\n        }\r\n\r\n    }\r\n\r\n    export abstract class AppStateValue<T> extends CommonAppStateEntry {\r\n        private dirty: boolean = false;\r\n\r\n        private value: T;\r\n\r\n        private previousValue: T;\r\n\r\n        public set(value: T) {\r\n            this.value = value;\r\n        }\r\n\r\n        public get(): T {\r\n            return this.value;\r\n        }\r\n\r\n        public isDirty() {\r\n            return this.dirty;\r\n        }\r\n\r\n        public beginTransaction() {\r\n            super.beginTransaction();\r\n            this.dirty = false;\r\n        }\r\n\r\n        protected abstract readValue(reader: AppStateDeltaReader): T;\r\n\r\n        protected abstract writeValue(writer: AppStateDeltaWriter, value: T);\r\n\r\n        public deserializeDelta(reader: AppStateDeltaReader, key: string) {\r\n            let result = false;\r\n\r\n            // key was read by cluster\r\n            let changedAt = reader.Reader.readTimestamp();\r\n            if (changedAt != null) {\r\n                let prevValue = this.readValue(reader);\r\n                if (prevValue != null) {\r\n                    this.value = this.readValue(reader);\r\n                    this.dirty = true;\r\n                    this.setDirty();\r\n                    result = true;\r\n                }\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        public serializeDelta(writer: AppStateDeltaWriter, key: string) {\r\n            writer.Writer.writeString(key);\r\n            writer.Writer.writeTimestamp(this.changedAt);\r\n            this.writeValue(writer, this.previousValue);\r\n            this.writeValue(writer, this.value);\r\n        }\r\n    }\r\n\r\n    export class AppStateBoolValue extends AppStateValue<boolean> {\r\n        protected readValue(reader: AppStateDeltaReader): boolean {\r\n            let result: boolean = false;\r\n\r\n            if (reader.Reader.assureRemainingBytes(1)) {\r\n                result = reader.Reader.readByte() != 0;\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        protected writeValue(writer: AppStateDeltaWriter, value: boolean) {\r\n            writer.Writer.writeByte(value ? 0xff : 0);\r\n        }\r\n\r\n    }\r\n\r\n    export class AppStateVector4Value extends AppStateValue<psgeometry.Vec4> {\r\n        protected readValue(reader: AppStateDeltaReader): psgeometry.Vec4 {\r\n            let result: psgeometry.Vec4 = null;\r\n\r\n            // sizeof(float) * (x,y,z,w)\r\n            if (reader.Reader.assureRemainingBytes(4 * 4)) {\r\n                result = new psgeometry.Vec4();\r\n                result.x = reader.Reader.readFloat32();\r\n                result.y = reader.Reader.readFloat32();\r\n                result.z = reader.Reader.readFloat32();\r\n                result.w = reader.Reader.readFloat32();\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        protected writeValue(writer: AppStateDeltaWriter, value: psgeometry.Vec4) {\r\n            writer.Writer.writeFloat32(value.x);\r\n            writer.Writer.writeFloat32(value.y);\r\n            writer.Writer.writeFloat32(value.z);\r\n            writer.Writer.writeFloat32(value.w);\r\n        }\r\n\r\n    }\r\n\r\n    export class AppStateFloatValue extends AppStateValue<number> {\r\n        protected readValue(reader: AppStateDeltaReader): number {\r\n            let result = NaN;\r\n\r\n            if (reader.Reader.assureRemainingBytes(4)) {\r\n                result = reader.Reader.readFloat32();\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        protected writeValue(writer: AppStateDeltaWriter, value: number) {\r\n            writer.Writer.writeFloat32(value);\r\n        }\r\n\r\n    }\r\n\r\n    export class AppStateOperation {\r\n        protected changedAt: number;\r\n\r\n        protected isLocal: boolean;\r\n\r\n        public get ChangedAt() {\r\n            return this.changedAt;\r\n        }\r\n\r\n        public get IsLocal() {\r\n            return this.isLocal;\r\n        }\r\n\r\n        constructor(changedAt: number, isLocal: boolean = true) {\r\n            this.changedAt = changedAt;\r\n            this.isLocal = isLocal;\r\n        }\r\n    }\r\n\r\n    export class AppStateValueOperation<T> extends AppStateOperation {\r\n\r\n        protected isNewValueDefined = false;\r\n\r\n        protected isPreviousValueDefined = false;\r\n\r\n        protected newValue: T;\r\n\r\n        protected previousValue: T;\r\n\r\n        public get IsNewValueDefined() {\r\n            return this.isNewValueDefined;\r\n        }\r\n\r\n        public get IsPreviousValueDefined() {\r\n            return this.isPreviousValueDefined;\r\n        }\r\n\r\n        public get NewValue() {\r\n            return this.newValue;\r\n        }\r\n\r\n        public get PreviousValue() {\r\n            return this.previousValue;\r\n        }\r\n\r\n        constructor(changedAt: number, newValue: T = null, previousValue: T = null, isLocal: boolean = true) {\r\n            super(changedAt, isLocal);\r\n            if (newValue != null) {\r\n                this.isNewValueDefined = true;\r\n                this.newValue = newValue;\r\n            }\r\n            if (previousValue) {\r\n                this.isPreviousValueDefined = true;\r\n                this.previousValue = previousValue;\r\n            }\r\n        }\r\n    }\r\n\r\n    export enum OperationType {\r\n        Clear,\r\n        Append,\r\n        Insert,\r\n        Remove,\r\n        Replace\r\n    }\r\n\r\n    enum StorageFlags {\r\n        HasPreviousValue = 0x80,\r\n        HasNewValue = 0x40,\r\n        HasChangedDate = 0x20,\r\n        ItemIndex16Bit = 0x10,\r\n\r\n        None = 0x00,\r\n\r\n        Mask = 0xf0\r\n    };\r\n\r\n    export class AppStateCollectionOperation<T> extends AppStateValueOperation<T> {\r\n\r\n        protected operation: OperationType;\r\n\r\n        protected itemIndex: number;\r\n\r\n        protected reconciledItemIndex: number;\r\n\r\n        public get Operation() {\r\n            return this.operation;\r\n        }\r\n\r\n        public get ItemIndex() {\r\n            return this.itemIndex;\r\n        }\r\n\r\n        public get ReconciledItemIndex() {\r\n            return this.reconciledItemIndex;\r\n        }\r\n\r\n        public set ReconciledItemIndex(value: number) {\r\n            this.reconciledItemIndex = value;\r\n        }\r\n\r\n        constructor(changedAt: number, operation: OperationType, itemIndex: number = 0, newValue: T = null, previousValue: T = null, isLocal: boolean = true) {\r\n            super(changedAt, newValue, previousValue, isLocal);\r\n            this.operation = operation;\r\n            this.itemIndex = itemIndex;\r\n            this.reconciledItemIndex = itemIndex;\r\n        }\r\n\r\n    }\r\n\r\n    export class AppStateCollection<T> extends CommonAppStateEntry {\r\n        protected container: Array<T> = [];\r\n\r\n        protected serializeOperationChangedAt: boolean;\r\n\r\n        protected serializePreviousValues: boolean;\r\n\r\n        protected operations: Array<AppStateCollectionOperation<T>> = [];\r\n\r\n        public get Operations() {\r\n            return this.operations;\r\n        }\r\n\r\n        public constructor(private appStateCollectionOperationType: new (changedAt: number, operation: OperationType, itemIndex?: number, newValue?: T, previousValue?: T, isLocal?: boolean) => AppStateCollectionOperation<T>, serializeOperationChangedAt: boolean = true, serializePreviousValues: boolean = true) {\r\n            super();\r\n            this.serializeOperationChangedAt = serializeOperationChangedAt;\r\n            this.serializePreviousValues = serializePreviousValues;\r\n        }\r\n\r\n        protected addOperation(op: AppStateCollectionOperation<T>) {\r\n            if (this.isTransactional()) {\r\n                if (this.operations.length == 0) {\r\n                    this.beginChanging();\r\n                }\r\n                this.operations.push(op);\r\n            } else {\r\n                console.error('AppState not transactional while adding operation to AppStateCollection');\r\n            }\r\n        }\r\n\r\n        public clear() {\r\n            if (!this.isLocked()) {\r\n                this.addOperation(new this.appStateCollectionOperationType(this.changedAt, OperationType.Clear));\r\n            }\r\n            this.container.length = 0;\r\n        }\r\n\r\n        public append(item: T) {\r\n            if (!this.isLocked()) {\r\n                this.addOperation(new this.appStateCollectionOperationType(this.changedAt, OperationType.Append, this.container.length, item));\r\n            }\r\n            this.container.push(item);\r\n        }\r\n\r\n        public insert(item: T, beforeIndex: number) {\r\n            if (beforeIndex <= this.container.length) {\r\n                if (!this.isLocked()) {\r\n                    this.addOperation(new this.appStateCollectionOperationType(this.changedAt, OperationType.Insert, beforeIndex, item));\r\n                }\r\n                this.container.splice(beforeIndex, 0, item);\r\n            } else {\r\n                console.error('Index out of range while inserting into AppStateCollection');\r\n            }\r\n        }\r\n\r\n        public remove(index: number) {\r\n            if (index < this.container.length) {\r\n                if (!this.isLocked()) {\r\n                    this.addOperation(new this.appStateCollectionOperationType(this.changedAt, OperationType.Remove, index, null, this.container[index]));\r\n                }\r\n                this.container.splice(index, 1);\r\n            } else {\r\n                console.error('Index out of range while removing from AppStateCollection');\r\n            }\r\n        }\r\n\r\n        public replace(item: T, index: number) {\r\n            if (index < this.container.length) {\r\n                if (!this.isLocked()) {\r\n                    this.addOperation(new this.appStateCollectionOperationType(this.changedAt, OperationType.Replace, index, item, this.container[index]));\r\n                }\r\n                this.container[index] = item;\r\n            } else {\r\n                console.error('Index out of range while replacing item in AppStateCollection');\r\n            }\r\n        }\r\n\r\n        public GetItemAt(index: number) {\r\n            return this.container[index];\r\n        }\r\n\r\n        public get Count() {\r\n            return this.container.length;\r\n        }\r\n\r\n        public isDirty() {\r\n            return this.operations.length > 0;\r\n        }\r\n\r\n        public deserializeDelta(reader: AppStateDeltaReader, key: string) {\r\n            // key was read by cluster\r\n            let changedAt = reader.Reader.readTimestamp();\r\n            let operationCount = reader.Reader.readUInt32();\r\n            let success = !reader.Reader.Error;\r\n\r\n            if (success) {\r\n\r\n                if (operationCount > 0) {\r\n                    this.setDirty();\r\n                }\r\n\r\n                for (let i = 0; i < operationCount; ++i) {\r\n                    let flags = reader.Reader.readByte();\r\n                    if (!reader.Reader.Error) {\r\n                        let storageFlags: StorageFlags = flags & StorageFlags.Mask;\r\n                        let opType: OperationType = flags & ~StorageFlags.Mask;\r\n\r\n                        let opChangedAt = changedAt;\r\n                        let itemIndex = 0;\r\n                        let newValue: T;\r\n                        let prevValue: T;\r\n\r\n                        if (storageFlags & StorageFlags.HasChangedDate) {\r\n                            opChangedAt = reader.Reader.readTimestamp();\r\n                            success = success && !reader.Reader.Error;\r\n                        }\r\n                        if (storageFlags & StorageFlags.ItemIndex16Bit) {\r\n                            itemIndex = reader.Reader.readUInt16();\r\n                            success = success && !reader.Reader.Error;\r\n                        }\r\n                        else {\r\n                            itemIndex = reader.Reader.readUInt32();\r\n                            success = success && !reader.Reader.Error;\r\n                        }\r\n                        if (storageFlags & StorageFlags.HasNewValue) {\r\n                            newValue = <T>this.cluster.readValue(key, reader);\r\n                            success = success && !reader.Reader.Error;\r\n                        }\r\n                        if (storageFlags & StorageFlags.HasPreviousValue) {\r\n                            prevValue = <T>this.cluster.readValue(key, reader);\r\n                            success = success && !reader.Reader.Error;\r\n                        }\r\n\r\n                        this.operations.push(new this.appStateCollectionOperationType(opChangedAt, opType, itemIndex, newValue, prevValue, false /* IsLocal */));\r\n\r\n                    }\r\n                    else {\r\n                        success = false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return success;\r\n\r\n        }\r\n\r\n        public serializeDelta(writer: AppStateDeltaWriter, key: string) {\r\n            writer.Writer.writeString(key);\r\n            writer.Writer.writeTimestamp(this.changedAt);\r\n\r\n            writer.Writer.writeInt32(this.operations.length);\r\n\r\n            this.operations.forEach((op) => {\r\n\r\n                let storageFlags: StorageFlags =\r\n                    (op.ItemIndex < 0x10000 ? StorageFlags.ItemIndex16Bit : StorageFlags.None) |\r\n                    (op.IsNewValueDefined ? StorageFlags.HasNewValue : StorageFlags.None) |\r\n                    (op.IsPreviousValueDefined && this.serializePreviousValues ? StorageFlags.HasPreviousValue : StorageFlags.None) |\r\n                    (this.serializeOperationChangedAt ? StorageFlags.HasChangedDate : StorageFlags.None);\r\n\r\n                writer.Writer.writeByte(op.Operation | storageFlags);\r\n\r\n                if (storageFlags & StorageFlags.HasChangedDate) {\r\n                    writer.Writer.writeTimestamp(op.ChangedAt);\r\n                }\r\n\r\n                if (storageFlags & StorageFlags.ItemIndex16Bit) {\r\n                    writer.Writer.writeUInt16(op.ItemIndex);\r\n                }\r\n                else {\r\n                    writer.Writer.writeInt32(op.ItemIndex);\r\n                }\r\n\r\n                if (storageFlags & StorageFlags.HasNewValue) {\r\n                    this.cluster.writeValue(key, writer, op.NewValue);\r\n                }\r\n\r\n                if (storageFlags & StorageFlags.HasPreviousValue) {\r\n                    this.cluster.writeValue(key, writer, op.PreviousValue);\r\n                }\r\n            });\r\n        }\r\n\r\n        public reconcile() {\r\n            this.operations.forEach((operation) => {\r\n                if (!operation.IsLocal) {\r\n                    switch (operation.Operation) {\r\n                        case OperationType.Clear:\r\n                            this.container.length = 0;\r\n                            operation.ReconciledItemIndex = -1;\r\n                            break;\r\n                        case OperationType.Append:\r\n                            if (operation.IsNewValueDefined) {\r\n                                this.container.push(operation.NewValue);\r\n                                operation.ReconciledItemIndex = this.container.length - 1;\r\n                            } else {\r\n                                console.error('Expected new value during AppStateCollection.Append reconciliation');\r\n                            }\r\n                            break;\r\n                        case OperationType.Insert:\r\n                            if (operation.IsNewValueDefined) {\r\n                                if (operation.ItemIndex < this.container.length) {\r\n                                    this.container.splice(operation.ItemIndex, 0, operation.NewValue);\r\n                                    operation.ReconciledItemIndex = operation.ItemIndex;\r\n                                }\r\n                                else {\r\n                                    this.container.push(operation.NewValue);\r\n                                    operation.ReconciledItemIndex = this.container.length - 1;\r\n                                }\r\n                            } else {\r\n                                console.error('Expected new value during AppStateCollection.Insert reconciliation');\r\n                            }\r\n                            break;\r\n                        case OperationType.Remove:\r\n                            if (operation.IsPreviousValueDefined) {\r\n                                if (operation.ItemIndex < this.container.length) { // && operation.PreviousValue == this.container[operation.ItemIndex]) {\r\n                                    this.container.splice(operation.ItemIndex, 1);\r\n                                    operation.ReconciledItemIndex = operation.ItemIndex;\r\n                                }\r\n                                else {\r\n                                    operation.ReconciledItemIndex = -1;\r\n                                    /// \\todo: @UB: Locate entry and remove it depending on previous value or fail reconcile if not found.\r\n                                }\r\n                            } else {\r\n                                console.error('Expected previous value during AppStateCollection.Remove reconciliation');\r\n                            }\r\n                            break;\r\n                        case OperationType.Replace:\r\n                            if (operation.IsNewValueDefined) {\r\n                                if (operation.ItemIndex < this.container.length) {\r\n                                    this.container[operation.ItemIndex] = operation.NewValue;\r\n                                    operation.ReconciledItemIndex = operation.ItemIndex;\r\n                                }\r\n                                else {\r\n                                    operation.ReconciledItemIndex = -1;\r\n                                    /// \\todo: @UB: Locate entry and replace it depending on previous value or fail reconcile if not found.\r\n                                }\r\n                            } else {\r\n                                console.error('Expected new value during AppStateCollection.Replace reconciliation');\r\n                            }\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        public beginTransaction() {\r\n            super.beginTransaction();\r\n            this.operations.length = 0;\r\n        }\r\n\r\n    }\r\n\r\n\r\n    export class AppStateClusterManagerBase {\r\n        /** A vector managing pointers to all instances of the corresponding cluster type.\r\n          */\r\n        protected allInstances: Array<AppStateCluster> = [];\r\n\r\n        /** Adds a new instance of the corresponding cluster type to this.\r\n          */\r\n        protected addInstance(instance: AppStateCluster) {\r\n            instance.registerEntries();\r\n            this.allInstances.push(instance);\r\n        }\r\n\r\n        /** Starts the transactional phase. Changes to entries and their values may only be carried out\r\n          * during the transactional phase.\r\n          */\r\n        public beginTransaction() {\r\n            for (let clusterKey in this.allInstances) {\r\n                this.allInstances[clusterKey].beginTransaction();\r\n            }\r\n        }\r\n\r\n        /** Ends the transactional phase. Afterwards, the synchronisation takes place. To ensure that local state\r\n          * changes aren't missed, an exception is thrown if the state is not transactional when entries or their values are being changed.\r\n          */\r\n        public endTransaction() {\r\n            for (let clusterKey in this.allInstances) {\r\n                this.allInstances[clusterKey].endTransaction();\r\n            }\r\n        }\r\n\r\n        /** Applies app state changes to the view state of the application. This method is being called after all local changes have\r\n          * been carried out (the \"transactional phase\") and after the synchronisation took place. Therefore, all changes for the current\r\n          * update cycle have been carried out and will be reflected in the view state.\r\n          */\r\n        public applyChanges(scene: modelstageweb.SceneWebGL) {\r\n            for (let clusterKey in this.allInstances) {\r\n                let cluster = this.allInstances[clusterKey];\r\n                if (cluster.isDirty()) {\r\n                    cluster.applyChanges(scene, cluster.PeerID, cluster.InstanceID);\r\n                    scene.setDirty();\r\n                }\r\n            }\r\n        }\r\n\r\n        /** Serializes peer ID and/or instance ID based on the nature of the concrete cluster type. Must\r\n          * be overriden by concrete subclasses of AppStateClusterManagerBase.\r\n          */\r\n        public serializeClusterInstanceData(cluster: AppStateCluster, deltaWriter: AppStateDeltaWriter, appState: AppStateBase) {\r\n        }\r\n\r\n        /** Serializes all changes that have been carried out on clusters of the corresponding type.\r\n          */\r\n        public serializeTransaction(deltaWriter: AppStateDeltaWriter, clusterID: string, appState: AppStateBase) {\r\n            let dirtyClusters: Array<AppStateCluster> = [];\r\n\r\n            for (let clusterKey in this.allInstances) {\r\n                let cluster = this.allInstances[clusterKey];\r\n                if (cluster.isDirty()) {\r\n                    dirtyClusters.push(cluster);\r\n                }\r\n            }\r\n\r\n            if (dirtyClusters.length > 0) {\r\n                deltaWriter.Writer.writeString(clusterID);\r\n                deltaWriter.Writer.writeUInt16(dirtyClusters.length);\r\n\r\n                dirtyClusters.forEach((cluster) => {\r\n                    this.serializeClusterInstanceData(cluster, deltaWriter, appState);\r\n\r\n                    cluster.serializeTransaction(deltaWriter, appState);\r\n                });\r\n            }\r\n        }\r\n\r\n        /** Deserializes remote changes that have been carried out on clusters of the corresponding type. Must\r\n          * be overriden by concrete subclasses of AppStateClusterManagerBase.\r\n          */\r\n        public deserializeTransaction(deltaReader: AppStateDeltaReader, appState: AppStateBase, scene: modelstageweb.SceneWebGL): boolean {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /** Concrete subclass of AppStateClusterManagerBase that provides a single, global instance of the specified cluster type.\r\n      */\r\n    export class GlobalAppStateClusterManager<TAppStateCluster extends AppStateCluster> extends AppStateClusterManagerBase {\r\n\r\n        private onlyInstance: TAppStateCluster;\r\n\r\n        constructor(clusterTypeID: string, private clusterType: new () => TAppStateCluster) {\r\n            super();\r\n            this.onlyInstance = new clusterType();\r\n\r\n            AppState.GetInstance().addCluster(clusterTypeID, this);\r\n            this.addInstance(this.onlyInstance);\r\n        }\r\n\r\n        /** Gets the only instance of this cluster type.\r\n          */\r\n        public getGlobalCluster(): TAppStateCluster {\r\n            return this.onlyInstance;\r\n        }\r\n\r\n        /** As global clusters don't need a peer ID or instance ID to identify, this implementation doesn't write anything.\r\n          */\r\n        public serializeClusterInstanceData(cluster: AppStateCluster, deltaWriter: AppStateDeltaWriter, appState: AppStateBase) {\r\n        }\r\n\r\n        /** As global clusters don't need a peer ID or instance ID to identify, this implementation doesn't retreive\r\n          * additional data from the reader.\r\n          */\r\n        public deserializeTransaction(deltaReader: AppStateDeltaReader, appState: AppStateBase, scene: modelstageweb.SceneWebGL): boolean {\r\n            let success = false;\r\n            let instanceCount = deltaReader.Reader.readUInt16();\r\n            if (!deltaReader.Reader.Error) {\r\n                for (let i = 0; i < instanceCount; ++i) {\r\n                    let cluster = this.getGlobalCluster();\r\n                    success = cluster.deserializeTransaction(deltaReader, appState, scene);\r\n                }\r\n            }\r\n\r\n            return success;\r\n        }\r\n    }\r\n\r\n    /** Concrete subclass of AppStateClusterManagerBase that distinguishes local and remote instances of the \r\n      * corresponding cluster type (derived from AppStateCluster). Each peer may have zero or one instances of the cluster type.\r\n      */\r\n    export class LocalAppStateClusterManager<TAppStateCluster extends AppStateCluster> extends AppStateClusterManagerBase {\r\n\r\n        /** The map of cluster per peer.\r\n          */\r\n        private peerClusters: { [key: string]: AppStateCluster } = {};\r\n\r\n        constructor(clusterTypeID: string, private clusterType: new () => TAppStateCluster) {\r\n            super();\r\n            this.peerClusters[''] = new clusterType();\r\n\r\n            AppState.GetInstance().addCluster(clusterTypeID, this);\r\n            this.addInstance(this.peerClusters['']);\r\n        }\r\n\r\n        /** Gets the local peer's instance of this cluster type.\r\n          */\r\n        public getLocalCluster(): TAppStateCluster {\r\n            return <TAppStateCluster>this.allInstances[''];\r\n        }\r\n\r\n        /** \\brief Gets the instance of this cluster type that belongs to the peer with the specified ID. If it doesn't exist,\r\n          * it's created.\r\n          */\r\n        public getCluster(peerID: string): TAppStateCluster {\r\n            let result: TAppStateCluster = null;\r\n\r\n            if (!this.containsCluster(peerID)) {\r\n                result = new this.clusterType();\r\n                this.peerClusters[peerID] = result;\r\n                result.PeerID = peerID;\r\n                this.addInstance(result);\r\n            }\r\n            else {\r\n                result = <TAppStateCluster>this.peerClusters[peerID];\r\n            }\r\n\r\n            return result;\r\n        }\r\n\r\n        /** Determines if the peer with the specified ID already has an instance of the corresponding cluster type.\r\n          */\r\n        public containsCluster(peerID: string) {\r\n            return this.peerClusters[peerID] != null;\r\n        }\r\n\r\n        /** As local clusters with a single instance only need a peer ID to identify, this implementation only writes the peerID.\r\n          * For the local peer's instance, an empty peer ID will be replaced by the actual ID of the peer.\r\n          */\r\n        public serializeClusterInstanceData(cluster: AppStateCluster, deltaWriter: AppStateDeltaWriter, appState: AppStateBase) {\r\n            let peerID = cluster.PeerID;\r\n            // Use local peerID if the cluster's peer ID is empty.\r\n            deltaWriter.Writer.writeString(peerID.length == 0 ? appState.LocalPeerID : peerID);\r\n        }\r\n\r\n        /** As local clusters with a single instance only need a peer ID to identify, this implementation retrieves a peer ID,\r\n          * but no instanceID from the delta. If the peerID is identical to the local peer's ID, it is replaced by the internal\r\n          * key (empty string) that is used to identify local peer data.\r\n          */\r\n        public deserializeTransaction(deltaReader: AppStateDeltaReader, appState: AppStateBase, scene: modelstageweb.SceneWebGL) {\r\n            let success = false;\r\n\r\n            let instanceCount = deltaReader.Reader.readUInt16();\r\n            if (!deltaReader.Reader.Error) {\r\n                for (let i = 0; i < instanceCount; ++i) {\r\n                    let peerID = deltaReader.Reader.readString();\r\n                    if (!deltaReader.Reader.Error) {\r\n\r\n                        if (peerID == appState.LocalPeerID) {\r\n                            peerID = '';\r\n                        }\r\n\r\n                        let cluster = this.getCluster(peerID);\r\n                        success = cluster.deserializeTransaction(deltaReader, appState, scene);\r\n                    }\r\n                }\r\n            }\r\n\r\n            return success;\r\n        }\r\n    }\r\n\r\n    /** AppStateCluster instances store information about the application state. Based on application state, changes\r\n\t  * to the view state are carried out. In order to be able to synchronize application state, operations on the entries that\r\n\t  * are aggregated by AppStateCluster,  are stored during a \"transactional phase\". Immediately afterwards, all changes are\r\n\t  * collected and sync'ed with remote peers. Similarly, when remote changes are received, they are processed after the local \r\n\t  * collection took place, causing app state changes. Finally, all cluster's entry's changes are processed to update the\r\n\t  * application's view state.\r\n\t  */\r\n    export abstract class AppStateCluster {\r\n        private peerID: string;\r\n\r\n        private instanceID: string;\r\n\r\n        private appState: AppStateBase;\r\n\r\n        private entries: { [index: string]: AppStateEntry } = {};\r\n\r\n        private dirty: boolean = false;\r\n\r\n        private lockCount: number = 0;\r\n\r\n        public get PeerID() {\r\n            return this.peerID;\r\n        }\r\n\r\n        public set PeerID(value: string) {\r\n            this.peerID = value;\r\n        }\r\n\r\n        public get InstanceID() {\r\n            return this.instanceID;\r\n        }\r\n\r\n        /** Constructor\r\n          * @param peerID\t\tThe peer ID this cluster instance belongs to. If it's left empty, the local peer's ID will be used.\r\n          * @param instanceID\tThe peer-unique instance ID. This ID is only necessary, if multi-instances are used (per peer). This depends on the AppStateClusterManager used to manage instances.\r\n          * @param appState\t\tThe app state container this cluster belongs to.\r\n          */\r\n        constructor(peerID?: string, instanceID?: string, appState?: AppStateBase) {\r\n            this.peerID = peerID || '';\r\n            this.instanceID = instanceID || '';\r\n            this.appState = appState || AppState.GetInstance();\r\n        }\r\n\r\n        /** Registers all entries on creation of a new cluster instance. Must be overriden by concrete clusters.\r\n          */\r\n        public abstract registerEntries();\r\n\r\n        public beginTransaction() {\r\n            this.dirty = false;\r\n            for (let entryIdx in this.entries) {\r\n                this.entries[entryIdx].beginTransaction();\r\n            }\r\n        }\r\n\r\n        public endTransaction() {\r\n            for (let entryIdx in this.entries) {\r\n                this.entries[entryIdx].endTransaction();\r\n            }\r\n        }\r\n\r\n        private reconcile(scene: modelstageweb.SceneWebGL) {\r\n            for (let entryIdx in this.entries) {\r\n                this.entries[entryIdx].reconcile();\r\n            }\r\n        }\r\n\r\n        public setDirty() {\r\n            this.dirty = true;\r\n        }\r\n\r\n        public isDirty() {\r\n            return this.dirty;\r\n        }\r\n\r\n        public registerEntry(key: string, entry: AppStateEntry) {\r\n            this.entries[key] = entry;\r\n            entry.register(key, this);\r\n        }\r\n\r\n        /** ApplyChanges is being called in each update cycle with local or remote changes. Concrete clusters should\r\n          * override ApplyChanges to update the view state based on the app state changes that occured.\r\n          */\r\n        public applyChanges(scene: modelstageweb.SceneWebGL, peerID: string, instanceID: string) {\r\n        }\r\n\r\n        /** Writes all local operations that have been carried out during the transactional phase of this update cycle (\"Delta\").\r\n          */\r\n        public serializeTransaction(deltaWriter: AppStateDeltaWriter, appState: AppStateBase) {\r\n            // setIsInitializing(deltaWriter.IsInitialization());\r\n\r\n            let dirtyEntries: Array<{ key: string, entry: AppStateEntry }> = [];\r\n\r\n            for (let idx in this.entries) {\r\n                if (this.entries[idx].isDirty()) {\r\n                    dirtyEntries.push({ key: idx, entry: this.entries[idx] });\r\n                }\r\n            }\r\n\r\n            deltaWriter.Writer.writeUInt16(dirtyEntries.length);\r\n\r\n            dirtyEntries.forEach((e) => {\r\n                e.entry.serializeDelta(deltaWriter, e.key);\r\n            });\r\n        }\r\n\r\n        /** Retrieves all remote operations that have been received from remote peers.\r\n          */\r\n        public deserializeTransaction(deltaReader: AppStateDeltaReader, appState: AppStateBase, scene: modelstageweb.SceneWebGL) {\r\n            let success = true;\r\n\r\n            let entryCount = deltaReader.Reader.readUInt16();\r\n\r\n            // setIsInitializing(deltaReader.IsInitializing());\r\n            if (!deltaReader.Reader.Error) {\r\n                for (let i = 0; i < entryCount && success; ++i) {\r\n                    let entryKey: string = deltaReader.Reader.readString();\r\n                    if (!deltaReader.Reader.Error) {\r\n                        let entry = this.entries[entryKey];\r\n                        if (entry) {\r\n                            success = entry.deserializeDelta(deltaReader, entryKey);\r\n                        }\r\n                        else {\r\n                            success = false;\r\n                        }\r\n                    }\r\n                    else {\r\n                        success = false;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                success = false;\r\n            }\r\n\r\n            if (success) {\r\n                this.reconcile(scene);\r\n            }\r\n\r\n            return success;\r\n        }\r\n\r\n        public lock() {\r\n            ++this.lockCount;\r\n        }\r\n\r\n        public unlock() {\r\n            --this.lockCount;\r\n        }\r\n\r\n        public get IsLocked(): boolean {\r\n            return this.lockCount > 0;\r\n        }\r\n\r\n        public readValue(key: string, reader: AppStateDeltaReader): any {\r\n            console.error('readValue not implemented for ' + key);\r\n        }\r\n\r\n        public writeValue(key: string, writer: AppStateDeltaWriter, value: any) {\r\n            console.error('writeValue not implemented for ' + key);\r\n        }\r\n    }\r\n\r\n    export class Director {\r\n        protected scene: modelstageweb.SceneWebGL;\r\n\r\n        protected appState: AppStateBase;\r\n\r\n        private pendingUpdates: (() => void)[] = [];\r\n\r\n        private pendingMessages: modelstageweb.NetworkChannelMessage[] = [];\r\n\r\n        public set Scene(scene: DirectedSceneWebGL) {\r\n            this.scene = scene;\r\n        } \r\n\r\n        constructor(appState: AppStateBase) {\r\n            this.appState = appState;\r\n        }\r\n\r\n        /** Initializes an AppState transaction. Any changes applied to the AppState will be monitored.\r\n          * BeginUpdate is called at the very beginning of each render cycle.\r\n          */\r\n        public beginFrame() {\r\n            this.appState.beginTransaction();\r\n        }\r\n\r\n        public commit() {\r\n            this.acquirePendingUpdates().forEach((updFunc) => {\r\n                updFunc();\r\n            });\r\n            this.appState.endTransaction();\r\n        }\r\n\r\n        /** Determines and submits local AppState transitions. Creates a local AppState delta that is transferred to upstream peers.\r\n          * SubmitLocalUpdates is called after the scene has been rendered and all interactions with the view are processed.\r\n          */\r\n        public submitLocalUpdates(connection: modelstageweb.ServerConnection) {\r\n            const AppStateDelta = 0x0100;\r\n\r\n            let writer = new AppStateDeltaWriter(new BinaryWriter());\r\n            writer.Writer.writeInt32(1);\r\n            writer.Writer.writeInt32(AppStateDelta); \r\n            this.appState.serializeTransaction(writer);\r\n            let buf = writer.Writer.flush();\r\n            let msg = modelstageweb.NetworkChannelMessage.FromBuffer(buf);\r\n            if (msg.HasPayload && connection.IsConnected) {\r\n                connection.send(msg.Content);\r\n            }\r\n        }\r\n\r\n        /** Applies remote AppState transitions received from upstream peers. ApplyRemoteUpdates is called after \r\n          * SubmitLocalUpdates. After applying remote updates, all AppState transitions for this render cycle have been applied.\r\n          */\r\n        public applyRemoteUpdates() {\r\n            let pendingMessages = this.acquirePendingMessages();\r\n            pendingMessages.forEach((msg) => {\r\n                this.appState.deserializeTransaction(new AppStateDeltaReader(new BinaryReader(msg.Content)), this.scene);\r\n            });\r\n        }\r\n\r\n        private acquirePendingUpdates(): Array<() => void> {\r\n            let result = this.pendingUpdates;\r\n            this.pendingUpdates = [];\r\n            return result;\r\n        }\r\n\r\n        private acquirePendingMessages() {\r\n            let result = this.pendingMessages;\r\n            this.pendingMessages = [];\r\n            return result;\r\n        }\r\n\r\n        /** Updates ViewState according to resulting AppState. AppState transition is committed by clearing AppState delta.\r\n          */\r\n        public endFrame() {\r\n            this.appState.applyChanges(this.scene);\r\n        }\r\n\r\n        public receivedMessage(message: modelstageweb.NetworkChannelMessage) {\r\n            this.pendingMessages.push(message);\r\n        }\r\n\r\n        public synchronizeStateUpdate(func: () => void) {\r\n            this.pendingUpdates.push(func);\r\n        }\r\n    }\r\n\r\n    export class DirectedSceneWebGL extends modelstageweb.SceneWebGL {\r\n\r\n        protected director: Director;\r\n\r\n        private connection: modelstageweb.ServerConnection;\r\n\r\n        public constructor(director: Director, connection: modelstageweb.ServerConnection) {\r\n            super();\r\n            this.director = director;\r\n            this.connection = connection;\r\n        }\r\n\r\n        public beginFrame() {\r\n            this.director.beginFrame();\r\n        }\r\n\r\n        public update() {\r\n            this.director.commit();\r\n\r\n            if (this.connection && this.connection.IsConnected) {\r\n                this.director.submitLocalUpdates(this.connection);\r\n                this.director.applyRemoteUpdates();\r\n            }\r\n        }\r\n\r\n        public endFrame() {\r\n            this.director.endFrame();\r\n        }\r\n\r\n        public receivedMessage(message: modelstageweb.NetworkChannelMessage) {\r\n            if (message.MessageType == modelstageweb.CommonMessageTypes.AppStateDelta || message.MessageType == modelstageweb.CommonMessageTypes.AppStateInitialization) {\r\n                this.director.receivedMessage(message);\r\n            }\r\n        }\r\n\r\n        public synchronizeStateUpdate(func: () => void) {\r\n            this.director.synchronizeStateUpdate(func);\r\n        }\r\n\r\n    }\r\n\r\n}","/// ModelStage Â© 2018 Plansysteme GmbH, Hamburg, Germany. All rights reserved.\r\n\r\nimport { modelstageweb } from './mx-common';\r\nimport { modelstageappstate } from './mx-appstate';\r\nimport { psgeometry } from './ps-geometry';\r\n\r\nexport module modelstage {\r\n    class Timer {\r\n        public animationFrame(callback: FrameRequestCallback): number {\r\n            return window.requestAnimationFrame(callback);\r\n        }\r\n\r\n        constructor() {\r\n        }\r\n    }\r\n\r\n    export class SpaceModel {\r\n \r\n        private vertices: Array<psgeometry.Vec2> = [];\r\n\r\n        private floorLevel: number = 0;\r\n\r\n        public get FloorLevel() { return this.floorLevel; }\r\n\r\n        public set FloorLevel(floorLevel) { this.floorLevel = floorLevel; }\r\n\r\n        constructor(private scene: DemoSceneWebGL, private stage: modelstageweb.StageWebGL, private actor: modelstageweb.ActorWebGL) {\r\n        }\r\n\r\n        private initializeSquareRoom(transparentMeshBuilder: modelstageweb.TransparentMeshBuilder, texturedMeshBuilder: modelstageweb.TexturedMeshBuilder) {\r\n            texturedMeshBuilder.addQuad(\r\n                -5.0, 0.0, -5.0, 0, 0,\r\n                5.0, 0.0, -5.0, 1, 0,\r\n                5.0, 0.0, 5.0, 1, 1,\r\n                -5.0, 0.0, 5.0, 0, 1,\r\n                0.3, 0.3, 0.3, true);\r\n\r\n            transparentMeshBuilder.addQuad(\r\n                -5.0, 0.0, -5.0,\r\n                5.0, 0.0, -5.0,\r\n                5.0, 2.6, -5.0,\r\n                -5.0, 2.6, -5.0,\r\n                0.1, 0.1, 0.1, .4, true);\r\n\r\n            transparentMeshBuilder.addQuad(\r\n                -5.0, 0.0, 5.0,\r\n                -5.0, 2.6, 5.0,\r\n                5.0, 2.6, 5.0,\r\n                5.0, 0.0, 5.0,\r\n                0.1, 0.1, 0.1, .4, true);\r\n\r\n            transparentMeshBuilder.addQuad(\r\n                -5.0, 0.0, -5.0,\r\n                -5.0, 2.6, -5.0,\r\n                -5.0, 2.6, 5.0,\r\n                -5.0, 0.0, 5.0,\r\n                0.15, 0.15, 0.15, .4, true);\r\n\r\n            transparentMeshBuilder.addQuad(\r\n                5.0, 0.0, -5.0,\r\n                5.0, 0.0, 5.0,\r\n                5.0, 2.6, 5.0,\r\n                5.0, 2.6, -5.0,\r\n                0.15, 0.15, 0.15, .4, true);\r\n        }\r\n\r\n        private initializeArbitraryRoom(transparentMeshBuilder: modelstageweb.TransparentMeshBuilder, texturedMeshBuilder: modelstageweb.TexturedMeshBuilder) {\r\n\r\n            let toggle = false;\r\n\r\n            let poly = new psgeometry.Polygon2D();\r\n\r\n            for (let i = 0; i < this.vertices.length; i++) {\r\n                poly.addVector(this.vertices[i]);\r\n            }\r\n            var bbox = new psgeometry.AABB2D();\r\n            poly.addToAABB(bbox);\r\n            var extents = bbox.extents();\r\n            this.stage.updateShadowArea(bbox);\r\n\r\n            poly = poly.triangulate();\r\n            for (let i = 0; i < poly.Vertices.length; i += 3) {\r\n                texturedMeshBuilder.addTri(\r\n                    poly.Vertices[i].x, 0, poly.Vertices[i].y, (poly.Vertices[i].x - bbox.minX) / extents.x, (poly.Vertices[i].y - bbox.minY) / extents.y,\r\n                    poly.Vertices[i + 1].x, 0, poly.Vertices[i + 1].y, (poly.Vertices[i + 1].x - bbox.minX) / extents.x, (poly.Vertices[i + 1].y - bbox.minY) / extents.y,\r\n                    poly.Vertices[i + 2].x, 0, poly.Vertices[i + 2].y, (poly.Vertices[i + 2].x - bbox.minX) / extents.x, (poly.Vertices[i + 2].y - bbox.minY) / extents.y,\r\n                    0.2, 0.2, 0.2, true);\r\n            }\r\n\r\n            for (let i = 0; i < this.vertices.length; i++) {\r\n                let start = this.vertices[i];\r\n                let end = this.vertices[(i + 1) % this.vertices.length];\r\n\r\n                transparentMeshBuilder.addQuad(\r\n                    start.x, 0.0, start.y,\r\n                    end.x, 0.0, end.y,\r\n                    end.x, 2.6, end.y,\r\n                    start.x, 2.6, start.y,\r\n                    toggle ? 0.1 : 0.15, toggle ? 0.1 : 0.15, toggle ? 0.1 : 0.15, .4, true);\r\n\r\n                toggle = !toggle;\r\n            }\r\n\r\n        }\r\n\r\n        public updateSpace() {\r\n\r\n            let spaceIndices = new modelstageweb.BufferAssetWebGL(undefined, 'space_indices', true);\r\n            let spaceVertices = new modelstageweb.BufferAssetWebGL(undefined, 'space_vertices', false);\r\n            let transparentMeshBuilder = new modelstageweb.TransparentMeshBuilder(spaceVertices, spaceIndices);\r\n            let floorIndices = new modelstageweb.BufferAssetWebGL(undefined, 'floor_indices', true);\r\n            let floorVertices = new modelstageweb.BufferAssetWebGL(undefined, 'floor_vertices', false);\r\n            let texturedMeshBuilder = new modelstageweb.TexturedMeshBuilder(floorVertices, floorIndices);\r\n\r\n            if (this.vertices.length < 3) {\r\n                this.initializeSquareRoom(transparentMeshBuilder, texturedMeshBuilder);\r\n            } else {\r\n                this.initializeArbitraryRoom(transparentMeshBuilder, texturedMeshBuilder);\r\n            }\r\n\r\n            let figure = new modelstageweb.FigureWebGL('Space');\r\n\r\n            texturedMeshBuilder.initialize(this.stage);\r\n            this.stage.AssetStore.addBufferAsset('floor_indices', floorIndices);\r\n            this.stage.AssetStore.addBufferAsset('floor_vertices', floorVertices);\r\n            let floorShaderInstance = new modelstageweb.MeshShaderInstance('TexturedMeshShader');\r\n            floorShaderInstance.addReference('IndexBuffer', 'floor_indices');\r\n            floorShaderInstance.addReference('VertexBuffer', 'floor_vertices');\r\n            floorShaderInstance.addReference('TextureBuffer', 'Shadow');\r\n            figure.addShaderInstance(floorShaderInstance);\r\n            \r\n            transparentMeshBuilder.initialize(this.stage);\r\n            this.stage.AssetStore.addBufferAsset('space_indices', spaceIndices);\r\n            this.stage.AssetStore.addBufferAsset('space_vertices', spaceVertices);\r\n            let shaderInstance = new modelstageweb.MeshShaderInstance('TransparentMeshShader');\r\n            shaderInstance.addReference('IndexBuffer', 'space_indices');\r\n            shaderInstance.addReference('VertexBuffer', 'space_vertices');\r\n            figure.addShaderInstance(shaderInstance);\r\n\r\n            this.actor.Figures[0] = figure;\r\n            this.actor.Filter = new modelstageweb.GenericSceneItemFilterWebGL();\r\n\r\n            this.actor.Scene.setDirty();\r\n\r\n        }\r\n\r\n        public clearVertices() {\r\n            this.vertices.length = 0;\r\n        }\r\n\r\n        public addVertex(x: number, y: number) {\r\n            this.vertices.push(new psgeometry.Vec2(x, y));\r\n        }\r\n    }\r\n\r\n    export class TheaterWebGL {\r\n\r\n        protected scene: modelstageweb.SceneWebGL;\r\n\r\n        protected stage: modelstageweb.StageWebGL;\r\n\r\n        private timer: Timer;\r\n\r\n        get Stage(): modelstageweb.StageWebGL {\r\n            return this.stage;\r\n        }\r\n\r\n        get Scene(): modelstageweb.SceneWebGL {\r\n            return this.scene;\r\n        }\r\n\r\n        constructor(canvasElementID: string) {\r\n            this.stage = new modelstageweb.StageWebGL(canvasElementID);\r\n            this.stage.initialize();\r\n\r\n            //this.scene = new modelstageweb.SceneWebGL();\r\n\r\n            this.timer = new Timer();\r\n            this.timer.animationFrame(() => { this.processFrame() });\r\n\r\n            document.addEventListener('visibilitychange', () => { this.onVisibilityChange(); }, false);\r\n\r\n            this.initialize();\r\n        }\r\n\r\n        protected initialize() {\r\n        }\r\n\r\n        /** Main render cycle for a frame.\r\n          */\r\n        protected processFrame() {\r\n            if (this.scene && this.scene.IsInitialized) {\r\n                if (!document.hidden) {\r\n                    // Render scene.\r\n                    this.render();\r\n                }\r\n\r\n                // Process available interaction data and remote messages to update application state and/or view state for the next frame.\r\n                this.scene.update();\r\n\r\n                // Finalize frame.\r\n                this.scene.endFrame();\r\n\r\n                this.scene.beginFrame();\r\n            }\r\n\r\n            this.timer.animationFrame(() => { this.processFrame() });\r\n        }\r\n\r\n        protected render() {\r\n            if (this.scene.IsInitialized) {\r\n                this.stage.render(this.scene);\r\n            }\r\n        }\r\n\r\n        private onVisibilityChange() {\r\n            if (!document.hidden) {\r\n                this.timer.animationFrame(() => { this.render() });\r\n            }\r\n        }\r\n    }\r\n\r\n    export class ActorManipulationTool extends modelstageweb.Tool {\r\n\r\n        constructor(protected connection: modelstageweb.ServerConnection) {\r\n            super();\r\n        }\r\n\r\n        protected getSceneObj(objID: string) {\r\n            let sceneObjIdx = 0;\r\n            let sceneObj = null;\r\n            while (sceneObjIdx < SceneAppState.GlobalInstance.SceneObjects.Count && !sceneObj) {\r\n                if (SceneAppState.GlobalInstance.SceneObjects.GetItemAt(sceneObjIdx).SceneObjectID == objID) {\r\n                    sceneObj = SceneAppState.GlobalInstance.SceneObjects.GetItemAt(sceneObjIdx);\r\n                } else {\r\n                    ++sceneObjIdx;\r\n                }\r\n            }\r\n            return [sceneObj, sceneObjIdx];\r\n        }\r\n\r\n        private updateModelTransform(actor: modelstageweb.ActorWebGL) {\r\n            let translationVec = actor.Data['translate'] || psgeometry.Vec4.Zero;\r\n            let rotationVec = actor.Data['rotate'] || psgeometry.Vec4.Zero;\r\n\r\n            this.connection.send('Scene|Transform|' + actor.SceneItemID + '|' + translationVec.x + ',' + translationVec.y + ',' + translationVec.z + '|' + rotationVec.y + ',' + rotationVec.x + ',' + rotationVec.z);\r\n\r\n            let translation = psgeometry.Matrix4.FromTranslation(translationVec.x, translationVec.y, translationVec.z);\r\n            let rotation = psgeometry.Matrix4.FromRotationY(rotationVec.y);\r\n\r\n            actor.State.set('ModelTransform', <psgeometry.Matrix4>rotation.multiply(translation));\r\n            actor.Scene.setDirty();\r\n        }\r\n\r\n        protected updateActorTranslation(actor: modelstageweb.ActorWebGL, x: number, y: number, z: number) {\r\n            actor.Data['translate'] = new psgeometry.Vec4(x, y, z);\r\n            this.updateModelTransform(actor);\r\n        }\r\n\r\n        protected updateActorRotation(actor: modelstageweb.ActorWebGL, x: number, y: number, z: number) {\r\n            actor.Data['rotate'] = new psgeometry.Vec4(x, y, z);\r\n            this.updateModelTransform(actor);\r\n        }\r\n    }\r\n\r\n    export class SelectionTool extends ActorManipulationTool {\r\n        private static readonly SelectionObjectID = 'SEL_MARKER';\r\n\r\n        private selectedActor: modelstageweb.ActorWebGL;\r\n\r\n        constructor(private scene: modelstageweb.SceneWebGL, private stage: modelstageweb.StageWebGL, connection: modelstageweb.ServerConnection) {\r\n            super(connection);\r\n        }\r\n\r\n        public enter(interfaceController: modelstageweb.InterfaceController) {\r\n            super.enter(interfaceController);\r\n\r\n            this.updateSelectionMarker();\r\n        }\r\n\r\n        public leave() {\r\n            this.removeSelectionMarker();\r\n        }\r\n\r\n        public handleKeyUp(e: JQuery.Event) {\r\n            if (e.keyCode == 46 && this.selectedActor) { // delete key\r\n\r\n                let [sceneObj, sceneObjIdx] = this.getSceneObj(this.selectedActor.Data['SceneObjID']);\r\n                if (sceneObj) {\r\n                    SceneAppState.GlobalInstance.SceneObjects.remove(sceneObjIdx);\r\n                    this.removeSelectionMarker();\r\n                    this.selectedActor = null;\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            return false;\r\n        }\r\n\r\n        private removeSelectionMarker() {\r\n            this.scene.removeSceneItem(SelectionTool.SelectionObjectID);\r\n        }\r\n\r\n        private updateSelectionMarker() {\r\n            this.scene.removeSceneItem(SelectionTool.SelectionObjectID);\r\n\r\n            if (this.selectedActor) {\r\n                let box = new psgeometry.AABB3D;\r\n                this.selectedActor.Figures.forEach((fig) => {\r\n                    box.addAABB(fig.getBoundingBox());\r\n                });\r\n\r\n                let bottomCenterPoint = new psgeometry.Vec3(box.center().x, box.minY, box.center().z);\r\n                let selectionMarker = new modelstageweb.ActorWebGL(this.scene, SelectionTool.SelectionObjectID);\r\n\r\n                let [r, g, b] = [.16, .34, .6];\r\n\r\n                let meshBuilder = new modelstageweb.OpaqueMeshBuilder();\r\n\r\n                // top lid\r\n                meshBuilder.addStroke(box.minX, box.maxY, box.minZ, box.maxX, box.maxY, box.minZ, r, g, b);\r\n                meshBuilder.addStroke(box.maxX, box.maxY, box.minZ, box.maxX, box.maxY, box.maxZ, r, g, b);\r\n                meshBuilder.addStroke(box.maxX, box.maxY, box.maxZ, box.minX, box.maxY, box.maxZ, r, g, b);\r\n                meshBuilder.addStroke(box.minX, box.maxY, box.maxZ, box.minX, box.maxY, box.minZ, r, g, b);\r\n\r\n                // bottom lid\r\n                meshBuilder.addStroke(box.minX, box.minY, box.minZ, box.maxX, box.minY, box.minZ, r, g, b);\r\n                meshBuilder.addStroke(box.maxX, box.minY, box.minZ, box.maxX, box.minY, box.maxZ, r, g, b);\r\n                meshBuilder.addStroke(box.maxX, box.minY, box.maxZ, box.minX, box.minY, box.maxZ, r, g, b);\r\n                meshBuilder.addStroke(box.minX, box.minY, box.maxZ, box.minX, box.minY, box.minZ, r, g, b);\r\n                \r\n                // vertical lines\r\n                meshBuilder.addStroke(box.minX, box.minY, box.minZ, box.minX, box.maxY, box.minZ, r, g, b);\r\n                meshBuilder.addStroke(box.minX, box.minY, box.maxZ, box.minX, box.maxY, box.maxZ, r, g, b);\r\n                meshBuilder.addStroke(box.maxX, box.minY, box.minZ, box.maxX, box.maxY, box.minZ, r, g, b);\r\n                meshBuilder.addStroke(box.maxX, box.minY, box.maxZ, box.maxX, box.maxY, box.maxZ, r, g, b);\r\n\r\n                selectionMarker.addFigure(meshBuilder.createFigure(this.stage, 'SEL_MARKER'));\r\n\r\n                let figureBoundingBox = new psgeometry.AABB3D();\r\n\r\n                [r, g, b] = [.6, .1, .1];\r\n                let meshBuilder1 = new modelstageweb.OpaqueMeshBuilder();\r\n                const segmentCount = 24;\r\n                const radius0 = 1;\r\n                const radius1 = 1.1;\r\n                for (let i = 0; i < segmentCount; ++i) {\r\n                    let angle0 = 2 * Math.PI / segmentCount * i;\r\n                    let angle1 = 2 * Math.PI / segmentCount * (i + 1);\r\n                    let inner0 = new psgeometry.Vec3(Math.sin(angle0) * radius0, 0, Math.cos(angle0) * radius0).add(bottomCenterPoint);\r\n                    let inner1 = new psgeometry.Vec3(Math.sin(angle1) * radius0, 0, Math.cos(angle1) * radius0).add(bottomCenterPoint);\r\n                    let outer0 = new psgeometry.Vec3(Math.sin(angle0) * radius1, 0, Math.cos(angle0) * radius1).add(bottomCenterPoint);\r\n                    let outer1 = new psgeometry.Vec3(Math.sin(angle1) * radius1, 0, Math.cos(angle1) * radius1).add(bottomCenterPoint);\r\n                    meshBuilder1.addQuad(outer0.x, outer0.y + 0.02, outer0.z,\r\n                        outer1.x, outer1.y + 0.02, outer1.z,\r\n                        inner1.x, inner1.y + 0.02, inner1.z,\r\n                        inner0.x, inner0.y + 0.02, inner0.z,\r\n                        r, g, b);\r\n\r\n                    meshBuilder1.addQuad(outer0.x, outer1.y - 0.02, outer0.z,\r\n                        outer1.x, outer1.y - 0.02, outer1.z,\r\n                        outer1.x, outer1.y + 0.02, outer1.z,\r\n                        outer0.x, outer0.y + 0.02, outer0.z,\r\n                        r, g, b);\r\n\r\n                    meshBuilder1.addQuad(inner0.x, inner0.y - 0.02, inner0.z,\r\n                        inner1.x, inner1.y - 0.02, inner1.z,\r\n                        outer1.x, outer1.y - 0.02, outer1.z,\r\n                        outer0.x, outer0.y - 0.02, outer0.z,\r\n                        r, g, b);\r\n\r\n                    figureBoundingBox.addVector(outer0);\r\n                }\r\n                let figure = meshBuilder1.createFigure(this.stage, 'ROT_MARKER');\r\n                figure.setIntersector(new modelstageweb.BoundingBoxIntersector(figureBoundingBox));\r\n                selectionMarker.addFigure(figure);\r\n\r\n                let sceneObjTranslation = this.scene.State.get('SceneObjectPos' + this.selectedActor.Data['SceneObjID'], psgeometry.Vec4.Zero);\r\n                let sceneObjRotation = this.scene.State.get('SceneObjectRot' + this.selectedActor.Data['SceneObjID'], psgeometry.Vec4.Zero);\r\n                selectionMarker.State.set('ModelTransform', psgeometry.Matrix4.FromRotation(sceneObjRotation.x, sceneObjRotation.y, sceneObjRotation.z).multiply(psgeometry.Matrix4.FromTranslation(sceneObjTranslation.x, sceneObjTranslation.y, sceneObjTranslation.z)));\r\n\r\n                selectionMarker.Filter = new modelstageweb.GenericSceneItemFilterWebGL();\r\n                this.scene.addSceneItem(selectionMarker, true);\r\n            }\r\n        }\r\n\r\n        public handleMouseDown(e: JQuery.Event) {\r\n            let viewRay = this.stage.Camera.getViewRay(e.clientX, e.clientY);\r\n            let candidates: Array<modelstageweb.IntersectionCandidate> = [];\r\n            this.scene.getIntersectionCandidates(viewRay, candidates);\r\n\r\n            let pickedObject = false;\r\n            let currentIdx = 0;\r\n\r\n            while (!pickedObject && currentIdx < candidates.length) {\r\n\r\n                if (candidates[currentIdx].sceneItem instanceof modelstageweb.ActorWebGL) {\r\n\r\n                    let pickedActor = <modelstageweb.ActorWebGL>(candidates[currentIdx].sceneItem);\r\n                    if (pickedActor.SceneItemID != SelectionTool.SelectionObjectID) {\r\n                        if (pickedActor == this.selectedActor) {\r\n                            this.interfaceController.pushTool(new MoveActorTool(pickedActor, this.stage.Camera, this.connection));\r\n                        } else {\r\n                            this.selectedActor = pickedActor;\r\n                            this.updateSelectionMarker();\r\n                        }\r\n\r\n                        pickedObject = true;\r\n                    } else {\r\n                        this.interfaceController.pushTool(new RotateActorTool(this.selectedActor, this.stage.Camera, this.connection));\r\n\r\n                        pickedObject = true;\r\n                    }\r\n                }\r\n                currentIdx++;\r\n            }\r\n\r\n            if (!pickedObject) {\r\n                this.scene.removeSceneItem(SelectionTool.SelectionObjectID);\r\n\r\n                this.selectedActor = null;\r\n            }\r\n        }\r\n\r\n        public handleMouseMove(e: JQuery.Event, x: number, y: number) {\r\n        }\r\n\r\n        public handleMouseUp(e: JQuery.Event) {\r\n        }\r\n    }\r\n\r\n    export class PlaceActorTool extends ActorManipulationTool {\r\n        private sceneObj: SceneObject;\r\n\r\n        private sceneObjIdx: number;\r\n\r\n        constructor(figureID: string, private camera: modelstageweb.CameraWebGL, connection: modelstageweb.ServerConnection) {\r\n            super(connection);\r\n\r\n            this.sceneObj = new SceneObject();\r\n            this.sceneObj.AssetID = figureID;\r\n            this.sceneObj.SceneObjectID = modelstageweb.uuidv4();\r\n            this.sceneObj.Location = new psgeometry.Vec4(); \r\n            this.sceneObj.Rotation = new psgeometry.Vec4();\r\n            this.sceneObj.Scale = new psgeometry.Vec4(1, 1, 1, 1);\r\n            SceneAppState.GlobalInstance.SceneObjects.append(this.sceneObj);\r\n\r\n            this.sceneObjIdx = SceneAppState.GlobalInstance.SceneObjects.Count - 1;\r\n        }\r\n\r\n        public handleMouseMove(e: JQuery.TriggeredEvent, x: number, y: number) {\r\n            let viewRay = this.camera.getViewRay(x, y);\r\n            let p = viewRay.intersectRayWithPlane(new psgeometry.Vec3(), new psgeometry.Vec3(0, 1, 0));\r\n            if (p) {\r\n                this.sceneObj = { ...this.sceneObj };\r\n                this.sceneObj.Location = new psgeometry.Vec4(p.x, 0, p.z);\r\n                SceneAppState.GlobalInstance.SceneObjects.replace(this.sceneObj, this.sceneObjIdx);\r\n                //this.updateActorTranslation(this.actor, p.x, 0, p.z);\r\n            }\r\n        }\r\n\r\n        public handleMouseUp(e: JQuery.Event) {\r\n            this.interfaceController.popTool();\r\n        }\r\n\r\n    }\r\n\r\n    let UserNames = {\r\n        'Administrator': 'Administrator',\r\n        'Arne': 'Arne Thurm',\r\n        'Ulrich': 'Ulrich BÃ¶nkemeyer',\r\n        'Tom': 'Tom Jachmann',\r\n        'Zacharias': 'Zacharias Reinhardt'\r\n    };\r\n\r\n    let PeerColors = [\r\n        [0.31, 0.02, 0.06, 1.00],  // red\r\n        [0.02, 0.17, 0.31, 1.00],  // blue\r\n        [0.02, 0.31, 0.06, 1.00],  // green\r\n        [0.69, 0.34, 0.00, 1.00],  // orange\r\n        [0.33, 0.00, 0.53, 1.00],  // purple\r\n//        [, 1.00],\r\n//        [, 1.00],\r\n//        [, 1.00],\r\n    ];\r\n\r\n    export class MoveActorTool extends ActorManipulationTool {\r\n        private isInitialized = false;\r\n        private lastX: number;\r\n        private lastZ: number;\r\n\r\n        constructor(private actor: modelstageweb.ActorWebGL, private camera: modelstageweb.CameraWebGL, connection: modelstageweb.ServerConnection) {\r\n            super(connection);\r\n        }\r\n\r\n        public handleMouseMove(e: JQuery.TriggeredEvent, x: number, y: number) {\r\n            let viewRay = this.camera.getViewRay(x, y);\r\n            let p = viewRay.intersectRayWithPlane(new psgeometry.Vec3(), new psgeometry.Vec3(0, 1, 0));\r\n            if (p) {\r\n                if (this.isInitialized) {\r\n                    let [sceneObj, sceneObjIdx] = this.getSceneObj(this.actor.Data['SceneObjID']);\r\n                    if (sceneObj) {\r\n                        let translatedSceneObj: SceneObject = { ...sceneObj };\r\n                        let translation = translatedSceneObj.Location;\r\n                        translatedSceneObj.Location = translatedSceneObj.Location.add(new psgeometry.Vec4(p.x - this.lastX, 0, p.z - this.lastZ));\r\n                        SceneAppState.GlobalInstance.SceneObjects.replace(translatedSceneObj, sceneObjIdx);\r\n                    }\r\n                }\r\n                this.lastX = p.x;\r\n                this.lastZ = p.z;\r\n                this.isInitialized = true;\r\n            }\r\n        }\r\n\r\n        public handleMouseUp(e: JQuery.Event) {\r\n            this.interfaceController.popTool();\r\n        }\r\n\r\n    }\r\n\r\n    export class RotateActorTool extends ActorManipulationTool {\r\n        constructor(private actor: modelstageweb.ActorWebGL, private camera: modelstageweb.CameraWebGL, connection: modelstageweb.ServerConnection) {\r\n            super(connection);\r\n        }\r\n\r\n        public handleDrag(e: JQuery.Event, startX: number, startY: number, dX: number, dY: number) {\r\n\r\n            let fac = 1;\r\n            if (Math.abs(e.clientY - startY) > 300) {\r\n                fac = 6\r\n            } else if (Math.abs(e.clientY - startY) > 200) {\r\n                fac = 3\r\n            } else if (Math.abs(e.clientY - startY) > 100) {\r\n                fac = 2\r\n            }\r\n\r\n            let [sceneObj, sceneObjIdx] = this.getSceneObj(this.actor.Data['SceneObjID']);\r\n            if (sceneObj) {\r\n                let rotatedSceneObj: SceneObject = { ...sceneObj };\r\n                let rotation = rotatedSceneObj.Rotation;\r\n                rotatedSceneObj.Rotation = rotatedSceneObj.Rotation.add(new psgeometry.Vec4(dX / (fac * 100) * Math.PI, 0, 0));\r\n                SceneAppState.GlobalInstance.SceneObjects.replace(rotatedSceneObj, sceneObjIdx);\r\n            }\r\n        }\r\n\r\n        public handleMouseUp(e: JQuery.Event) {\r\n            this.interfaceController.popTool();\r\n        }\r\n\r\n    }\r\n\r\n    export class DemoSceneWebGL extends modelstageappstate.DirectedSceneWebGL {\r\n\r\n        private stage: modelstageweb.StageWebGL;\r\n\r\n        private spaceActor: modelstageweb.ActorWebGL = new modelstageweb.ActorWebGL(this, 'Space');\r\n\r\n        private spaceModel: SpaceModel;\r\n\r\n        public get SpaceModel() { return this.spaceModel; }\r\n\r\n        constructor(stage: modelstageweb.StageWebGL, connection: modelstageweb.ServerConnection) {\r\n            super(new modelstageappstate.Director(modelstageappstate.AppState.GetInstance()), connection);\r\n            this.director.Scene = this;\r\n            this.stage = stage;\r\n\r\n            this.spaceModel = new SpaceModel(this, this.stage, this.spaceActor);\r\n\r\n            let shaderProgram: modelstageweb.ShaderProgramWebGL = new modelstageweb.OpaqueMeshShaderProgramWebGL();\r\n            shaderProgram.initialize(stage);\r\n            stage.registerShaderProgram('OpaqueMeshShader', shaderProgram);\r\n\r\n            shaderProgram = new modelstageweb.TransparentMeshShaderProgramWebGL();\r\n            shaderProgram.initialize(stage);\r\n            stage.registerShaderProgram('TransparentMeshShader', shaderProgram);\r\n\r\n            shaderProgram = new modelstageweb.TexturedMeshShaderProgramWebGL();\r\n            shaderProgram.initialize(stage);\r\n            stage.registerShaderProgram('TexturedMeshShader', shaderProgram);\r\n\r\n            shaderProgram = new modelstageweb.MatCapShaderProgramWebGL();\r\n            shaderProgram.initialize(stage);\r\n            stage.registerShaderProgram('MatCapMeshShader', shaderProgram);\r\n\r\n            // Shadow shaders\r\n\r\n            shaderProgram = new modelstageweb.ShadowTexturedMeshShaderProgramWebGL();\r\n            shaderProgram.initialize(stage);\r\n            stage.registerPhaseSpecificShaderProgram('Shadow', 'TexturedMeshShader', shaderProgram);\r\n\r\n            shaderProgram = new modelstageweb.ShadowTexturedMeshShaderProgramWebGL();\r\n            shaderProgram.initialize(stage);\r\n            stage.registerPhaseSpecificShaderProgram('Shadow', 'MatCapMeshShader', shaderProgram);\r\n        }\r\n\r\n        public initialize() {\r\n            this.addSceneItem(this.spaceActor, true);\r\n            this.spaceModel.updateSpace();\r\n\r\n            $.when(\r\n//                this.stage.AssetFactory.getFromUrl('/data/commonassets.psmesh'),\r\n                this.stage.AssetFactory.getFromUrl('/data/hologem.psmesh'),\r\n//                this.stage.AssetFactory.getFromUrl('/data/office_assets.psmesh'),\r\n                this.stage.AssetFactory.getFromUrl('/data/office_assets_bake.psmesh')\r\n            ).done(() => {\r\n                this.IsInitialized = true;\r\n            });\r\n\r\n            /*        this.stage.AssetFactory.getFromUrl('/data/if5-office-1.psmesh')\r\n                        .then((success) => {\r\n                            let actor = new modelstageweb.ActorWebGL(this, 'actor');\r\n                            for (let x in this.stage.AssetStore.Figures) {\r\n                                actor.addFigure(this.stage.AssetStore.Figures[x]);\r\n                            }\r\n                            this.addSceneItem(actor, true);\r\n            \r\n                            this.stage.AssetFactory.getFromUrl('/data/assets.psmesh').then(() => {\r\n                                this.IsInitialized = true;\r\n                            });\r\n                        })\r\n                        .fail((req) => {\r\n                        })\r\n                        .progress((percentage) => {\r\n                            document.title = percentage;\r\n                        });\r\n                    */\r\n\r\n        }\r\n\r\n        public updateSpace() {\r\n            this.spaceModel.clearVertices();\r\n            for (let i = 0; i < RoomAppState.GlobalInstance.Vertices.Count; ++i) {\r\n                let vert = RoomAppState.GlobalInstance.Vertices.GetItemAt(i);\r\n                this.spaceModel.addVertex(vert.x, vert.z);\r\n            }\r\n            this.spaceModel.updateSpace();\r\n        }\r\n\r\n        public updatePeerInfo(peerID: string, peerColorIndex: number, userName: string) {\r\n            if (peerID != '-1') {\r\n                let peerInfoID = 'peer-info-' + peerID;\r\n\r\n                let peerInfoElement = $('#' + peerInfoID);\r\n\r\n                if (peerInfoElement.length > 0) {\r\n                    peerInfoElement.find('span').text(userName);\r\n                } else {\r\n                    $('#participants-view').append('<li id=\"' + peerInfoID + '\"><img src=\"images/info/Lens' + peerColorIndex + '.png\" /><span>' + userName + '</span></li>');\r\n                }\r\n            }\r\n        }\r\n\r\n        public removePeer(peerID: string) {\r\n            this.removeSceneItem('Peer' + peerID);\r\n\r\n            let peerInfoID = 'peer-info-' + peerID;\r\n            let peerInfoElement = $('#' + peerInfoID);\r\n            peerInfoElement.addClass('removing');\r\n            setTimeout(() => {\r\n                peerInfoElement.remove();\r\n            }, 2000);\r\n        }\r\n\r\n        public getColorIndexFromPeerID(peerID: string) {\r\n            return (parseInt(peerID) - 1) % PeerColors.length;\r\n        }\r\n\r\n        public createPeer(peerID: string) {\r\n            let obj: modelstageweb.ActorWebGL = new modelstageweb.ActorWebGL(this, 'Peer' + peerID);\r\n            obj.addFigure(this.stage.AssetStore.Figures['hololens.hololens.000']);\r\n            // TODO @UB: do this the right way...\r\n            obj.Figures[0].ShaderInstances[0].ShaderKey = 'MatCapMeshShader';\r\n\r\n            let colorIndex = this.getColorIndexFromPeerID(peerID);\r\n\r\n            obj.State.set('Color', new psgeometry.Vec4(PeerColors[colorIndex][0], PeerColors[colorIndex][1], PeerColors[colorIndex][2], PeerColors[colorIndex][3]));\r\n            obj.State.set('ModelTransform', (state: modelstageweb.RenderState) => {\r\n                let pos: psgeometry.Vec4 = state.get('HeadPos' + peerID, psgeometry.Vec4.Zero);\r\n                let cursor: psgeometry.Vec4 = state.get('CursPos' + peerID, psgeometry.Vec4.Zero);\r\n                let dir = cursor.sub(pos);\r\n\r\n                let spherical = psgeometry.Spherical.FromCartesianVector(dir);\r\n\r\n                return (<psgeometry.Matrix4>psgeometry.Matrix4.FromRotationX(-spherical.azimuth).multiply(\r\n                    psgeometry.Matrix4.FromRotationY(-spherical.polar))).multiply(\r\n                    psgeometry.Matrix4.FromTranslation(pos.x, pos.y, pos.z));\r\n            });\r\n\r\n            this.addSceneItem(obj, true /* makeVisible */);\r\n            obj.TestIntersection = false;\r\n            obj.TestChildrenIntersection = false;\r\n            return obj;\r\n        }\r\n\r\n        public createSceneObject(objectID: string, assetID: string) {\r\n            let suffix = objectID;\r\n\r\n            let obj = new modelstageweb.ActorWebGL(this, 'SceneObject' + suffix);\r\n            obj.State.set('ModelTransform', (state: modelstageweb.RenderState) => {\r\n                let pos = state.get('SceneObjectPos' + suffix, psgeometry.Vec4.Zero);\r\n                let rot = state.get('SceneObjectRot' + suffix, psgeometry.Vec4.Zero);\r\n                let scale = state.get('SceneObjectScale' + suffix, psgeometry.Vec4.One);\r\n\r\n                return <psgeometry.Matrix4>psgeometry.Matrix4.FromRotation(rot.x, rot.y, rot.z).multiply(\r\n                    psgeometry.Matrix4.FromScaling(scale.x, scale.y, scale.z).multiply(\r\n                        psgeometry.Matrix4.FromTranslation(pos.x, pos.y, pos.z)));\r\n            });\r\n            obj.addFigure(this.stage.AssetStore.getFigure(assetID));\r\n            obj.Data['SceneObjID'] = suffix;\r\n\r\n            return obj;\r\n        }\r\n\r\n    }\r\n\r\n    export class RoomAppState extends modelstageappstate.AppStateCluster {\r\n        static ClusterTypeID = 'Room';\r\n\r\n        static GlobalInstance: RoomAppState;\r\n\r\n        public FloorLevel: modelstageappstate.AppStateFloatValue = new modelstageappstate.AppStateFloatValue();\r\n\r\n        public MasterView: modelstageappstate.AppStateVector4Value = new modelstageappstate.AppStateVector4Value();\r\n\r\n        public Vertices: modelstageappstate.AppStateCollection<psgeometry.Vec4> = new modelstageappstate.AppStateCollection<psgeometry.Vec4>(modelstageappstate.AppStateCollectionOperation);\r\n\r\n        public constructor() {\r\n            super();\r\n            RoomAppState.GlobalInstance = this;\r\n        }\r\n\r\n        public registerEntries() {\r\n            this.registerEntry('FloorLevel', this.FloorLevel);\r\n            this.registerEntry('MasterView', this.MasterView);\r\n            this.registerEntry('Vertices', this.Vertices);\r\n        }\r\n\r\n        public readValue(key: string, reader: modelstageappstate.AppStateDeltaReader): any {\r\n            if (key == 'Vertices') {\r\n                return reader.Reader.readVec4();\r\n            } else {\r\n                return super.readValue(key, reader);\r\n            }\r\n        }\r\n\r\n        public applyChanges(scene: modelstageweb.SceneWebGL, peerID: string, instanceID: string) {\r\n            if (this.FloorLevel.isDirty()) {\r\n                scene.State.set('FloorLevel', this.FloorLevel.get());\r\n                (<DemoSceneWebGL>scene).SpaceModel.FloorLevel = this.FloorLevel.get();\r\n            }\r\n            if (this.MasterView.isDirty()) {\r\n                scene.State.set('MasterViewPos', this.MasterView.get());\r\n            }\r\n            if (this.Vertices.isDirty()) {\r\n                let sc = <DemoSceneWebGL>scene;\r\n                (<DemoSceneWebGL>scene).updateSpace();\r\n            }\r\n        }\r\n    }\r\n\r\n    class SceneObject {\r\n        public SceneObjectID: string; // char[40]\r\n\r\n        public AssetID: string;       // char[20]\r\n\r\n        public Location: psgeometry.Vec4;\r\n\r\n        public Rotation: psgeometry.Vec4;\r\n\r\n        public Scale: psgeometry.Vec4;\r\n    }\r\n\r\n    export class SceneAppState extends modelstageappstate.AppStateCluster {\r\n        static ClusterTypeID = 'Obj';\r\n\r\n        static GlobalInstance: SceneAppState;\r\n\r\n        public SceneObjects: modelstageappstate.AppStateCollection<SceneObject> = new modelstageappstate.AppStateCollection<SceneObject>(modelstageappstate.AppStateCollectionOperation);\r\n\r\n        public constructor() {\r\n            super();\r\n            SceneAppState.GlobalInstance = this;\r\n        }\r\n\r\n        public registerEntries() {\r\n            this.registerEntry('Obj', this.SceneObjects);\r\n        }\r\n\r\n        public readValue(key: string, reader: modelstageappstate.AppStateDeltaReader): any {\r\n            if (key == 'Obj') {\r\n                let value = new SceneObject();\r\n\r\n                value.SceneObjectID = reader.Reader.readCharArray(40);\r\n                value.AssetID = reader.Reader.readCharArray(40);\r\n                value.Location = reader.Reader.readVec4();\r\n                value.Rotation = reader.Reader.readVec4();\r\n                value.Scale = reader.Reader.readVec4();\r\n\r\n                return value;\r\n            } else {\r\n                return super.readValue(key, reader);\r\n            }\r\n        }\r\n\r\n        public writeValue(key: string, writer: modelstageappstate.AppStateDeltaWriter, value: any) {\r\n            if (key == 'Obj') {\r\n                writer.Writer.writeCharArray(value.SceneObjectID, 40);\r\n                writer.Writer.writeCharArray(value.AssetID, 40);\r\n                writer.Writer.writeVec4(value.Location);\r\n                writer.Writer.writeVec4(value.Rotation);\r\n                writer.Writer.writeVec4(psgeometry.Vec4.One);\r\n            } else {\r\n                super.writeValue(key, writer, value);\r\n            }\r\n        }\r\n\r\n        public applyChanges(scene: modelstageweb.SceneWebGL, peerID: string, instanceID: string) {\r\n            if (this.SceneObjects.isDirty()) {\r\n                let sc = <DemoSceneWebGL>(scene);\r\n\r\n                this.SceneObjects.Operations.forEach((operation) => {\r\n                    if (operation.Operation == modelstageappstate.OperationType.Append) {\r\n                        let objID = operation.NewValue.SceneObjectID;\r\n                        let assetID = operation.NewValue.AssetID;\r\n                        sc.addSceneItem(sc.createSceneObject(objID, assetID), true /* makeVisible */);\r\n                        scene.State.set('SceneObjectPos' + objID, operation.NewValue.Location);\r\n                        scene.State.set('SceneObjectRot' + objID, operation.NewValue.Rotation);\r\n                        scene.State.set('SceneObjectScale' + objID, operation.NewValue.Scale);\r\n                        //scene.RunSequence(\"ShowSceneObject\", std::string{ \"ShowSceneObject\" } +noteID, { { \"SceneObjectID\", objID } });\r\n                    }\r\n                    else if (operation.Operation == modelstageappstate.OperationType.Replace) {\r\n                        let objID = operation.NewValue.SceneObjectID;\r\n                        scene.State.set('SceneObjectPos' + objID, operation.NewValue.Location);\r\n                        scene.State.set('SceneObjectRot' + objID, operation.NewValue.Rotation);\r\n                        scene.State.set('SceneObjectScale' + objID, operation.NewValue.Scale);\r\n                    }\r\n                    else if (operation.Operation == modelstageappstate.OperationType.Remove) {\r\n                        let objID = operation.PreviousValue.SceneObjectID;\r\n                        scene.removeSceneItem('SceneObject' + objID);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    export class PeerAppState extends modelstageappstate.AppStateCluster {\r\n        static ClusterTypeID = 'Peer';\r\n\r\n        private headPos: modelstageappstate.AppStateVector4Value = new modelstageappstate.AppStateVector4Value();\r\n\r\n        private cursorPos: modelstageappstate.AppStateVector4Value = new modelstageappstate.AppStateVector4Value();\r\n\r\n        private userID: modelstageappstate.AppStateStringValue = new modelstageappstate.AppStateStringValue();\r\n\r\n        private active: modelstageappstate.AppStateBoolValue = new modelstageappstate.AppStateBoolValue();\r\n\r\n        public providesInitializationData() {\r\n            return true;\r\n        }\r\n\r\n        public registerEntries() {\r\n            this.registerEntry('Head', this.headPos);\r\n            this.registerEntry('Curs', this.cursorPos);\r\n            this.registerEntry('User', this.userID);\r\n            this.registerEntry('Active', this.active);\r\n        }\r\n\r\n        public applyChanges(scene: modelstageweb.SceneWebGL, peerID: string, instanceID: string) {\r\n            let sc = <DemoSceneWebGL>scene;\r\n            if (peerID.length > 0 && (this.headPos.isDirty() || this.cursorPos.isDirty())) {\r\n                if (!sc.getSceneItem('Peer' + peerID)) {\r\n                    sc.createPeer(peerID);\r\n                }\r\n                let levelOfs = new psgeometry.Vec4(0, -sc.SpaceModel.FloorLevel, 0, 0);\r\n                let headPos = this.headPos.get();\r\n                let cursorPos = this.cursorPos.get();\r\n                if (headPos && cursorPos) {\r\n                    scene.State.set('HeadPos' + peerID, headPos.add(levelOfs));\r\n                    scene.State.set('CursPos' + peerID, cursorPos.add(levelOfs));\r\n                }\r\n            }\r\n\r\n            if (this.userID.isDirty()) {\r\n                let userName = UserNames[this.userID.get()] || '';\r\n                sc.updatePeerInfo(peerID, sc.getColorIndexFromPeerID(peerID), userName);\r\n            }\r\n\r\n            if (this.active.isDirty()) {\r\n                if (!this.active.get()) {\r\n                    sc.removePeer(peerID);\r\n                }\r\n            }\r\n         }\r\n    }\r\n\r\n    class Note {\r\n        public NoteID: string; //char[20];\r\n\r\n        public NoteType: number; // int\r\n\r\n        public OwnerID: string; // char[10];\r\n\r\n        public AssignedToID: string; // char[10];\r\n\r\n        public Location: psgeometry.Vec4;\r\n\r\n        public AzimuthalRotation: number; // float\t\t\t\r\n\r\n    };\r\n\r\n    export class NotesAppState extends modelstageappstate.AppStateCluster {\r\n        static ClusterTypeID = 'Notes';\r\n\r\n        static GlobalInstance: NotesAppState;\r\n\r\n        public Notes: modelstageappstate.AppStateCollection<Note> = new modelstageappstate.AppStateCollection<Note>(modelstageappstate.AppStateCollectionOperation);\r\n\r\n        public constructor() {\r\n            super();\r\n            NotesAppState.GlobalInstance = this;\r\n        }\r\n\r\n        public registerEntries() {\r\n            this.registerEntry('Notes', this.Notes);\r\n        }\r\n\r\n        public readValue(key: string, reader: modelstageappstate.AppStateDeltaReader): any {\r\n            if (key == 'Notes') {\r\n                let value = new Note();\r\n\r\n                value.NoteID = reader.Reader.readCharArray(20);\r\n                value.NoteType = reader.Reader.readUInt32();\r\n                value.OwnerID = reader.Reader.readCharArray(10);\r\n                value.Location = reader.Reader.readVec4();\r\n                value.AzimuthalRotation = reader.Reader.readFloat32();\r\n\r\n                return value;\r\n            } else {\r\n                return super.readValue(key, reader);\r\n            }\r\n        }\r\n\r\n        public writeValue(key: string, writer: modelstageappstate.AppStateDeltaWriter, value: any) {\r\n            if (key == 'Notes') {\r\n                writer.Writer.writeCharArray(value.NoteID, 20);\r\n                writer.Writer.writeInt32(value.NoteType);\r\n                writer.Writer.writeCharArray(value.OwnerID, 10);\r\n                writer.Writer.writeVec4(value.Location);\r\n                writer.Writer.writeFloat32(value.AzimuthalRotation);\r\n            } else {\r\n                super.writeValue(key, writer, value);\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n\r\n}\r\n","/// ModelStage Â© 2018 Plansysteme GmbH, Hamburg, Germany. All rights reserved.\r\n\r\nimport { modelstage } from './modelstage';\r\nimport { modelstageweb } from './mx-common';\r\nimport { modelstageappstate } from './mx-appstate';\r\n\r\nexport class MessageChannel {\r\n\r\n    protected extractPart(message: string): { remainder: string, part: string } {\r\n        let sep = message.indexOf('|');\r\n        if (sep >= 0) {\r\n            return {\r\n                part: message.substring(0, sep),\r\n                remainder: message.substring(sep + 1)\r\n            };\r\n        } else {\r\n            return {\r\n                remainder: '',\r\n                part: message\r\n            };\r\n        }\r\n    }\r\n\r\n    public processMessage(message: string) {\r\n    }\r\n\r\n}\r\n\r\nexport class SampleTheaterWebGL extends modelstage.TheaterWebGL {\r\n\r\n    private peerAppState = new modelstageappstate.LocalAppStateClusterManager(modelstage.PeerAppState.ClusterTypeID, modelstage.PeerAppState);\r\n\r\n    private sceneAppState = new modelstageappstate.GlobalAppStateClusterManager(modelstage.SceneAppState.ClusterTypeID, modelstage.SceneAppState);\r\n\r\n    private roomAppState = new modelstageappstate.GlobalAppStateClusterManager(modelstage.RoomAppState.ClusterTypeID, modelstage.RoomAppState);\r\n\r\n    private notesAppState = new modelstageappstate.GlobalAppStateClusterManager(modelstage.NotesAppState.ClusterTypeID, modelstage.NotesAppState);\r\n\r\n    private actorIndex = 1;\r\n\r\n    private interfaceController: modelstageweb.InterfaceController;\r\n\r\n    private cameraController: modelstageweb.CameraController;\r\n\r\n    private connection: modelstageweb.ServerConnection;\r\n\r\n    private channels: { [index: string]: MessageChannel } = {};\r\n\r\n    constructor(canvasElementID: string) {\r\n        super(canvasElementID);\r\n\r\n        this.connection = new modelstageweb.SignalRServerConnection();\r\n\r\n        this.scene = new modelstage.DemoSceneWebGL(this.stage, this.connection);\r\n        this.scene.initialize();\r\n\r\n        this.connection.onConnected(() => {\r\n        });\r\n        this.connection.onMessage((msg) => {\r\n            if (msg.data instanceof ArrayBuffer || msg.data instanceof Uint8Array) {\r\n                let buf = msg.data instanceof Uint8Array ? msg.data : new Uint8Array(msg.data);\r\n                let networkMessage = modelstageweb.NetworkChannelMessage.FromBuffer(buf);\r\n                (<modelstageappstate.DirectedSceneWebGL>this.scene).receivedMessage(networkMessage);\r\n            } else if (typeof msg.data == 'string') {\r\n                let data = <string>msg.data;\r\n                let sep = data.indexOf('|');\r\n                if (sep >= 0) {\r\n                    let channelKey = data.substring(0, sep);\r\n                    let message = data.substr(sep + 1);\r\n                    let channel = this.channels[channelKey];\r\n                    if (channel) {\r\n                        channel.processMessage(message);\r\n                    }\r\n                }\r\n            } else {\r\n                console.warn('Received invalid message type: ' + typeof msg.data);\r\n            }\r\n        });\r\n\r\n        this.interfaceController = new modelstageweb.InterfaceController();\r\n        this.cameraController = new modelstageweb.CameraController(this.Stage, this.Stage.Camera, this.interfaceController, this.connection);\r\n        this.cameraController.construct(12.0, -0.45, 0.0);\r\n        this.interfaceController.pushTool(new modelstage.SelectionTool(this.scene, this.stage, this.connection));\r\n\r\n        $(() => { \r\n            this.connection.connect();\r\n\r\n            (<any>$('.area-right-sidebar ul li')).draggable({\r\n                containment: 'document',\r\n                cursor: 'crosshair',\r\n                helper: 'clone',\r\n                opacity: 0.5,\r\n                scroll: false\r\n            });\r\n\r\n            (<any>$('#viewCanvas')).droppable({\r\n                over: (event, ui) => {\r\n                    let figureID = $(ui.draggable).attr('data-figure-id');\r\n                    //actor.Data['rotate'] = new psgeometry.Vec4(0, this.cameraController.Yaw, 0);\r\n\r\n                    this.interfaceController.pushTool(new modelstage.PlaceActorTool(figureID, this.stage.Camera, this.connection));\r\n                }\r\n            });\r\n\r\n        });\r\n    }\r\n\r\n    protected initialize() {\r\n    }\r\n\r\n}\r\n"],"names":["psgeometry","tslib_1.__extends","HubConnectionBuilder","LogLevel","modelstageweb","modelstageappstate","modelstage"],"mappings":";;;;;;;;;;IAEA,WAAc,UAAU;QAEpB;YA+DA,iBAAY,QAAmB;gBAC7B,IAAI,CAAC,QAAQ,GAAG,QAAQ,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;aAC9E;;;;;;;YA5DM,uBAAe;;;;;;gBAAtB,UAAuB,CAAS,EAAE,CAAS,EAAE,CAAS;;wBAChD,MAAM,GAAG,IAAI,OAAO,EAAE;oBAC1B,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;oBACvB,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;oBACvB,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;oBACxB,OAAO,MAAM,CAAC;iBACf;;;;;;;YAEM,mBAAW;;;;;;gBAAlB,UAAmB,CAAS,EAAE,CAAS,EAAE,CAAS;;wBAC5C,MAAM,GAAG,IAAI,OAAO,EAAE;oBAC1B,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;oBACvB,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;oBACvB,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC;oBACxB,OAAO,MAAM,CAAC;iBACf;;;;;YAEM,qBAAa;;;;gBAApB,UAAqB,KAAa;;wBAC5B,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC;;wBACtB,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC;;wBACtB,MAAM,GAAG,IAAI,OAAO,EAAE;oBAC1B,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;oBAC1B,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC;oBAC3B,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;oBAC1B,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC;oBAC3B,OAAO,MAAM,CAAC;iBACf;;;;;YAEM,qBAAa;;;;gBAApB,UAAqB,KAAa;;wBAC5B,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC;;wBACtB,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC;;wBACtB,MAAM,GAAG,IAAI,OAAO,EAAE;oBAC1B,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;oBAC1B,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;oBAC1B,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC;oBAC3B,MAAM,CAAC,QAAQ,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC;oBAC3B,OAAO,MAAM,CAAC;iBACf;;;;;YAEM,qBAAa;;;;gBAApB,UAAqB,KAAa;;wBAC5B,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC;;wBACtB,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC;;wBACtB,MAAM,GAAG,IAAI,OAAO,EAAE;oBAC1B,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;oBAC1B,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC;oBAC3B,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;oBAC1B,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;oBAC1B,OAAO,MAAM,CAAC;iBACf;;;;;;;YAEM,oBAAY;;;;;;gBAAnB,UAAoB,KAAa,EAAE,GAAW,EAAE,IAAY;oBAC1D,OAAO,IAAI,OAAO,CAAC;wBACjB,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC;wBACrF,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC;wBACzM,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC;wBACzM,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC;qBAAC,CACZ,CAAC,SAAS,EAAE,CAAC;iBACf;;;;;;YAMD,mBAAC;;;;;gBAAD,UAAE,MAAc,EAAE,MAAc;;wBAC1B,GAAG,GAAG,MAAM,GAAG,CAAC,MAAM,IAAI,CAAC,IAAI,CAAC;oBACpC,OAAO,GAAG,IAAI,CAAC,IAAI,GAAG,GAAG,EAAE,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC;iBACzD;;;;;YAED,qBAAG;;;;gBAAH,UAAI,GAAW;oBACb,IAAI,GAAG,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC,EAAE;wBACvB,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;qBAC7H;yBAAM;wBACL,OAAO,IAAI,CAAC;qBACb;iBACF;;;;;YAED,qBAAG;;;;gBAAH,UAAI,GAAW;oBACb,IAAI,GAAG,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC,EAAE;wBACvB,OAAO,IAAI,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,GAAG,GAAG,EAAE,CAAC,CAAC,CAAC;qBAC9G;yBAAM;wBACL,OAAO,IAAI,CAAC;qBACb;iBACF;;;;;YAED,wBAAM;;;;gBAAN,UAAO,CAAU;oBACf,IAAI,CAAC,EAAE;;4BACD,CAAC,GAAG,IAAI,CAAC,QAAQ;;4BACjB,CAAC,GAAG,CAAC,CAAC,QAAQ;wBAElB,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;4BACjE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;4BAC5D,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC;4BAChE,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC;qBACxE;yBAAM;wBACL,OAAO,KAAK,CAAC;qBACd;iBAEF;;;;;YAED,0BAAQ;;;;gBAAR,UAAS,CAA0B;oBACjC,IAAI,CAAC,YAAY,OAAO,EAAE;;4BACpB,CAAC,GAAG,IAAI,CAAC,QAAQ;;4BACjB,CAAC,GAAG,CAAC,CAAC,QAAQ;wBAClB,OAAO,IAAI,OAAO,CAAC;4BACjB,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;4BACtD,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;4BACtD,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;4BACvD,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;4BAEvD,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;4BACtD,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;4BACtD,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;4BACvD,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;4BAEvD,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC;4BACxD,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC;4BACxD,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC;4BACzD,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC;4BAEzD,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC;4BAC1D,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC;4BAC1D,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC;4BAC3D,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,GAA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CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAC7D,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAC7D,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;oBAEb,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EACtE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAC7D,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAC7D,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAC7D,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;oBAEb,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EACtE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC,EAAE,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,KAAK,C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KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;wBAC3F,WAAW,CAAC,SAAS,CAAC,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;wBAC3F,WAAW,CAAC,SAAS,CAAC,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;;wBAG3F,WAAW,CAAC,SAAS,CAAC,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;wBAC3F,WAAW,CAAC,SAAS,CAAC,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;wBAC3F,WAAW,CAAC,SAAS,CAAC,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;wBAC3F,WAAW,CAAC,SAAS,CAAC,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,KAAG,CAAC,IAAI,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;wBAE3F,eAAe,CAAC,SAAS,CAAC,WAAW,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,EAAE,YAAY,CAAC,CAAC,CAAC;;4BAE1E,iBAAiB,GAAG,IAAIJ,kBAAU,CAAC,MAAM,EAAE;wBAE/C,4BAAwB,EAAvB,SAAC,EAAE,SAAC,EAAE,SAAC,CAAiB;;4BACrB,YAAY,GAAG,IAAII,qBAAa,CAAC,iBAAiB,EAAE;;4BAClD,YAAY,GAAG,EAAE;;4BACjB,OAAO,GAAG,CAAC;;4BACX,OAAO,GAAG,GAAG;wBACnB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,YAAY,EAAE,EAAE,CAAC,EAAE;;gCAC/B,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,YAAY,GAAG,CAAC;;gCACvC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,YAAY,IAAI,CAAC,GAAG,CAAC,CAAC;;gCAC7C,MAAM,GAAG,IAAIJ,kBAAU,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,OAAO,EAAE,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,OAAO,CAAC,CAAC,GAAG,CAAC,iBAAiB,CAAC;;gCAC9G,MAAM,GAAG,IAAIA,kBAAU,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,OAAO,EAAE,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,OAAO,CAAC,CAAC,GAAG,CAAC,iBAAiB,CAAC;;gCAC9G,MAAM,GAAG,IAAIA,kBAAU,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,OAAO,EAAE,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,OAAO,CAAC,CAAC,GAAG,CAAC,iBAAiB,CAAC;;gCAC9G,MAAM,GAAG,IAAIA,kBAAU,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,OAAO,EAAE,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,OAAO,CAAC,CAAC,GAAG,CAAC,iBAAiB,CAAC;4BAClH,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC,EACpD,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC,EACnC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC,EACnC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC,EACnC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;4BAEb,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC,EACpD,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC,EACnC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC,EACnC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC,EACnC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;4BAEb,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC,EACpD,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC,EACnC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC,EACnC,MAAM,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC,GAAG,IAAI,EAAE,MAAM,CAAC,CAAC,EACnC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;4BAEb,iBAAiB,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;yBACvC;;4BACG,MAAM,GAAG,YAAY,CAAC,YAAY,CAAC,IAAI,CAAC,KAAK,EAAE,YAAY,CAAC;wBAChE,MAAM,CAAC,cAAc,CAAC,IAAII,qBAAa,CAAC,sBAAsB,CAAC,iBAAiB,CAAC,CAAC,CAAC;wBACnF,eAAe,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;;4BAE9B,mBAAmB,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,gBAAgB,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,YAAY,CAAC,EAAEJ,kBAAU,CAAC,IAAI,CAAC,IAAI,CAAC;;4BAC1H,gBAAgB,GAAG,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,gBAAgB,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,YAAY,CAAC,EAAEA,kBAAU,CAAC,IAAI,CAAC,IAAI,CAAC;wBAC3H,eAAe,CAAC,KAAK,CAAC,GAAG,CAAC,gBAAgB,EAAEA,kBAAU,CAAC,OAAO,CAAC,YAAY,CAAC,gBAAgB,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC,CAAC,CAAC,QAAQ,CAACA,kBAAU,CAAC,OAAO,CAAC,eAAe,CAAC,mBAAmB,CAAC,CAAC,EAAE,mBAAmB,CAAC,CAAC,EAAE,mBAAmB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;wBAE3P,eAAe,CAAC,MAAM,GAAG,IAAII,qBAAa,CAAC,2BAA2B,EAAE,CAAC;wBACzE,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;qBAClD;iBACJ;;;;;YAEM,uCAAe;;;;gBAAtB,UAAuB,CAAe;;wBAC9B,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC,CAAC,OAAO,CAAC;;wBAC5D,UAAU,GAA+C,EAAE;oBAC/D,IAAI,CAAC,KAAK,CAAC,yBAAyB,CAAC,OAAO,EAAE,UAAU,CAAC,CAAC;;wBAEtD,YAAY,GAAG,KAAK;;wBACpB,UAAU,GAAG,CAAC;oBAElB,OAAO,CAAC,YAAY,IAAI,UAAU,GAAG,UAAU,CAAC,MAAM,EAAE;wBAEpD,IAAI,UAAU,CAAC,UAAU,CAAC,CAAC,SAAS,YAAYA,qBAAa,CAAC,UAAU,EAAE;;gCAElE,WAAW,uBAA8B,UAAU,CAAC,UAAU,CAAC,CAAC,SAAS,GAAC;4BAC9E,IAAI,WAAW,CAAC,WAAW,IAAI,aAAa,CAAC,iBAAiB,EAAE;gCAC5D,IAAI,WAAW,IAAI,IAAI,CAAC,aAAa,EAAE;oCACnC,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,IAAI,aAAa,CAAC,WAAW,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;iCACzG;qCAAM;oCACH,IAAI,CAAC,aAAa,GAAG,WAAW,CAAC;oCACjC,IAAI,CAAC,qBAAqB,EAAE,CAAC;iCAChC;gCAED,YAAY,GAAG,IAAI,CAAC;6BACvB;iCAAM;gCACH,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,IAAI,eAAe,CAAC,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;gCAE/G,YAAY,GAAG,IAAI,CAAC;6BACvB;yBACJ;wBACD,UAAU,EAAE,CAAC;qBAChB;oBAED,IAAI,CAAC,YAAY,EAAE;wBACf,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,aAAa,CAAC,iBAAiB,CAAC,CAAC;wBAE5D,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;qBAC7B;iBACJ;;;;;;;YAEM,uCAAe;;;;;;gBAAtB,UAAuB,CAAe,EAAE,CAAS,EAAE,CAAS;iBAC3D;;;;;YAEM,qCAAa;;;;gBAApB,UAAqB,CAAe;iBACnC;YAlKuB,+BAAiB,GAAG,YAAY,CAAC;YAmK7D,oBAAC;SAAA,CApKkC,qBAAqB,GAoKvD;QApKY,wBAAa,gBAoKzB,CAAA;QAED;YAAoCH,kCAAqB;YAKrD,wBAAY,QAAgB,EAAU,MAAiC,EAAE,UAA0C;gBAAnH,YACI,kBAAM,UAAU,CAAC,SAWpB;gBAZqC,YAAM,GAAN,MAAM,CAA2B;gBAGnE,KAAI,CAAC,QAAQ,GAAG,IAAI,WAAW,EAAE,CAAC;gBAClC,KAAI,CAAC,QAAQ,CAAC,OAAO,GAAG,QAAQ,CAAC;gBACjC,KAAI,CAAC,QAAQ,CAAC,aAAa,GAAGG,qBAAa,CAAC,MAAM,EAAE,CAAC;gBACrD,KAAI,CAAC,QAAQ,CAAC,QAAQ,GAAG,IAAIJ,kBAAU,CAAC,IAAI,EAAE,CAAC;gBAC/C,KAAI,CAAC,QAAQ,CAAC,QAAQ,GAAG,IAAIA,kBAAU,CAAC,IAAI,EAAE,CAAC;gBAC/C,KAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,IAAIA,kBAAU,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;gBACtD,aAAa,CAAC,cAAc,CAAC,YAAY,CAAC,MAAM,CAAC,KAAI,CAAC,QAAQ,CAAC,CAAC;gBAEhE,KAAI,CAAC,WAAW,GAAG,aAAa,CAAC,cAAc,CAAC,YAAY,CAAC,KAAK,GAAG,CAAC,CAAC;;aAC1E;;;;;;;YAEM,wCAAe;;;;;;gBAAtB,UAAuB,CAAwB,EAAE,CAAS,EAAE,CAAS;;wBAC7D,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,CAAC;;wBACtC,CAAC,GAAG,OAAO,CAAC,qBAAqB,CAAC,IAAIA,kBAAU,CAAC,IAAI,EAAE,EAAE,IAAIA,kBAAU,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC1F,IAAI,CAAC,EAAE;wBACH,IAAI,CAAC,QAAQ,gBAAQ,IAAI,CAAC,QAAQ,CAAE,CAAC;wBACrC,IAAI,CAAC,QAAQ,CAAC,QAAQ,GAAG,IAAIA,kBAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;wBAC1D,aAAa,CAAC,cAAc,CAAC,YAAY,CAAC,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;;qBAEtF;iBACJ;;;;;YAEM,sCAAa;;;;gBAApB,UAAqB,CAAe;oBAChC,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,CAAC;iBACtC;YAEL,qBAAC;SAlCD,CAAoC,qBAAqB,GAkCxD;QAlCY,yBAAc,iBAkC1B,CAAA;;YAEG,SAAS,GAAG;YACZ,eAAe,EAAE,eAAe;YAChC,MAAM,EAAE,YAAY;YACpB,QAAQ,EAAE,mBAAmB;YAC7B,KAAK,EAAE,cAAc;YACrB,WAAW,EAAE,qBAAqB;SACrC;;YAEG,UAAU,GAAG;YACb,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;YACxB,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;YACxB,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;YACxB,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;YACxB,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;SAI3B;QAED;YAAmCC,iCAAqB;YAKpD,uBAAoB,KAA+B,EAAU,MAAiC,EAAE,UAA0C;gBAA1I,YACI,kBAAM,UAAU,CAAC,SACpB;gBAFmB,WAAK,GAAL,KAAK,CAA0B;gBAAU,YAAM,GAAN,MAAM,CAA2B;gBAJtF,mBAAa,GAAG,KAAK,CAAC;;aAM7B;;;;;;;YAEM,uCAAe;;;;;;gBAAtB,UAAuB,CAAwB,EAAE,CAAS,EAAE,CAAS;;wBAC7D,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,EAAE,CAAC,CAAC;;wBACtC,CAAC,GAAG,OAAO,CAAC,qBAAqB,CAAC,IAAID,kBAAU,CAAC,IAAI,EAAE,EAAE,IAAIA,kBAAU,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;oBAC1F,IAAI,CAAC,EAAE;wBACH,IAAI,IAAI,CAAC,aAAa,EAAE;4BAChB,IAAA,+DAAyE,EAAxE,gBAAQ,EAAE,mBAA8D;4BAC7E,IAAI,QAAQ,EAAE;;oCACN,kBAAkB,gBAAqB,QAAQ,CAAE;;oCACjD,WAAW,GAAG,kBAAkB,CAAC,QAAQ;gCAC7C,kBAAkB,CAAC,QAAQ,GAAG,kBAAkB,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAIA,kBAAU,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC;gCAC1H,aAAa,CAAC,cAAc,CAAC,YAAY,CAAC,OAAO,CAAC,kBAAkB,EAAE,WAAW,CAAC,CAAC;6BACtF;yBACJ;wBACD,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;wBACjB,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;wBACjB,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;qBAC7B;iBACJ;;;;;YAEM,qCAAa;;;;gBAApB,UAAqB,CAAe;oBAChC,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,CAAC;iBACtC;YAEL,oBAAC;SAhCD,CAAmC,qBAAqB,GAgCvD;QAhCY,wBAAa,gBAgCzB,CAAA;QAED;YAAqCC,mCAAqB;YACtD,yBAAoB,KAA+B,EAAU,MAAiC,EAAE,UAA0C;gBAA1I,YACI,kBAAM,UAAU,CAAC,SACpB;gBAFmB,WAAK,GAAL,KAAK,CAA0B;gBAAU,YAAM,GAAN,MAAM,CAA2B;;aAE7F;;;;;;;;;YAEM,oCAAU;;;;;;;;gBAAjB,UAAkB,CAAe,EAAE,MAAc,EAAE,MAAc,EAAE,EAAU,EAAE,EAAU;;wBAEjF,GAAG,GAAG,CAAC;oBACX,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO,GAAG,MAAM,CAAC,GAAG,GAAG,EAAE;wBACpC,GAAG,GAAG,CAAC,CAAA;qBACV;yBAAM,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO,GAAG,MAAM,CAAC,GAAG,GAAG,EAAE;wBAC3C,GAAG,GAAG,CAAC,CAAA;qBACV;yBAAM,IAAI,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO,GAAG,MAAM,CAAC,GAAG,GAAG,EAAE;wBAC3C,GAAG,GAAG,CAAC,CAAA;qBACV;oBAEG,IAAA,+DAAyE,EAAxE,gBAAQ,EAAE,mBAA8D;oBAC7E,IAAI,QAAQ,EAAE;;4BACN,eAAe,gBAAqB,QAAQ,CAAE;;4BAC9C,QAAQ,GAAG,eAAe,CAAC,QAAQ;wBACvC,eAAe,CAAC,QAAQ,GAAG,eAAe,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAID,kBAAU,CAAC,IAAI,CAAC,EAAE,IAAI,GAAG,GAAG,GAAG,CAAC,GAAG,IAAI,CAAC,EAAE,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;wBAC/G,aAAa,CAAC,cAAc,CAAC,YAAY,CAAC,OAAO,CAAC,eAAe,EAAE,WAAW,CAAC,CAAC;qBACnF;iBACJ;;;;;YAEM,uCAAa;;;;gBAApB,UAAqB,CAAe;oBAChC,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,CAAC;iBACtC;YAEL,sBAAC;SA7BD,CAAqC,qBAAqB,GA6BzD;QA7BY,0BAAe,kBA6B3B,CAAA;QAED;YAAoCC,kCAAqC;YAUrE,wBAAY,KAA+B,EAAE,UAA0C;gBAAvF,YACI,kBAAM,IAAII,0BAAkB,CAAC,QAAQ,CAACA,0BAAkB,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,EAAE,UAAU,CAAC,SA+BhG;gBAtCO,gBAAU,GAA6B,IAAID,qBAAa,CAAC,UAAU,CAAC,KAAI,EAAE,OAAO,CAAC,CAAC;gBAQvF,KAAI,CAAC,QAAQ,CAAC,KAAK,GAAG,KAAI,CAAC;gBAC3B,KAAI,CAAC,KAAK,GAAG,KAAK,CAAC;gBAEnB,KAAI,CAAC,UAAU,GAAG,IAAI,UAAU,CAAC,KAAI,EAAE,KAAI,CAAC,KAAK,EAAE,KAAI,CAAC,UAAU,CAAC,CAAC;;oBAEhE,aAAa,GAAqC,IAAIA,qBAAa,CAAC,4BAA4B,EAAE;gBACtG,aAAa,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;gBAChC,KAAK,CAAC,qBAAqB,CAAC,kBAAkB,EAAE,aAAa,CAAC,CAAC;gBAE/D,aAAa,GAAG,IAAIA,qBAAa,CAAC,iCAAiC,EAAE,CAAC;gBACtE,aAAa,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;gBAChC,KAAK,CAAC,qBAAqB,CAAC,uBAAuB,EAAE,aAAa,CAAC,CAAC;gBAEpE,aAAa,GAAG,IAAIA,qBAAa,CAAC,8BAA8B,EAAE,CAAC;gBACnE,aAAa,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;gBAChC,KAAK,CAAC,qBAAqB,CAAC,oBAAoB,EAAE,aAAa,CAAC,CAAC;gBAEjE,aAAa,GAAG,IAAIA,qBAAa,CAAC,wBAAwB,EAAE,CAAC;gBAC7D,aAAa,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;gBAChC,KAAK,CAAC,qBAAqB,CAAC,kBAAkB,EAAE,aAAa,CAAC,CAAC;;gBAI/D,aAAa,GAAG,IAAIA,qBAAa,CAAC,oCAAoC,EAAE,CAAC;gBACzE,aAAa,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;gBAChC,KAAK,CAAC,kCAAkC,CAAC,QAAQ,EAAE,oBAAoB,EAAE,aAAa,CAAC,CAAC;gBAExF,aAAa,GAAG,IAAIA,qBAAa,CAAC,oCAAoC,EAAE,CAAC;gBACzE,aAAa,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC;gBAChC,KAAK,CAAC,kCAAkC,CAAC,QAAQ,EAAE,kBAAkB,EAAE,aAAa,CAAC,CAAC;;aACzF;YAlCD,sBAAW,sCAAU;;;oBAArB,cAA0B,OAAO,IAAI,CAAC,UAAU,CAAC,EAAE;;;eAAA;;;;YAoC5C,mCAAU;;;gBAAjB;oBAAA,iBAgCC;oBA/BG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;oBACzC,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC;oBAE9B,CAAC,CAAC,IAAI;;oBAEF,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,UAAU,CAAC,sBAAsB,CAAC;;oBAE1D,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,UAAU,CAAC,iCAAiC,CAAC,CACxE,CAAC,IAAI,CAAC;wBACH,KAAI,CAAC,aAAa,GAAG,IAAI,CAAC;qBAC7B,CAAC,CAAC;;;;;;;;;;;;;;;;;;;iBAqBN;;;;YAEM,oCAAW;;;gBAAlB;oBACI,IAAI,CAAC,UAAU,CAAC,aAAa,EAAE,CAAC;oBAChC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,YAAY,CAAC,cAAc,CAAC,QAAQ,CAAC,KAAK,EAAE,EAAE,CAAC,EAAE;;4BAC7D,IAAI,GAAG,YAAY,CAAC,cAAc,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC;wBAC5D,IAAI,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;qBAC7C;oBACD,IAAI,CAAC,UAAU,CAAC,WAAW,EAAE,CAAC;iBACjC;;;;;;;YAEM,uCAAc;;;;;;gBAArB,UAAsB,MAAc,EAAE,cAAsB,EAAE,QAAgB;oBAC1E,IAAI,MAAM,IAAI,IAAI,EAAE;;4BACZ,UAAU,GAAG,YAAY,GAAG,MAAM;;4BAElC,eAAe,GAAG,CAAC,CAAC,GAAG,GAAG,UAAU,CAAC;wBAEzC,IAAI,eAAe,CAAC,MAAM,GAAG,CAAC,EAAE;4BAC5B,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;yBAC/C;6BAAM;4BACH,CAAC,CAAC,oBAAoB,CAAC,CAAC,MAAM,CAAC,UAAU,GAAG,UAAU,GAAG,8BAA8B,GAAG,cAAc,GAAG,gBAAgB,GAAG,QAAQ,GAAG,cAAc,CAAC,CAAC;yBAC5J;qBACJ;iBACJ;;;;;YAEM,mCAAU;;;;gBAAjB,UAAkB,MAAc;oBAC5B,IAAI,CAAC,eAAe,CAAC,MAAM,GAAG,MAAM,CAAC,CAAC;;wBAElC,UAAU,GAAG,YAAY,GAAG,MAAM;;wBAClC,eAAe,GAAG,CAAC,CAAC,GAAG,GAAG,UAAU,CAAC;oBACzC,eAAe,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;oBACrC,UAAU,CAAC;wBACP,eAAe,CAAC,MAAM,EAAE,CAAC;qBAC5B,EAAE,IAAI,CAAC,CAAC;iBACZ;;;;;YAEM,gDAAuB;;;;gBAA9B,UAA+B,MAAc;oBACzC,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,UAAU,CAAC,MAAM,CAAC;iBACrD;;;;;YAEM,mCAAU;;;;gBAAjB,UAAkB,MAAc;;wBACxB,GAAG,GAA6B,IAAIA,qBAAa,CAAC,UAAU,CAAC,IAAI,EAAE,MAAM,GAAG,MAAM,CAAC;oBACvF,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,CAAC,uBAAuB,CAAC,CAAC,CAAC;;oBAEtE,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,SAAS,GAAG,kBAAkB,CAAC;;wBAE7D,UAAU,GAAG,IAAI,CAAC,uBAAuB,CAAC,MAAM,CAAC;oBAErD,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,EAAE,IAAIJ,kBAAU,CAAC,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;oBACxJ,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,gBAAgB,EAAE,UAAC,KAAgC;;4BACzD,GAAG,GAAoB,KAAK,CAAC,GAAG,CAAC,SAAS,GAAG,MAAM,EAAEA,kBAAU,CAAC,IAAI,CAAC,IAAI,CAAC;;4BAC1E,MAAM,GAAoB,KAAK,CAAC,GAAG,CAAC,SAAS,GAAG,MAAM,EAAEA,kBAAU,CAAC,IAAI,CAAC,IAAI,CAAC;;4BAC7E,GAAG,GAAG,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC;;4BAErB,SAAS,GAAGA,kBAAU,CAAC,SAAS,CAAC,mBAAmB,CAAC,GAAG,CAAC;wBAE7D,OAAO,oBAAqBA,kBAAU,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,QAAQ,CACrFA,kBAAU,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,IAAE,QAAQ,CAC7DA,kBAAU,CAAC,OAAO,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;qBAChE,CAAC,CAAC;oBAEH,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,IAAI,mBAAmB,CAAC;oBAC/C,GAAG,CAAC,gBAAgB,GAAG,KAAK,CAAC;oBAC7B,GAAG,CAAC,wBAAwB,GAAG,KAAK,CAAC;oBACrC,OAAO,GAAG,CAAC;iBACd;;;;;;YAEM,0CAAiB;;;;;gBAAxB,UAAyB,QAAgB,EAAE,OAAe;;wBAClD,MAAM,GAAG,QAAQ;;wBAEjB,GAAG,GAAG,IAAII,qBAAa,CAAC,UAAU,CAAC,IAAI,EAAE,aAAa,GAAG,MAAM,CAAC;oBACpE,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,gBAAgB,EAAE,UAAC,KAAgC;;4BACzD,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,gBAAgB,GAAG,MAAM,EAAEJ,kBAAU,CAAC,IAAI,CAAC,IAAI,CAAC;;4BAChE,GAAG,GAAG,KAAK,CAAC,GAAG,CAAC,gBAAgB,GAAG,MAAM,EAAEA,kBAAU,CAAC,IAAI,CAAC,IAAI,CAAC;;4BAChE,KAAK,GAAG,KAAK,CAAC,GAAG,CAAC,kBAAkB,GAAG,MAAM,EAAEA,kBAAU,CAAC,IAAI,CAAC,GAAG,CAAC;wBAEvE,0BAA2BA,kBAAU,CAAC,OAAO,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,QAAQ,CACpFA,kBAAU,CAAC,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,CAC9DA,kBAAU,CAAC,OAAO,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,GAAC;qBACrE,CAAC,CAAC;oBACH,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;oBACxD,GAAG,CAAC,IAAI,CAAC,YAAY,CAAC,GAAG,MAAM,CAAC;oBAEhC,OAAO,GAAG,CAAC;iBACd;YAEL,qBAAC;SAAA,CAlKmCK,0BAAkB,CAAC,kBAAkB,GAkKxE;QAlKY,yBAAc,iBAkK1B,CAAA;QAED;YAAkCJ,gCAAkC;YAWhE;gBAAA,YACI,iBAAO,SAEV;gBATM,gBAAU,GAA0C,IAAII,0BAAkB,CAAC,kBAAkB,EAAE,CAAC;gBAEhG,gBAAU,GAA4C,IAAIA,0BAAkB,CAAC,oBAAoB,EAAE,CAAC;gBAEpG,cAAQ,GAA2D,IAAIA,0BAAkB,CAAC,kBAAkB,CAAkBA,0BAAkB,CAAC,2BAA2B,CAAC,CAAC;gBAIjL,YAAY,CAAC,cAAc,GAAG,KAAI,CAAC;;aACtC;;;;YAEM,sCAAe;;;gBAAtB;oBACI,IAAI,CAAC,aAAa,CAAC,YAAY,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;oBAClD,IAAI,CAAC,aAAa,CAAC,YAAY,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;oBAClD,IAAI,CAAC,aAAa,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,CAAC,CAAC;iBACjD;;;;;;YAEM,gCAAS;;;;;gBAAhB,UAAiB,GAAW,EAAE,MAA8C;oBACxE,IAAI,GAAG,IAAI,UAAU,EAAE;wBACnB,OAAO,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;qBACnC;yBAAM;wBACH,OAAO,iBAAM,SAAS,YAAC,GAAG,EAAE,MAAM,CAAC,CAAC;qBACvC;iBACJ;;;;;;;YAEM,mCAAY;;;;;;gBAAnB,UAAoB,KAA+B,EAAE,MAAc,EAAE,UAAkB;oBACnF,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE;wBAC3B,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,YAAY,EAAE,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC,CAAC;wBACrD,oBAAiB,KAAK,IAAE,UAAU,CAAC,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC;qBACzE;oBACD,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,EAAE;wBAC3B,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,eAAe,EAAE,IAAI,CAAC,UAAU,CAAC,GAAG,EAAE,CAAC,CAAC;qBAC3D;oBACD,IAAI,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,EAAE;wBAEzB,oBAAiB,KAAK,IAAE,WAAW,EAAE,CAAC;qBACzC;iBACJ;YAzCM,0BAAa,GAAG,MAAM,CAAC;YA0ClC,mBAAC;SA3CD,CAAkCA,0BAAkB,CAAC,eAAe,GA2CnE;QA3CY,uBAAY,eA2CxB,CAAA;QAED;YAAA;aAUC;YAAD,kBAAC;SAAA,IAAA;QAED;YAAmCJ,iCAAkC;YAOjE;gBAAA,YACI,iBAAO,SAEV;gBALM,kBAAY,GAAuD,IAAII,0BAAkB,CAAC,kBAAkB,CAAcA,0BAAkB,CAAC,2BAA2B,CAAC,CAAC;gBAI7K,aAAa,CAAC,cAAc,GAAG,KAAI,CAAC;;aACvC;;;;YAEM,uCAAe;;;gBAAtB;oBACI,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;iBAChD;;;;;;YAEM,iCAAS;;;;;gBAAhB,UAAiB,GAAW,EAAE,MAA8C;oBACxE,IAAI,GAAG,IAAI,KAAK,EAAE;;4BACV,KAAK,GAAG,IAAI,WAAW,EAAE;wBAE7B,KAAK,CAAC,aAAa,GAAG,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;wBACtD,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;wBAChD,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;wBAC1C,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;wBAC1C,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;wBAEvC,OAAO,KAAK,CAAC;qBAChB;yBAAM;wBACH,OAAO,iBAAM,SAAS,YAAC,GAAG,EAAE,MAAM,CAAC,CAAC;qBACvC;iBACJ;;;;;;;YAEM,kCAAU;;;;;;gBAAjB,UAAkB,GAAW,EAAE,MAA8C,EAAE,KAAU;oBACrF,IAAI,GAAG,IAAI,KAAK,EAAE;wBACd,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,aAAa,EAAE,EAAE,CAAC,CAAC;wBACtD,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;wBAChD,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;wBACxC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;wBACxC,MAAM,CAAC,MAAM,CAAC,SAAS,CAACL,kBAAU,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;qBAChD;yBAAM;wBACH,iBAAM,UAAU,YAAC,GAAG,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;qBACxC;iBACJ;;;;;;;YAEM,oCAAY;;;;;;gBAAnB,UAAoB,KAA+B,EAAE,MAAc,EAAE,UAAkB;oBACnF,IAAI,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,EAAE;;4BACzB,IAAE,uBAAoB,KAAK,GAAC;wBAEhC,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,OAAO,CAAC,UAAC,SAAS;4BAC3C,IAAI,SAAS,CAAC,SAAS,IAAIK,0BAAkB,CAAC,aAAa,CAAC,MAAM,EAAE;;oCAC5D,KAAK,GAAG,SAAS,CAAC,QAAQ,CAAC,aAAa;;oCACxC,OAAO,GAAG,SAAS,CAAC,QAAQ,CAAC,OAAO;gCACxC,IAAE,CAAC,YAAY,CAAC,IAAE,CAAC,iBAAiB,CAAC,KAAK,EAAE,OAAO,CAAC,EAAE,IAAI,mBAAmB,CAAC;gCAC9E,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,gBAAgB,GAAG,KAAK,EAAE,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;gCACvE,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,gBAAgB,GAAG,KAAK,EAAE,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;gCACvE,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,kBAAkB,GAAG,KAAK,EAAE,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;;6BAEzE;iCACI,IAAI,SAAS,CAAC,SAAS,IAAIA,0BAAkB,CAAC,aAAa,CAAC,OAAO,EAAE;;oCAClE,KAAK,GAAG,SAAS,CAAC,QAAQ,CAAC,aAAa;gCAC5C,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,gBAAgB,GAAG,KAAK,EAAE,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;gCACvE,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,gBAAgB,GAAG,KAAK,EAAE,SAAS,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;gCACvE,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,kBAAkB,GAAG,KAAK,EAAE,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;6BACzE;iCACI,IAAI,SAAS,CAAC,SAAS,IAAIA,0BAAkB,CAAC,aAAa,CAAC,MAAM,EAAE;;oCACjE,KAAK,GAAG,SAAS,CAAC,aAAa,CAAC,aAAa;gCACjD,KAAK,CAAC,eAAe,CAAC,aAAa,GAAG,KAAK,CAAC,CAAC;6BAChD;yBACJ,CAAC,CAAC;qBACN;iBACJ;YArEM,2BAAa,GAAG,KAAK,CAAC;YAuEjC,oBAAC;SAxED,CAAmCA,0BAAkB,CAAC,eAAe,GAwEpE;QAxEY,wBAAa,gBAwEzB,CAAA;QAED;YAAkCJ,gCAAkC;YAApE;gBAAA,qEAgDC;gBA7CW,aAAO,GAA4C,IAAII,0BAAkB,CAAC,oBAAoB,EAAE,CAAC;gBAEjG,eAAS,GAA4C,IAAIA,0BAAkB,CAAC,oBAAoB,EAAE,CAAC;gBAEnG,YAAM,GAA2C,IAAIA,0BAAkB,CAAC,mBAAmB,EAAE,CAAC;gBAE9F,YAAM,GAAyC,IAAIA,0BAAkB,CAAC,iBAAiB,EAAE,CAAC;;aAuCrG;;;;YArCU,iDAA0B;;;gBAAjC;oBACI,OAAO,IAAI,CAAC;iBACf;;;;YAEM,sCAAe;;;gBAAtB;oBACI,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;oBACzC,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;oBAC3C,IAAI,CAAC,aAAa,CAAC,MAAM,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;oBACxC,IAAI,CAAC,aAAa,CAAC,QAAQ,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC;iBAC7C;;;;;;;YAEM,mCAAY;;;;;;gBAAnB,UAAoB,KAA+B,EAAE,MAAc,EAAE,UAAkB;;wBAC/E,EAAE,sBAAmB,KAAK,EAAA;oBAC9B,IAAI,MAAM,CAAC,MAAM,GAAG,CAAC,KAAK,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,IAAI,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC,EAAE;wBAC3E,IAAI,CAAC,EAAE,CAAC,YAAY,CAAC,MAAM,GAAG,MAAM,CAAC,EAAE;4BACnC,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;yBACzB;;4BACG,QAAQ,GAAG,IAAIL,kBAAU,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC,EAAE,CAAC,CAAC;;4BAClE,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE;;4BAC5B,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE;wBACpC,IAAI,OAAO,IAAI,SAAS,EAAE;4BACtB,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,SAAS,GAAG,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;4BAC3D,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,SAAS,GAAG,MAAM,EAAE,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;yBAChE;qBACJ;oBAED,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,EAAE;;4BACnB,QAAQ,GAAG,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,IAAI,EAAE;wBACjD,EAAE,CAAC,cAAc,CAAC,MAAM,EAAE,EAAE,CAAC,uBAAuB,CAAC,MAAM,CAAC,EAAE,QAAQ,CAAC,CAAC;qBAC3E;oBAED,IAAI,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,EAAE;wBACvB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,EAAE;4BACpB,EAAE,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;yBACzB;qBACJ;iBACH;YA9CK,0BAAa,GAAG,MAAM,CAAC;YA+ClC,mBAAC;SAhDD,CAAkCK,0BAAkB,CAAC,eAAe,GAgDnE;QAhDY,uBAAY,eAgDxB,CAAA;QAED;YAAA;aAaC;YAAD,WAAC;SAAA,IAAA;QAED;YAAmCJ,iCAAkC;YAOjE;gBAAA,YACI,iBAAO,SAEV;gBALM,WAAK,GAAgD,IAAII,0BAAkB,CAAC,kBAAkB,CAAOA,0BAAkB,CAAC,2BAA2B,CAAC,CAAC;gBAIxJ,aAAa,CAAC,cAAc,GAAG,KAAI,CAAC;;aACvC;;;;YAEM,uCAAe;;;gBAAtB;oBACI,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;iBAC3C;;;;;;YAEM,iCAAS;;;;;gBAAhB,UAAiB,GAAW,EAAE,MAA8C;oBACxE,IAAI,GAAG,IAAI,OAAO,EAAE;;4BACZ,KAAK,GAAG,IAAI,IAAI,EAAE;wBAEtB,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;wBAC/C,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC,UAAU,EAAE,CAAC;wBAC5C,KAAK,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;wBAChD,KAAK,CAAC,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;wBAC1C,KAAK,CAAC,iBAAiB,GAAG,MAAM,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC;wBAEtD,OAAO,KAAK,CAAC;qBAChB;yBAAM;wBACH,OAAO,iBAAM,SAAS,YAAC,GAAG,EAAE,MAAM,CAAC,CAAC;qBACvC;iBACJ;;;;;;;YAEM,kCAAU;;;;;;gBAAjB,UAAkB,GAAW,EAAE,MAA8C,EAAE,KAAU;oBACrF,IAAI,GAAG,IAAI,OAAO,EAAE;wBAChB,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;wBAC/C,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;wBACzC,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,KAAK,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;wBAChD,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;wBACxC,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,KAAK,CAAC,iBAAiB,CAAC,CAAC;qBACvD;yBAAM;wBACH,iBAAM,UAAU,YAAC,GAAG,EAAE,MAAM,EAAE,KAAK,CAAC,CAAC;qBACxC;iBACJ;YAzCM,2BAAa,GAAG,OAAO,CAAC;YA4CnC,oBAAC;SA7CD,CAAmCA,0BAAkB,CAAC,eAAe,GA6CpE;QA7CY,wBAAa,gBA6CzB,CAAA;IAEL,CAAC,EAx7BaC,UAAU,KAAVA,UAAU,QAw7BvB;;;;;;;QCx7BD;SAoBC;;;;;;QAlBa,oCAAW;;;;;YAArB,UAAsB,OAAe;;oBAC7B,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC;gBAC9B,IAAI,GAAG,IAAI,CAAC,EAAE;oBACV,OAAO;wBACH,IAAI,EAAE,OAAO,CAAC,SAAS,CAAC,CAAC,EAAE,GAAG,CAAC;wBAC/B,SAAS,EAAE,OAAO,CAAC,SAAS,CAAC,GAAG,GAAG,CAAC,CAAC;qBACxC,CAAC;iBACL;qBAAM;oBACH,OAAO;wBACH,SAAS,EAAE,EAAE;wBACb,IAAI,EAAE,OAAO;qBAChB,CAAC;iBACL;aACJ;;;;;QAEM,uCAAc;;;;YAArB,UAAsB,OAAe;aACpC;QAEL,qBAAC;IAAD,CAAC,IAAA;;QAEuCL,sCAAuB;QAoB3D,4BAAY,eAAuB;YAAnC,YACI,kBAAM,eAAe,CAAC,SAwDzB;YA3EO,kBAAY,GAAG,IAAII,0BAAkB,CAAC,2BAA2B,CAACC,UAAU,CAAC,YAAY,CAAC,aAAa,EAAEA,UAAU,CAAC,YAAY,CAAC,CAAC;YAElI,mBAAa,GAAG,IAAID,0BAAkB,CAAC,4BAA4B,CAACC,UAAU,CAAC,aAAa,CAAC,aAAa,EAAEA,UAAU,CAAC,aAAa,CAAC,CAAC;YAEtI,kBAAY,GAAG,IAAID,0BAAkB,CAAC,4BAA4B,CAACC,UAAU,CAAC,YAAY,CAAC,aAAa,EAAEA,UAAU,CAAC,YAAY,CAAC,CAAC;YAEnI,mBAAa,GAAG,IAAID,0BAAkB,CAAC,4BAA4B,CAACC,UAAU,CAAC,aAAa,CAAC,aAAa,EAAEA,UAAU,CAAC,aAAa,CAAC,CAAC;YAEtI,gBAAU,GAAG,CAAC,CAAC;YAQf,cAAQ,GAAwC,EAAE,CAAC;YAKvD,KAAI,CAAC,UAAU,GAAG,IAAIF,qBAAa,CAAC,uBAAuB,EAAE,CAAC;YAE9D,KAAI,CAAC,KAAK,GAAG,IAAIE,UAAU,CAAC,cAAc,CAAC,KAAI,CAAC,KAAK,EAAE,KAAI,CAAC,UAAU,CAAC,CAAC;YACxE,KAAI,CAAC,KAAK,CAAC,UAAU,EAAE,CAAC;YAExB,KAAI,CAAC,UAAU,CAAC,WAAW,CAAC;aAC3B,CAAC,CAAC;YACH,KAAI,CAAC,UAAU,CAAC,SAAS,CAAC,UAAC,GAAG;gBAC1B,IAAI,GAAG,CAAC,IAAI,YAAY,WAAW,IAAI,GAAG,CAAC,IAAI,YAAY,UAAU,EAAE;;wBAC/D,GAAG,GAAG,GAAG,CAAC,IAAI,YAAY,UAAU,GAAG,GAAG,CAAC,IAAI,GAAG,IAAI,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC;;wBAC1E,cAAc,GAAGF,qBAAa,CAAC,qBAAqB,CAAC,UAAU,CAAC,GAAG,CAAC;oBACxE,oBAAwC,KAAI,CAAC,KAAK,IAAE,eAAe,CAAC,cAAc,CAAC,CAAC;iBACvF;qBAAM,IAAI,OAAO,GAAG,CAAC,IAAI,IAAI,QAAQ,EAAE;;wBAChC,IAAI,sBAAW,GAAG,CAAC,IAAI,EAAA;;wBACvB,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC;oBAC3B,IAAI,GAAG,IAAI,CAAC,EAAE;;4BACN,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,GAAG,CAAC;;4BACnC,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,CAAC;;4BAC9B,OAAO,GAAG,KAAI,CAAC,QAAQ,CAAC,UAAU,CAAC;wBACvC,IAAI,OAAO,EAAE;4BACT,OAAO,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC;yBACnC;qBACJ;iBACJ;qBAAM;oBACH,OAAO,CAAC,IAAI,CAAC,iCAAiC,GAAG,OAAO,GAAG,CAAC,IAAI,CAAC,CAAC;iBACrE;aACJ,CAAC,CAAC;YAEH,KAAI,CAAC,mBAAmB,GAAG,IAAIA,qBAAa,CAAC,mBAAmB,EAAE,CAAC;YACnE,KAAI,CAAC,gBAAgB,GAAG,IAAIA,qBAAa,CAAC,gBAAgB,CAAC,KAAI,CAAC,KAAK,EAAE,KAAI,CAAC,KAAK,CAAC,MAAM,EAAE,KAAI,CAAC,mBAAmB,EAAE,KAAI,CAAC,UAAU,CAAC,CAAC;YACrI,KAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;YAClD,KAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,IAAIE,UAAU,CAAC,aAAa,CAAC,KAAI,CAAC,KAAK,EAAE,KAAI,CAAC,KAAK,EAAE,KAAI,CAAC,UAAU,CAAC,CAAC,CAAC;YAEzG,CAAC,CAAC;gBACE,KAAI,CAAC,UAAU,CAAC,OAAO,EAAE,CAAC;gBAE1B,oBAAM,CAAC,CAAC,2BAA2B,CAAC,IAAE,SAAS,CAAC;oBAC5C,WAAW,EAAE,UAAU;oBACvB,MAAM,EAAE,WAAW;oBACnB,MAAM,EAAE,OAAO;oBACf,OAAO,EAAE,GAAG;oBACZ,MAAM,EAAE,KAAK;iBAChB,CAAC,CAAC;gBAEH,oBAAM,CAAC,CAAC,aAAa,CAAC,IAAE,SAAS,CAAC;oBAC9B,IAAI,EAAE,UAAC,KAAK,EAAE,EAAE;;4BACR,QAAQ,GAAG,CAAC,CAAC,EAAE,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC;;wBAGrD,KAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,IAAIA,UAAU,CAAC,cAAc,CAAC,QAAQ,EAAE,KAAI,CAAC,KAAK,CAAC,MAAM,EAAE,KAAI,CAAC,UAAU,CAAC,CAAC,CAAC;qBAClH;iBACJ,CAAC,CAAC;aAEN,CAAC,CAAC;;SACN;;;;;QAES,uCAAU;;;;YAApB;aACC;QAEL,yBAAC;IAAD,CAAC,CAlFuCA,UAAU,CAAC,YAAY;;;;;;;;;;;;;;;;;;;;;;;;"}
